function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=_superPropBase(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)},_wrapNativeSuper(e)}function _construct(e,t,n){return _construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&_setPrototypeOf(r,n.prototype),r},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof p?t:p,o=Object.create(a.prototype),s=new T(r||[]);return i(o,"_invoke",{value:S(e,n,s)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function p(){}function f(){}function h(){}var v={};c(v,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(P([])));g&&g!==t&&n.call(g,a)&&(v=g);var b=h.prototype=p.prototype=Object.create(v);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function r(i,a,o,s){var c=d(e[i],e,a);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,s)}))}s(c.arg)}var a;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return a=a?a.then(i,i):i()}})}function S(e,t,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return E()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=d(e,t,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}function w(e,t){var n=t.method,i=e.iterator[n];if(void 0===i)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;var r=d(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function P(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=h,i(b,"constructor",{value:h,configurable:!0}),i(h,"constructor",{value:f,configurable:!0}),f.displayName=c(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},k(y.prototype),c(y.prototype,o,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new y(u(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=P,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;R(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function asyncGeneratorStep(e,t,n,i,r,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){asyncGeneratorStep(a,i,r,o,s,"next",e)}function s(e){asyncGeneratorStep(a,i,r,o,s,"throw",e)}o(void 0)}))}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){s=!0,a=e})),f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(e,t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).LivekitClient={})}(this,(function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i={exports:{}};!function(e){var n,i;n=t,i=function(){var e=function(){},t="undefined",n=("undefined"==typeof window?"undefined":_typeof(window))!==t&&_typeof(window.navigator)!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(t,n){for(var r=0;r<i.length;r++){var a=i[r];this[a]=r<t?e:this.methodFactory(a,t,n)}this.log=this.debug}function s(e,n,i){return function(){("undefined"==typeof console?"undefined":_typeof(console))!==t&&(o.call(this,n,i),this[e].apply(this,arguments))}}function c(i,o,c){return function(i){return"debug"===i&&(i="log"),("undefined"==typeof console?"undefined":_typeof(console))!==t&&("trace"===i&&n?a:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}(i)||s.apply(this,arguments)}function u(e,n,r){var a,s=this;n=null==n?"WARN":n;var u="loglevel";function d(){var e;if(("undefined"==typeof window?"undefined":_typeof(window))!==t&&u){try{e=window.localStorage[u]}catch(e){}if(_typeof(e)===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(u)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"==_typeof(e)&&(u=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=r||c,s.getLevel=function(){return a},s.setLevel=function(n,r){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(a=n,!1!==r&&function(e){var n=(i[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":_typeof(window))!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),o.call(s,n,e),("undefined"==typeof console?"undefined":_typeof(console))===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){n=e,d()||s.setLevel(e,!1)},s.resetLevel=function(){s.setLevel(n,!1),function(){if(("undefined"==typeof window?"undefined":_typeof(window))!==t&&u){try{return void window.localStorage.removeItem(u)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var l=d();null==l&&(l=n),s.setLevel(l,!1)}var d=new u,l={};d.getLogger=function(e){if("symbol"!=_typeof(e)&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new u(e,d.getLevel(),d.methodFactory)),t};var p=("undefined"==typeof window?"undefined":_typeof(window))!==t?window.log:void 0;return d.noConflict=function(){return("undefined"==typeof window?"undefined":_typeof(window))!==t&&window.log===d&&(window.log=p),d},d.getLoggers=function(){return l},d.default=d,d},e.exports?e.exports=i():n.log=i()}(i);var r,a=i.exports;e.LogLevel=void 0,(r=e.LogLevel||(e.LogLevel={}))[r.trace=0]="trace",r[r.debug=1]="debug",r[r.info=2]="info",r[r.warn=3]="warn",r[r.error=4]="error",r[r.silent=5]="silent";var o=a.getLogger("livekit");o.setLevel(e.LogLevel.info);var s=u,c=null;try{c=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function u(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function d(e){return!0===(e&&e.__isLong__)}u.prototype.__isLong__,Object.defineProperty(u.prototype,"__isLong__",{value:!0}),u.isLong=d;var l={},p={};function f(e,t){var n,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=p[e])?i:(n=v(e,(0|e)<0?-1:0,!0),r&&(p[e]=n),n):(r=-128<=(e|=0)&&e<128)&&(i=l[e])?i:(n=v(e,e<0?-1:0,!1),r&&(l[e]=n),n)}function h(e,t){if(isNaN(e))return t?R:C;if(t){if(e<0)return R;if(e>=y)return x}else{if(e<=-S)return O;if(e+1>=S)return _}return e<0?h(-e,t).neg():v(e%k|0,e/k|0,t)}function v(e,t,n){return new u(e,t,n)}u.fromInt=f,u.fromNumber=h,u.fromBits=v;var m=Math.pow;function g(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return C;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return g(e.substring(1),t,n).neg();for(var r=h(m(n,8)),a=C,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),n);if(s<8){var u=h(m(n,s));a=a.mul(u).add(h(c))}else a=(a=a.mul(r)).add(h(c))}return a.unsigned=t,a}function b(e,t){return"number"==typeof e?h(e,t):"string"==typeof e?g(e,t):v(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}u.fromString=g,u.fromValue=b;var k=4294967296,y=k*k,S=y/2,w=f(1<<24),C=f(0);u.ZERO=C;var R=f(0,!0);u.UZERO=R;var T=f(1);u.ONE=T;var P=f(1,!0);u.UONE=P;var E=f(-1);u.NEG_ONE=E;var _=v(-1,2147483647,!1);u.MAX_VALUE=_;var x=v(-1,-1,!0);u.MAX_UNSIGNED_VALUE=x;var O=v(0,-2147483648,!1);u.MIN_VALUE=O;var N=u.prototype;N.toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*k+(this.low>>>0):this.high*k+(this.low>>>0)},N.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(O)){var t=h(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=h(m(e,6),this.unsigned),a=this,o="";;){var s=a.div(r),c=(a.sub(s.mul(r)).toInt()>>>0).toString(e);if((a=s).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},N.isZero=function(){return 0===this.high&&0===this.low},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return 1==(1&this.low)},N.isEven=function(){return 0==(1&this.low)},N.equals=function(e){return d(e)||(e=b(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},N.eq=N.equals,N.notEquals=function(e){return!this.eq(e)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(e){return this.comp(e)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(e){return this.comp(e)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(e){return this.comp(e)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(e){return this.comp(e)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(e){if(d(e)||(e=b(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(T)},N.neg=N.negate,N.add=function(e){d(e)||(e=b(e));var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,a=e.high>>>16,o=65535&e.high,s=e.low>>>16,c=0,u=0,l=0,p=0;return l+=(p+=r+(65535&e.low))>>>16,u+=(l+=i+s)>>>16,c+=(u+=n+o)>>>16,c+=t+a,v((l&=65535)<<16|(p&=65535),(c&=65535)<<16|(u&=65535),this.unsigned)},N.subtract=function(e){return d(e)||(e=b(e)),this.add(e.neg())},N.sub=N.subtract,N.multiply=function(e){if(this.isZero())return C;if(d(e)||(e=b(e)),c)return v(c.mul(this.low,this.high,e.low,e.high),c.get_high(),this.unsigned);if(e.isZero())return C;if(this.eq(O))return e.isOdd()?O:C;if(e.eq(O))return this.isOdd()?O:C;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(w)&&e.lt(w))return h(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=65535&this.low,a=e.high>>>16,o=65535&e.high,s=e.low>>>16,u=65535&e.low,l=0,p=0,f=0,m=0;return f+=(m+=r*u)>>>16,p+=(f+=i*u)>>>16,f&=65535,p+=(f+=r*s)>>>16,l+=(p+=n*u)>>>16,p&=65535,l+=(p+=i*s)>>>16,p&=65535,l+=(p+=r*o)>>>16,l+=t*u+n*s+i*o+r*a,v((f&=65535)<<16|(m&=65535),(l&=65535)<<16|(p&=65535),this.unsigned)},N.mul=N.multiply,N.divide=function(e){if(d(e)||(e=b(e)),e.isZero())throw Error("division by zero");var t,n,i;if(c)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?v((this.unsigned?c.div_u:c.div_s)(this.low,this.high,e.low,e.high),c.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?R:C;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return R;if(e.gt(this.shru(1)))return P;i=R}else{if(this.eq(O))return e.eq(T)||e.eq(E)?O:e.eq(O)?T:(t=this.shr(1).div(e).shl(1)).eq(C)?e.isNegative()?T:E:(n=this.sub(e.mul(t)),i=t.add(n.div(e)));if(e.eq(O))return this.unsigned?R:C;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=C}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var r=Math.ceil(Math.log(t)/Math.LN2),a=r<=48?1:m(2,r-48),o=h(t),s=o.mul(e);s.isNegative()||s.gt(n);)s=(o=h(t-=a,this.unsigned)).mul(e);o.isZero()&&(o=T),i=i.add(o),n=n.sub(s)}return i},N.div=N.divide,N.modulo=function(e){return d(e)||(e=b(e)),c?v((this.unsigned?c.rem_u:c.rem_s)(this.low,this.high,e.low,e.high),c.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return v(~this.low,~this.high,this.unsigned)},N.and=function(e){return d(e)||(e=b(e)),v(this.low&e.low,this.high&e.high,this.unsigned)},N.or=function(e){return d(e)||(e=b(e)),v(this.low|e.low,this.high|e.high,this.unsigned)},N.xor=function(e){return d(e)||(e=b(e)),v(this.low^e.low,this.high^e.high,this.unsigned)},N.shiftLeft=function(e){return d(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?v(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):v(0,this.low<<e-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(e){return d(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?v(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):v(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(e){if(d(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?v(this.low>>>e|t<<32-e,t>>>e,this.unsigned):v(32===e?t:t>>>e-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.toSigned=function(){return this.unsigned?v(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:v(this.low,this.high,!0)},N.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},N.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},u.fromBytes=function(e,t,n){return n?u.fromBytesLE(e,t):u.fromBytesBE(e,t)},u.fromBytesLE=function(e,t){return new u(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},u.fromBytesBE=function(e,t){return new u(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var I,D,A,U,L,M,F,B,j,J,$,V,q,W,G,H=n(s),Q={},z={},K={},Z={};function Y(){return G||(G=1,function(e){var n=e;function i(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;++r)void 0!==e[i[r]]&&n||(e[i[r]]=t[i[r]]);return e}function r(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=(D||(D=1,I=function(e,t){for(var n=new Array(arguments.length-1),i=0,r=2,a=!0;r<arguments.length;)n[i++]=arguments[r++];return new Promise((function(r,o){n[i]=function(e){if(a)if(a=!1,e)o(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];r.apply(null,t)}};try{e.apply(t||null,n)}catch(e){a&&(a=!1,o(e))}}))}),I),n.base64=(A||(A=1,function(e){var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var n=new Array(64),i=new Array(123),r=0;r<64;)i[n[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;t.encode=function(e,t,i){for(var r,a=null,o=[],s=0,c=0;t<i;){var u=e[t++];switch(c){case 0:o[s++]=n[u>>2],r=(3&u)<<4,c=1;break;case 1:o[s++]=n[r|u>>4],r=(15&u)<<2,c=2;break;case 2:o[s++]=n[r|u>>6],o[s++]=n[63&u],c=0}s>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,o)),s=0)}return c&&(o[s++]=n[r],o[s++]=61,1===c&&(o[s++]=61)),a?(s&&a.push(String.fromCharCode.apply(String,o.slice(0,s))),a.join("")):String.fromCharCode.apply(String,o.slice(0,s))};var a="invalid encoding";t.decode=function(e,t,n){for(var r,o=n,s=0,c=0;c<e.length;){var u=e.charCodeAt(c++);if(61===u&&s>1)break;if(void 0===(u=i[u]))throw Error(a);switch(s){case 0:r=u,s=1;break;case 1:t[n++]=r<<2|(48&u)>>4,r=u,s=2;break;case 2:t[n++]=(15&r)<<4|(60&u)>>2,r=u,s=3;break;case 3:t[n++]=(3&r)<<6|u,s=0}}if(1===s)throw Error(a);return n-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}(K)),K),n.EventEmitter=function(){if(L)return U;function e(){this._listeners={}}return L=1,U=e,e.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},e.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this},e.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this},U}(),n.float=function(){if(F)return M;function e(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),i=128===n[3];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3]}function a(e,i,r){t[0]=e,i[r]=n[3],i[r+1]=n[2],i[r+2]=n[1],i[r+3]=n[0]}function o(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],t[0]}function s(e,i){return n[3]=e[i],n[2]=e[i+1],n[1]=e[i+2],n[0]=e[i+3],t[0]}e.writeFloatLE=i?r:a,e.writeFloatBE=i?a:r,e.readFloatLE=i?o:s,e.readFloatBE=i?s:o}():function(){function a(e,t,n,i){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,n,i);else if(isNaN(t))e(2143289344,n,i);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,n,i);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,n,i);else{var a=Math.floor(Math.log(t)/Math.LN2);e((r<<31|a+127<<23|8388607&Math.round(t*Math.pow(2,-a)*8388608))>>>0,n,i)}}function o(e,t,n){var i=e(t,n),r=2*(i>>31)+1,a=i>>>23&255,o=8388607&i;return 255===a?o?NaN:r*(1/0):0===a?1401298464324817e-60*r*o:r*Math.pow(2,a-150)*(o+8388608)}e.writeFloatLE=a.bind(null,t),e.writeFloatBE=a.bind(null,n),e.readFloatLE=o.bind(null,i),e.readFloatBE=o.bind(null,r)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),i=128===n[7];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3],i[r+4]=n[4],i[r+5]=n[5],i[r+6]=n[6],i[r+7]=n[7]}function a(e,i,r){t[0]=e,i[r]=n[7],i[r+1]=n[6],i[r+2]=n[5],i[r+3]=n[4],i[r+4]=n[3],i[r+5]=n[2],i[r+6]=n[1],i[r+7]=n[0]}function o(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],n[4]=e[i+4],n[5]=e[i+5],n[6]=e[i+6],n[7]=e[i+7],t[0]}function s(e,i){return n[7]=e[i],n[6]=e[i+1],n[5]=e[i+2],n[4]=e[i+3],n[3]=e[i+4],n[2]=e[i+5],n[1]=e[i+6],n[0]=e[i+7],t[0]}e.writeDoubleLE=i?r:a,e.writeDoubleBE=i?a:r,e.readDoubleLE=i?o:s,e.readDoubleBE=i?s:o}():function(){function a(e,t,n,i,r,a){var o=i<0?1:0;if(o&&(i=-i),0===i)e(0,r,a+t),e(1/i>0?0:2147483648,r,a+n);else if(isNaN(i))e(0,r,a+t),e(2146959360,r,a+n);else if(i>17976931348623157e292)e(0,r,a+t),e((o<<31|2146435072)>>>0,r,a+n);else{var s;if(i<22250738585072014e-324)e((s=i/5e-324)>>>0,r,a+t),e((o<<31|s/4294967296)>>>0,r,a+n);else{var c=Math.floor(Math.log(i)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(s=i*Math.pow(2,-c))>>>0,r,a+t),e((o<<31|c+1023<<20|1048576*s&1048575)>>>0,r,a+n)}}}function o(e,t,n,i,r){var a=e(i,r+t),o=e(i,r+n),s=2*(o>>31)+1,c=o>>>20&2047,u=4294967296*(1048575&o)+a;return 2047===c?u?NaN:s*(1/0):0===c?5e-324*s*u:s*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=a.bind(null,t,0,4),e.writeDoubleBE=a.bind(null,n,4,0),e.readDoubleLE=o.bind(null,i,0,4),e.readDoubleBE=o.bind(null,r,4,0)}(),e}function t(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function n(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function r(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}return F=1,M=e(e)}(),n.inquire=j?B:(j=1,B=function(e){return null}),n.utf8=(J||(J=1,function(e){var t=e;t.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)(n=e.charCodeAt(i))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},t.read=function(e,t,n){if(n-t<1)return"";for(var i,r=null,a=[],o=0;t<n;)(i=e[t++])<128?a[o++]=i:i>191&&i<224?a[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,a[o++]=55296+(i>>10),a[o++]=56320+(1023&i)):a[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,a)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,a.slice(0,o))),r.join("")):String.fromCharCode.apply(String,a.slice(0,o))},t.write=function(e,t,n){for(var i,r,a=n,o=0;o<e.length;++o)(i=e.charCodeAt(o))<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&56320==(64512&(r=e.charCodeAt(o+1)))?(i=65536+((1023&i)<<10)+(1023&r),++o,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128);return n-a}}(Z)),Z),n.pool=V?$:(V=1,$=function(e,t,n){var i=n||8192,r=i>>>1,a=null,o=i;return function(n){if(n<1||n>r)return e(n);o+n>i&&(a=e(i),o=0);var s=t.call(a,o,o+=n);return 7&o&&(o=1+(7|o)),s}}),n.LongBits=function(){if(W)return q;W=1,q=t;var e=Y();function t(e,t){this.lo=e>>>0,this.hi=t>>>0}var n=t.zero=new t(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var i=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(e){if(0===e)return n;var i=e<0;i&&(e=-e);var r=e>>>0,a=(e-r)/4294967296>>>0;return i&&(a=~a>>>0,r=~r>>>0,++r>4294967295&&(r=0,++a>4294967295&&(a=0))),new t(r,a)},t.from=function(i){if("number"==typeof i)return t.fromNumber(i);if(e.isString(i)){if(!e.Long)return t.fromNumber(parseInt(i,10));i=e.Long.fromString(i)}return i.low||i.high?new t(i.low>>>0,i.high>>>0):n},t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},t.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var r=String.prototype.charCodeAt;return t.fromHash=function(e){return e===i?n:new t((r.call(e,0)|r.call(e,1)<<8|r.call(e,2)<<16|r.call(e,3)<<24)>>>0,(r.call(e,4)|r.call(e,5)<<8|r.call(e,6)<<16|r.call(e,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},t.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10},q}(),n.isNode=Boolean(void 0!==t&&t&&t.process&&t.process.versions&&t.process.versions.node),n.global=n.isNode&&t||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||t,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==_typeof(e)},n.isset=n.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=_typeof(n)||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var i=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(i.lo,i.hi,t):i.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=r,n.ProtocolError=r("ProtocolError"),n.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},n.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}(z)),z}var X,ee=ce,te=Y(),ne=te.LongBits,ie=te.base64,re=te.utf8;function ae(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function oe(){}function se(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ce(){this.len=0,this.head=new ae(oe,0,0),this.tail=this.head,this.states=null}var ue=function(){return te.Buffer?function(){return(ce.create=function(){return new X})()}:function(){return new ce}};function de(e,t,n){t[n]=255&e}function le(e,t){this.len=e,this.next=void 0,this.val=t}function pe(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function fe(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}ce.create=ue(),ce.alloc=function(e){return new te.Array(e)},te.Array!==Array&&(ce.alloc=te.pool(ce.alloc,te.Array.prototype.subarray)),ce.prototype._push=function(e,t,n){return this.tail=this.tail.next=new ae(e,t,n),this.len+=t,this},le.prototype=Object.create(ae.prototype),le.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},ce.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new le((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},ce.prototype.int32=function(e){return e<0?this._push(pe,10,ne.fromNumber(e)):this.uint32(e)},ce.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ce.prototype.uint64=function(e){var t=ne.from(e);return this._push(pe,t.length(),t)},ce.prototype.int64=ce.prototype.uint64,ce.prototype.sint64=function(e){var t=ne.from(e).zzEncode();return this._push(pe,t.length(),t)},ce.prototype.bool=function(e){return this._push(de,1,e?1:0)},ce.prototype.fixed32=function(e){return this._push(fe,4,e>>>0)},ce.prototype.sfixed32=ce.prototype.fixed32,ce.prototype.fixed64=function(e){var t=ne.from(e);return this._push(fe,4,t.lo)._push(fe,4,t.hi)},ce.prototype.sfixed64=ce.prototype.fixed64,ce.prototype.float=function(e){return this._push(te.float.writeFloatLE,4,e)},ce.prototype.double=function(e){return this._push(te.float.writeDoubleLE,8,e)};var he=te.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};ce.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(de,1,0);if(te.isString(e)){var n=ce.alloc(t=ie.length(e));ie.decode(e,n,0),e=n}return this.uint32(t)._push(he,t,e)},ce.prototype.string=function(e){var t=re.length(e);return t?this.uint32(t)._push(re.write,t,e):this._push(de,1,0)},ce.prototype.fork=function(){return this.states=new se(this),this.head=this.tail=new ae(oe,0,0),this.len=0,this},ce.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ae(oe,0,0),this.len=0),this},ce.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},ce.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},ce._configure=function(e){X=e,ce.create=ue(),X._configure()};var ve=be,me=ee;(be.prototype=Object.create(me.prototype)).constructor=be;var ge=Y();function be(){me.call(this)}function ke(e,t,n){e.length<40?ge.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}be._configure=function(){be.alloc=ge._Buffer_allocUnsafe,be.writeBytesBuffer=ge.Buffer&&ge.Buffer.prototype instanceof Uint8Array&&"set"===ge.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}},be.prototype.bytes=function(e){ge.isString(e)&&(e=ge._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(be.writeBytesBuffer,t,e),this},be.prototype.string=function(e){var t=ge.Buffer.byteLength(e);return this.uint32(t),t&&this._push(ke,t,e),this},be._configure();var ye,Se=Pe,we=Y(),Ce=we.LongBits,Re=we.utf8;function Te(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Pe(e){this.buf=e,this.pos=0,this.len=e.length}var Ee,_e="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Pe(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Pe(e);throw Error("illegal buffer")},xe=function(){return we.Buffer?function(e){return(Pe.create=function(e){return we.Buffer.isBuffer(e)?new ye(e):_e(e)})(e)}:_e};function Oe(){var e=new Ce(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw Te(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Te(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function Ne(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Ie(){if(this.pos+8>this.len)throw Te(this,8);return new Ce(Ne(this.buf,this.pos+=4),Ne(this.buf,this.pos+=4))}Pe.create=xe(),Pe.prototype._slice=we.Array.prototype.subarray||we.Array.prototype.slice,Pe.prototype.uint32=(Ee=4294967295,function(){if(Ee=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return Ee;if(Ee=(Ee|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return Ee;if(Ee=(Ee|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return Ee;if(Ee=(Ee|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return Ee;if(Ee=(Ee|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return Ee;if((this.pos+=5)>this.len)throw this.pos=this.len,Te(this,10);return Ee}),Pe.prototype.int32=function(){return 0|this.uint32()},Pe.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Pe.prototype.bool=function(){return 0!==this.uint32()},Pe.prototype.fixed32=function(){if(this.pos+4>this.len)throw Te(this,4);return Ne(this.buf,this.pos+=4)},Pe.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Te(this,4);return 0|Ne(this.buf,this.pos+=4)},Pe.prototype.float=function(){if(this.pos+4>this.len)throw Te(this,4);var e=we.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Pe.prototype.double=function(){if(this.pos+8>this.len)throw Te(this,4);var e=we.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Pe.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Te(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},Pe.prototype.string=function(){var e=this.bytes();return Re.read(e,0,e.length)},Pe.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw Te(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Te(this)}while(128&this.buf[this.pos++]);return this},Pe.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Pe._configure=function(e){ye=e,Pe.create=xe(),ye._configure();var t=we.Long?"toLong":"toNumber";we.merge(Pe.prototype,{int64:function(){return Oe.call(this)[t](!1)},uint64:function(){return Oe.call(this)[t](!0)},sint64:function(){return Oe.call(this).zzDecode()[t](!1)},fixed64:function(){return Ie.call(this)[t](!0)},sfixed64:function(){return Ie.call(this)[t](!1)}})};var De=Le,Ae=Se;(Le.prototype=Object.create(Ae.prototype)).constructor=Le;var Ue=Y();function Le(e){Ae.call(this,e)}Le._configure=function(){Ue.Buffer&&(Le.prototype._slice=Ue.Buffer.prototype.slice)},Le.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Le._configure();var Me={},Fe=je,Be=Y();function je(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");Be.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(je.prototype=Object.create(Be.EventEmitter.prototype)).constructor=je,je.prototype.rpcCall=function e(t,n,i,r,a){if(!r)throw TypeError("request must be specified");var o=this;if(!a)return Be.asPromise(e,o,t,n,i,r);if(o.rpcImpl)try{return o.rpcImpl(t,n[o.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(e,n){if(e)return o.emit("error",e,t),a(e);if(null!==n){if(!(n instanceof i))try{n=i[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",n,t),a(null,n)}o.end(!0)}))}catch(e){return o.emit("error",e,t),void setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},je.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},function(e){e.Service=Fe}(Me);var Je={};!function(e){var t=e;function n(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=ee,t.BufferWriter=ve,t.Reader=Se,t.BufferReader=De,t.util=Y(),t.rpc=Me,t.roots=Je,t.configure=n,n()}(Q);var $e,Ve,qe,We,Ge,He,Qe,ze,Ke,Ze,Ye,Xe,et,tt,nt=n(Q);function it(e){switch(e){case 0:case"AUDIO":return qe.AUDIO;case 1:case"VIDEO":return qe.VIDEO;case 2:case"DATA":return qe.DATA;default:return qe.UNRECOGNIZED}}function rt(e){switch(e){case qe.AUDIO:return"AUDIO";case qe.VIDEO:return"VIDEO";case qe.DATA:return"DATA";case qe.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function at(e){switch(e){case 0:case"UNKNOWN":return We.UNKNOWN;case 1:case"CAMERA":return We.CAMERA;case 2:case"MICROPHONE":return We.MICROPHONE;case 3:case"SCREEN_SHARE":return We.SCREEN_SHARE;case 4:case"SCREEN_SHARE_AUDIO":return We.SCREEN_SHARE_AUDIO;default:return We.UNRECOGNIZED}}function ot(e){switch(e){case We.UNKNOWN:return"UNKNOWN";case We.CAMERA:return"CAMERA";case We.MICROPHONE:return"MICROPHONE";case We.SCREEN_SHARE:return"SCREEN_SHARE";case We.SCREEN_SHARE_AUDIO:return"SCREEN_SHARE_AUDIO";case We.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function st(t){switch(t){case 0:case"LOW":return e.VideoQuality.LOW;case 1:case"MEDIUM":return e.VideoQuality.MEDIUM;case 2:case"HIGH":return e.VideoQuality.HIGH;case 3:case"OFF":return e.VideoQuality.OFF;default:return e.VideoQuality.UNRECOGNIZED}}function ct(t){switch(t){case e.VideoQuality.LOW:return"LOW";case e.VideoQuality.MEDIUM:return"MEDIUM";case e.VideoQuality.HIGH:return"HIGH";case e.VideoQuality.OFF:return"OFF";case e.VideoQuality.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function ut(e){switch(e){case 0:case"POOR":return He.POOR;case 1:case"GOOD":return He.GOOD;case 2:case"EXCELLENT":return He.EXCELLENT;default:return He.UNRECOGNIZED}}function dt(e){switch(e){case 0:case"UNSET":return Qe.UNSET;case 1:case"DISABLED":return Qe.DISABLED;case 2:case"ENABLED":return Qe.ENABLED;default:return Qe.UNRECOGNIZED}}function lt(e){switch(e){case Qe.UNSET:return"UNSET";case Qe.DISABLED:return"DISABLED";case Qe.ENABLED:return"ENABLED";case Qe.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function pt(t){switch(t){case 0:case"UNKNOWN_REASON":return e.DisconnectReason.UNKNOWN_REASON;case 1:case"CLIENT_INITIATED":return e.DisconnectReason.CLIENT_INITIATED;case 2:case"DUPLICATE_IDENTITY":return e.DisconnectReason.DUPLICATE_IDENTITY;case 3:case"SERVER_SHUTDOWN":return e.DisconnectReason.SERVER_SHUTDOWN;case 4:case"PARTICIPANT_REMOVED":return e.DisconnectReason.PARTICIPANT_REMOVED;case 5:case"ROOM_DELETED":return e.DisconnectReason.ROOM_DELETED;case 6:case"STATE_MISMATCH":return e.DisconnectReason.STATE_MISMATCH;case 7:case"JOIN_FAILURE":return e.DisconnectReason.JOIN_FAILURE;default:return e.DisconnectReason.UNRECOGNIZED}}function ft(e){switch(e){case 0:case"JOINING":return Ze.JOINING;case 1:case"JOINED":return Ze.JOINED;case 2:case"ACTIVE":return Ze.ACTIVE;case 3:case"DISCONNECTED":return Ze.DISCONNECTED;default:return Ze.UNRECOGNIZED}}function ht(e){switch(e){case 0:case"NONE":return Ye.NONE;case 1:case"GCM":return Ye.GCM;case 2:case"CUSTOM":return Ye.CUSTOM;default:return Ye.UNRECOGNIZED}}function vt(e){switch(e){case Ye.NONE:return"NONE";case Ye.GCM:return"GCM";case Ye.CUSTOM:return"CUSTOM";case Ye.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function mt(t){switch(t){case 0:case"RELIABLE":return e.DataPacket_Kind.RELIABLE;case 1:case"LOSSY":return e.DataPacket_Kind.LOSSY;default:return e.DataPacket_Kind.UNRECOGNIZED}}function gt(e){switch(e){case 0:case"Standard":return et.Standard;case 1:case"Cloud":return et.Cloud;default:return et.UNRECOGNIZED}}function bt(e){switch(e){case 0:case"UNKNOWN":return tt.UNKNOWN;case 1:case"JS":return tt.JS;case 2:case"SWIFT":return tt.SWIFT;case 3:case"ANDROID":return tt.ANDROID;case 4:case"FLUTTER":return tt.FLUTTER;case 5:case"GO":return tt.GO;case 6:case"UNITY":return tt.UNITY;case 7:case"REACT_NATIVE":return tt.REACT_NATIVE;case 8:case"RUST":return tt.RUST;default:return tt.UNRECOGNIZED}}(function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})(),nt.util.Long!==H&&(nt.util.Long=H,nt.configure()),function(e){e[e.DEFAULT_AC=0]="DEFAULT_AC",e[e.OPUS=1]="OPUS",e[e.AAC=2]="AAC",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}($e||($e={})),function(e){e[e.DEFAULT_VC=0]="DEFAULT_VC",e[e.H264_BASELINE=1]="H264_BASELINE",e[e.H264_MAIN=2]="H264_MAIN",e[e.H264_HIGH=3]="H264_HIGH",e[e.VP8=4]="VP8",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(Ve||(Ve={})),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.DATA=2]="DATA",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(qe||(qe={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CAMERA=1]="CAMERA",e[e.MICROPHONE=2]="MICROPHONE",e[e.SCREEN_SHARE=3]="SCREEN_SHARE",e[e.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(We||(We={})),e.VideoQuality=void 0,(Ge=e.VideoQuality||(e.VideoQuality={}))[Ge.LOW=0]="LOW",Ge[Ge.MEDIUM=1]="MEDIUM",Ge[Ge.HIGH=2]="HIGH",Ge[Ge.OFF=3]="OFF",Ge[Ge.UNRECOGNIZED=-1]="UNRECOGNIZED",function(e){e[e.POOR=0]="POOR",e[e.GOOD=1]="GOOD",e[e.EXCELLENT=2]="EXCELLENT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(He||(He={})),function(e){e[e.UNSET=0]="UNSET",e[e.DISABLED=1]="DISABLED",e[e.ENABLED=2]="ENABLED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(Qe||(Qe={})),e.DisconnectReason=void 0,(ze=e.DisconnectReason||(e.DisconnectReason={}))[ze.UNKNOWN_REASON=0]="UNKNOWN_REASON",ze[ze.CLIENT_INITIATED=1]="CLIENT_INITIATED",ze[ze.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",ze[ze.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",ze[ze.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",ze[ze.ROOM_DELETED=5]="ROOM_DELETED",ze[ze.STATE_MISMATCH=6]="STATE_MISMATCH",ze[ze.JOIN_FAILURE=7]="JOIN_FAILURE",ze[ze.UNRECOGNIZED=-1]="UNRECOGNIZED",function(e){e[e.RR_UNKOWN=0]="RR_UNKOWN",e[e.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",e[e.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",e[e.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",e[e.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(Ke||(Ke={})),function(e){e[e.JOINING=0]="JOINING",e[e.JOINED=1]="JOINED",e[e.ACTIVE=2]="ACTIVE",e[e.DISCONNECTED=3]="DISCONNECTED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(Ze||(Ze={})),function(e){e[e.NONE=0]="NONE",e[e.GCM=1]="GCM",e[e.CUSTOM=2]="CUSTOM",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(Ye||(Ye={})),e.DataPacket_Kind=void 0,(Xe=e.DataPacket_Kind||(e.DataPacket_Kind={}))[Xe.RELIABLE=0]="RELIABLE",Xe[Xe.LOSSY=1]="LOSSY",Xe[Xe.UNRECOGNIZED=-1]="UNRECOGNIZED",function(e){e[e.Standard=0]="Standard",e[e.Cloud=1]="Cloud",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(et||(et={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JS=1]="JS",e[e.SWIFT=2]="SWIFT",e[e.ANDROID=3]="ANDROID",e[e.FLUTTER=4]="FLUTTER",e[e.GO=5]="GO",e[e.UNITY=6]="UNITY",e[e.REACT_NATIVE=7]="REACT_NATIVE",e[e.RUST=8]="RUST",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(tt||(tt={}));var kt={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.sid&&t.uint32(10).string(e.sid),""!==e.name&&t.uint32(18).string(e.name),0!==e.emptyTimeout&&t.uint32(24).uint32(e.emptyTimeout),0!==e.maxParticipants&&t.uint32(32).uint32(e.maxParticipants),0!==e.creationTime&&t.uint32(40).int64(e.creationTime),""!==e.turnPassword&&t.uint32(50).string(e.turnPassword);var n,i=_createForOfIteratorHelper(e.enabledCodecs);try{for(i.s();!(n=i.n()).done;){var r=n.value;yt.encode(r,t.uint32(58).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return""!==e.metadata&&t.uint32(66).string(e.metadata),0!==e.numParticipants&&t.uint32(72).uint32(e.numParticipants),0!==e.numPublishers&&t.uint32(88).uint32(e.numPublishers),!0===e.activeRecording&&t.uint32(80).bool(e.activeRecording),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={sid:"",name:"",emptyTimeout:0,maxParticipants:0,creationTime:0,turnPassword:"",enabledCodecs:[],metadata:"",numParticipants:0,numPublishers:0,activeRecording:!1};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.sid=n.string();continue;case 2:if(18!=a)break;r.name=n.string();continue;case 3:if(24!=a)break;r.emptyTimeout=n.uint32();continue;case 4:if(32!=a)break;r.maxParticipants=n.uint32();continue;case 5:if(40!=a)break;r.creationTime=Bt(n.int64());continue;case 6:if(50!=a)break;r.turnPassword=n.string();continue;case 7:if(58!=a)break;r.enabledCodecs.push(yt.decode(n,n.uint32()));continue;case 8:if(66!=a)break;r.metadata=n.string();continue;case 9:if(72!=a)break;r.numParticipants=n.uint32();continue;case 11:if(88!=a)break;r.numPublishers=n.uint32();continue;case 10:if(80!=a)break;r.activeRecording=n.bool();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{sid:jt(e.sid)?String(e.sid):"",name:jt(e.name)?String(e.name):"",emptyTimeout:jt(e.emptyTimeout)?Number(e.emptyTimeout):0,maxParticipants:jt(e.maxParticipants)?Number(e.maxParticipants):0,creationTime:jt(e.creationTime)?Number(e.creationTime):0,turnPassword:jt(e.turnPassword)?String(e.turnPassword):"",enabledCodecs:Array.isArray(null==e?void 0:e.enabledCodecs)?e.enabledCodecs.map((function(e){return yt.fromJSON(e)})):[],metadata:jt(e.metadata)?String(e.metadata):"",numParticipants:jt(e.numParticipants)?Number(e.numParticipants):0,numPublishers:jt(e.numPublishers)?Number(e.numPublishers):0,activeRecording:!!jt(e.activeRecording)&&Boolean(e.activeRecording)}},toJSON:function(e){var t={};return void 0!==e.sid&&(t.sid=e.sid),void 0!==e.name&&(t.name=e.name),void 0!==e.emptyTimeout&&(t.emptyTimeout=Math.round(e.emptyTimeout)),void 0!==e.maxParticipants&&(t.maxParticipants=Math.round(e.maxParticipants)),void 0!==e.creationTime&&(t.creationTime=Math.round(e.creationTime)),void 0!==e.turnPassword&&(t.turnPassword=e.turnPassword),e.enabledCodecs?t.enabledCodecs=e.enabledCodecs.map((function(e){return e?yt.toJSON(e):void 0})):t.enabledCodecs=[],void 0!==e.metadata&&(t.metadata=e.metadata),void 0!==e.numParticipants&&(t.numParticipants=Math.round(e.numParticipants)),void 0!==e.numPublishers&&(t.numPublishers=Math.round(e.numPublishers)),void 0!==e.activeRecording&&(t.activeRecording=e.activeRecording),t},create:function(e){return kt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u,d,l,p={sid:"",name:"",emptyTimeout:0,maxParticipants:0,creationTime:0,turnPassword:"",enabledCodecs:[],metadata:"",numParticipants:0,numPublishers:0,activeRecording:!1};return p.sid=null!==(t=e.sid)&&void 0!==t?t:"",p.name=null!==(n=e.name)&&void 0!==n?n:"",p.emptyTimeout=null!==(i=e.emptyTimeout)&&void 0!==i?i:0,p.maxParticipants=null!==(r=e.maxParticipants)&&void 0!==r?r:0,p.creationTime=null!==(a=e.creationTime)&&void 0!==a?a:0,p.turnPassword=null!==(o=e.turnPassword)&&void 0!==o?o:"",p.enabledCodecs=(null===(s=e.enabledCodecs)||void 0===s?void 0:s.map((function(e){return yt.fromPartial(e)})))||[],p.metadata=null!==(c=e.metadata)&&void 0!==c?c:"",p.numParticipants=null!==(u=e.numParticipants)&&void 0!==u?u:0,p.numPublishers=null!==(d=e.numPublishers)&&void 0!==d?d:0,p.activeRecording=null!==(l=e.activeRecording)&&void 0!==l&&l,p}},yt={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.mime&&t.uint32(10).string(e.mime),""!==e.fmtpLine&&t.uint32(18).string(e.fmtpLine),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={mime:"",fmtpLine:""};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.mime=n.string();continue;case 2:if(18!=a)break;r.fmtpLine=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{mime:jt(e.mime)?String(e.mime):"",fmtpLine:jt(e.fmtpLine)?String(e.fmtpLine):""}},toJSON:function(e){var t={};return void 0!==e.mime&&(t.mime=e.mime),void 0!==e.fmtpLine&&(t.fmtpLine=e.fmtpLine),t},create:function(e){return yt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={mime:"",fmtpLine:""};return i.mime=null!==(t=e.mime)&&void 0!==t?t:"",i.fmtpLine=null!==(n=e.fmtpLine)&&void 0!==n?n:"",i}},St={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();!0===e.canSubscribe&&t.uint32(8).bool(e.canSubscribe),!0===e.canPublish&&t.uint32(16).bool(e.canPublish),!0===e.canPublishData&&t.uint32(24).bool(e.canPublishData),t.uint32(74).fork();var n,i=_createForOfIteratorHelper(e.canPublishSources);try{for(i.s();!(n=i.n()).done;){var r=n.value;t.int32(r)}}catch(e){i.e(e)}finally{i.f()}return t.ldelim(),!0===e.hidden&&t.uint32(56).bool(e.hidden),!0===e.recorder&&t.uint32(64).bool(e.recorder),!0===e.canUpdateMetadata&&t.uint32(80).bool(e.canUpdateMetadata),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={canSubscribe:!1,canPublish:!1,canPublishData:!1,canPublishSources:[],hidden:!1,recorder:!1,canUpdateMetadata:!1};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.canSubscribe=n.bool();continue;case 2:if(16!=a)break;r.canPublish=n.bool();continue;case 3:if(24!=a)break;r.canPublishData=n.bool();continue;case 9:if(72==a){r.canPublishSources.push(n.int32());continue}if(74==a){for(var o=n.uint32()+n.pos;n.pos<o;)r.canPublishSources.push(n.int32());continue}break;case 7:if(56!=a)break;r.hidden=n.bool();continue;case 8:if(64!=a)break;r.recorder=n.bool();continue;case 10:if(80!=a)break;r.canUpdateMetadata=n.bool();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{canSubscribe:!!jt(e.canSubscribe)&&Boolean(e.canSubscribe),canPublish:!!jt(e.canPublish)&&Boolean(e.canPublish),canPublishData:!!jt(e.canPublishData)&&Boolean(e.canPublishData),canPublishSources:Array.isArray(null==e?void 0:e.canPublishSources)?e.canPublishSources.map((function(e){return at(e)})):[],hidden:!!jt(e.hidden)&&Boolean(e.hidden),recorder:!!jt(e.recorder)&&Boolean(e.recorder),canUpdateMetadata:!!jt(e.canUpdateMetadata)&&Boolean(e.canUpdateMetadata)}},toJSON:function(e){var t={};return void 0!==e.canSubscribe&&(t.canSubscribe=e.canSubscribe),void 0!==e.canPublish&&(t.canPublish=e.canPublish),void 0!==e.canPublishData&&(t.canPublishData=e.canPublishData),e.canPublishSources?t.canPublishSources=e.canPublishSources.map((function(e){return ot(e)})):t.canPublishSources=[],void 0!==e.hidden&&(t.hidden=e.hidden),void 0!==e.recorder&&(t.recorder=e.recorder),void 0!==e.canUpdateMetadata&&(t.canUpdateMetadata=e.canUpdateMetadata),t},create:function(e){return St.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c={canSubscribe:!1,canPublish:!1,canPublishData:!1,canPublishSources:[],hidden:!1,recorder:!1,canUpdateMetadata:!1};return c.canSubscribe=null!==(t=e.canSubscribe)&&void 0!==t&&t,c.canPublish=null!==(n=e.canPublish)&&void 0!==n&&n,c.canPublishData=null!==(i=e.canPublishData)&&void 0!==i&&i,c.canPublishSources=(null===(r=e.canPublishSources)||void 0===r?void 0:r.map((function(e){return e})))||[],c.hidden=null!==(a=e.hidden)&&void 0!==a&&a,c.recorder=null!==(o=e.recorder)&&void 0!==o&&o,c.canUpdateMetadata=null!==(s=e.canUpdateMetadata)&&void 0!==s&&s,c}},wt={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.sid&&t.uint32(10).string(e.sid),""!==e.identity&&t.uint32(18).string(e.identity),0!==e.state&&t.uint32(24).int32(e.state);var n,i=_createForOfIteratorHelper(e.tracks);try{for(i.s();!(n=i.n()).done;){var r=n.value;Rt.encode(r,t.uint32(34).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return""!==e.metadata&&t.uint32(42).string(e.metadata),0!==e.joinedAt&&t.uint32(48).int64(e.joinedAt),""!==e.name&&t.uint32(74).string(e.name),0!==e.version&&t.uint32(80).uint32(e.version),void 0!==e.permission&&St.encode(e.permission,t.uint32(90).fork()).ldelim(),""!==e.region&&t.uint32(98).string(e.region),!0===e.isPublisher&&t.uint32(104).bool(e.isPublisher),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={sid:"",identity:"",state:0,tracks:[],metadata:"",joinedAt:0,name:"",version:0,permission:void 0,region:"",isPublisher:!1};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.sid=n.string();continue;case 2:if(18!=a)break;r.identity=n.string();continue;case 3:if(24!=a)break;r.state=n.int32();continue;case 4:if(34!=a)break;r.tracks.push(Rt.decode(n,n.uint32()));continue;case 5:if(42!=a)break;r.metadata=n.string();continue;case 6:if(48!=a)break;r.joinedAt=Bt(n.int64());continue;case 9:if(74!=a)break;r.name=n.string();continue;case 10:if(80!=a)break;r.version=n.uint32();continue;case 11:if(90!=a)break;r.permission=St.decode(n,n.uint32());continue;case 12:if(98!=a)break;r.region=n.string();continue;case 13:if(104!=a)break;r.isPublisher=n.bool();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{sid:jt(e.sid)?String(e.sid):"",identity:jt(e.identity)?String(e.identity):"",state:jt(e.state)?ft(e.state):0,tracks:Array.isArray(null==e?void 0:e.tracks)?e.tracks.map((function(e){return Rt.fromJSON(e)})):[],metadata:jt(e.metadata)?String(e.metadata):"",joinedAt:jt(e.joinedAt)?Number(e.joinedAt):0,name:jt(e.name)?String(e.name):"",version:jt(e.version)?Number(e.version):0,permission:jt(e.permission)?St.fromJSON(e.permission):void 0,region:jt(e.region)?String(e.region):"",isPublisher:!!jt(e.isPublisher)&&Boolean(e.isPublisher)}},toJSON:function(e){var t={};return void 0!==e.sid&&(t.sid=e.sid),void 0!==e.identity&&(t.identity=e.identity),void 0!==e.state&&(t.state=function(e){switch(e){case Ze.JOINING:return"JOINING";case Ze.JOINED:return"JOINED";case Ze.ACTIVE:return"ACTIVE";case Ze.DISCONNECTED:return"DISCONNECTED";case Ze.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.state)),e.tracks?t.tracks=e.tracks.map((function(e){return e?Rt.toJSON(e):void 0})):t.tracks=[],void 0!==e.metadata&&(t.metadata=e.metadata),void 0!==e.joinedAt&&(t.joinedAt=Math.round(e.joinedAt)),void 0!==e.name&&(t.name=e.name),void 0!==e.version&&(t.version=Math.round(e.version)),void 0!==e.permission&&(t.permission=e.permission?St.toJSON(e.permission):void 0),void 0!==e.region&&(t.region=e.region),void 0!==e.isPublisher&&(t.isPublisher=e.isPublisher),t},create:function(e){return wt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u,d,l={sid:"",identity:"",state:0,tracks:[],metadata:"",joinedAt:0,name:"",version:0,permission:void 0,region:"",isPublisher:!1};return l.sid=null!==(t=e.sid)&&void 0!==t?t:"",l.identity=null!==(n=e.identity)&&void 0!==n?n:"",l.state=null!==(i=e.state)&&void 0!==i?i:0,l.tracks=(null===(r=e.tracks)||void 0===r?void 0:r.map((function(e){return Rt.fromPartial(e)})))||[],l.metadata=null!==(a=e.metadata)&&void 0!==a?a:"",l.joinedAt=null!==(o=e.joinedAt)&&void 0!==o?o:0,l.name=null!==(s=e.name)&&void 0!==s?s:"",l.version=null!==(c=e.version)&&void 0!==c?c:0,l.permission=void 0!==e.permission&&null!==e.permission?St.fromPartial(e.permission):void 0,l.region=null!==(u=e.region)&&void 0!==u?u:"",l.isPublisher=null!==(d=e.isPublisher)&&void 0!==d&&d,l}},Ct={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.mimeType&&t.uint32(10).string(e.mimeType),""!==e.mid&&t.uint32(18).string(e.mid),""!==e.cid&&t.uint32(26).string(e.cid);var n,i=_createForOfIteratorHelper(e.layers);try{for(i.s();!(n=i.n()).done;){var r=n.value;Tt.encode(r,t.uint32(34).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={mimeType:"",mid:"",cid:"",layers:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.mimeType=n.string();continue;case 2:if(18!=a)break;r.mid=n.string();continue;case 3:if(26!=a)break;r.cid=n.string();continue;case 4:if(34!=a)break;r.layers.push(Tt.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{mimeType:jt(e.mimeType)?String(e.mimeType):"",mid:jt(e.mid)?String(e.mid):"",cid:jt(e.cid)?String(e.cid):"",layers:Array.isArray(null==e?void 0:e.layers)?e.layers.map((function(e){return Tt.fromJSON(e)})):[]}},toJSON:function(e){var t={};return void 0!==e.mimeType&&(t.mimeType=e.mimeType),void 0!==e.mid&&(t.mid=e.mid),void 0!==e.cid&&(t.cid=e.cid),e.layers?t.layers=e.layers.map((function(e){return e?Tt.toJSON(e):void 0})):t.layers=[],t},create:function(e){return Ct.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a={mimeType:"",mid:"",cid:"",layers:[]};return a.mimeType=null!==(t=e.mimeType)&&void 0!==t?t:"",a.mid=null!==(n=e.mid)&&void 0!==n?n:"",a.cid=null!==(i=e.cid)&&void 0!==i?i:"",a.layers=(null===(r=e.layers)||void 0===r?void 0:r.map((function(e){return Tt.fromPartial(e)})))||[],a}},Rt={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.sid&&t.uint32(10).string(e.sid),0!==e.type&&t.uint32(16).int32(e.type),""!==e.name&&t.uint32(26).string(e.name),!0===e.muted&&t.uint32(32).bool(e.muted),0!==e.width&&t.uint32(40).uint32(e.width),0!==e.height&&t.uint32(48).uint32(e.height),!0===e.simulcast&&t.uint32(56).bool(e.simulcast),!0===e.disableDtx&&t.uint32(64).bool(e.disableDtx),0!==e.source&&t.uint32(72).int32(e.source);var n,i=_createForOfIteratorHelper(e.layers);try{for(i.s();!(n=i.n()).done;){var r=n.value;Tt.encode(r,t.uint32(82).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}""!==e.mimeType&&t.uint32(90).string(e.mimeType),""!==e.mid&&t.uint32(98).string(e.mid);var a,o=_createForOfIteratorHelper(e.codecs);try{for(o.s();!(a=o.n()).done;){var s=a.value;Ct.encode(s,t.uint32(106).fork()).ldelim()}}catch(e){o.e(e)}finally{o.f()}return!0===e.stereo&&t.uint32(112).bool(e.stereo),!0===e.disableRed&&t.uint32(120).bool(e.disableRed),0!==e.encryption&&t.uint32(128).int32(e.encryption),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={sid:"",type:0,name:"",muted:!1,width:0,height:0,simulcast:!1,disableDtx:!1,source:0,layers:[],mimeType:"",mid:"",codecs:[],stereo:!1,disableRed:!1,encryption:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.sid=n.string();continue;case 2:if(16!=a)break;r.type=n.int32();continue;case 3:if(26!=a)break;r.name=n.string();continue;case 4:if(32!=a)break;r.muted=n.bool();continue;case 5:if(40!=a)break;r.width=n.uint32();continue;case 6:if(48!=a)break;r.height=n.uint32();continue;case 7:if(56!=a)break;r.simulcast=n.bool();continue;case 8:if(64!=a)break;r.disableDtx=n.bool();continue;case 9:if(72!=a)break;r.source=n.int32();continue;case 10:if(82!=a)break;r.layers.push(Tt.decode(n,n.uint32()));continue;case 11:if(90!=a)break;r.mimeType=n.string();continue;case 12:if(98!=a)break;r.mid=n.string();continue;case 13:if(106!=a)break;r.codecs.push(Ct.decode(n,n.uint32()));continue;case 14:if(112!=a)break;r.stereo=n.bool();continue;case 15:if(120!=a)break;r.disableRed=n.bool();continue;case 16:if(128!=a)break;r.encryption=n.int32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{sid:jt(e.sid)?String(e.sid):"",type:jt(e.type)?it(e.type):0,name:jt(e.name)?String(e.name):"",muted:!!jt(e.muted)&&Boolean(e.muted),width:jt(e.width)?Number(e.width):0,height:jt(e.height)?Number(e.height):0,simulcast:!!jt(e.simulcast)&&Boolean(e.simulcast),disableDtx:!!jt(e.disableDtx)&&Boolean(e.disableDtx),source:jt(e.source)?at(e.source):0,layers:Array.isArray(null==e?void 0:e.layers)?e.layers.map((function(e){return Tt.fromJSON(e)})):[],mimeType:jt(e.mimeType)?String(e.mimeType):"",mid:jt(e.mid)?String(e.mid):"",codecs:Array.isArray(null==e?void 0:e.codecs)?e.codecs.map((function(e){return Ct.fromJSON(e)})):[],stereo:!!jt(e.stereo)&&Boolean(e.stereo),disableRed:!!jt(e.disableRed)&&Boolean(e.disableRed),encryption:jt(e.encryption)?ht(e.encryption):0}},toJSON:function(e){var t={};return void 0!==e.sid&&(t.sid=e.sid),void 0!==e.type&&(t.type=rt(e.type)),void 0!==e.name&&(t.name=e.name),void 0!==e.muted&&(t.muted=e.muted),void 0!==e.width&&(t.width=Math.round(e.width)),void 0!==e.height&&(t.height=Math.round(e.height)),void 0!==e.simulcast&&(t.simulcast=e.simulcast),void 0!==e.disableDtx&&(t.disableDtx=e.disableDtx),void 0!==e.source&&(t.source=ot(e.source)),e.layers?t.layers=e.layers.map((function(e){return e?Tt.toJSON(e):void 0})):t.layers=[],void 0!==e.mimeType&&(t.mimeType=e.mimeType),void 0!==e.mid&&(t.mid=e.mid),e.codecs?t.codecs=e.codecs.map((function(e){return e?Ct.toJSON(e):void 0})):t.codecs=[],void 0!==e.stereo&&(t.stereo=e.stereo),void 0!==e.disableRed&&(t.disableRed=e.disableRed),void 0!==e.encryption&&(t.encryption=vt(e.encryption)),t},create:function(e){return Rt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u,d,l,p,f,h,v,m,g={sid:"",type:0,name:"",muted:!1,width:0,height:0,simulcast:!1,disableDtx:!1,source:0,layers:[],mimeType:"",mid:"",codecs:[],stereo:!1,disableRed:!1,encryption:0};return g.sid=null!==(t=e.sid)&&void 0!==t?t:"",g.type=null!==(n=e.type)&&void 0!==n?n:0,g.name=null!==(i=e.name)&&void 0!==i?i:"",g.muted=null!==(r=e.muted)&&void 0!==r&&r,g.width=null!==(a=e.width)&&void 0!==a?a:0,g.height=null!==(o=e.height)&&void 0!==o?o:0,g.simulcast=null!==(s=e.simulcast)&&void 0!==s&&s,g.disableDtx=null!==(c=e.disableDtx)&&void 0!==c&&c,g.source=null!==(u=e.source)&&void 0!==u?u:0,g.layers=(null===(d=e.layers)||void 0===d?void 0:d.map((function(e){return Tt.fromPartial(e)})))||[],g.mimeType=null!==(l=e.mimeType)&&void 0!==l?l:"",g.mid=null!==(p=e.mid)&&void 0!==p?p:"",g.codecs=(null===(f=e.codecs)||void 0===f?void 0:f.map((function(e){return Ct.fromPartial(e)})))||[],g.stereo=null!==(h=e.stereo)&&void 0!==h&&h,g.disableRed=null!==(v=e.disableRed)&&void 0!==v&&v,g.encryption=null!==(m=e.encryption)&&void 0!==m?m:0,g}},Tt={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return 0!==e.quality&&t.uint32(8).int32(e.quality),0!==e.width&&t.uint32(16).uint32(e.width),0!==e.height&&t.uint32(24).uint32(e.height),0!==e.bitrate&&t.uint32(32).uint32(e.bitrate),0!==e.ssrc&&t.uint32(40).uint32(e.ssrc),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={quality:0,width:0,height:0,bitrate:0,ssrc:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.quality=n.int32();continue;case 2:if(16!=a)break;r.width=n.uint32();continue;case 3:if(24!=a)break;r.height=n.uint32();continue;case 4:if(32!=a)break;r.bitrate=n.uint32();continue;case 5:if(40!=a)break;r.ssrc=n.uint32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{quality:jt(e.quality)?st(e.quality):0,width:jt(e.width)?Number(e.width):0,height:jt(e.height)?Number(e.height):0,bitrate:jt(e.bitrate)?Number(e.bitrate):0,ssrc:jt(e.ssrc)?Number(e.ssrc):0}},toJSON:function(e){var t={};return void 0!==e.quality&&(t.quality=ct(e.quality)),void 0!==e.width&&(t.width=Math.round(e.width)),void 0!==e.height&&(t.height=Math.round(e.height)),void 0!==e.bitrate&&(t.bitrate=Math.round(e.bitrate)),void 0!==e.ssrc&&(t.ssrc=Math.round(e.ssrc)),t},create:function(e){return Tt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o={quality:0,width:0,height:0,bitrate:0,ssrc:0};return o.quality=null!==(t=e.quality)&&void 0!==t?t:0,o.width=null!==(n=e.width)&&void 0!==n?n:0,o.height=null!==(i=e.height)&&void 0!==i?i:0,o.bitrate=null!==(r=e.bitrate)&&void 0!==r?r:0,o.ssrc=null!==(a=e.ssrc)&&void 0!==a?a:0,o}},Pt={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();switch(0!==e.kind&&n.uint32(8).int32(e.kind),null===(t=e.value)||void 0===t?void 0:t.$case){case"user":Ot.encode(e.value.user,n.uint32(18).fork()).ldelim();break;case"speaker":Et.encode(e.value.speaker,n.uint32(26).fork()).ldelim()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={kind:0,value:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.kind=n.int32();continue;case 2:if(18!=a)break;r.value={$case:"user",user:Ot.decode(n,n.uint32())};continue;case 3:if(26!=a)break;r.value={$case:"speaker",speaker:Et.decode(n,n.uint32())};continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{kind:jt(e.kind)?mt(e.kind):0,value:jt(e.user)?{$case:"user",user:Ot.fromJSON(e.user)}:jt(e.speaker)?{$case:"speaker",speaker:Et.fromJSON(e.speaker)}:void 0}},toJSON:function(t){var n,i,r,a,o,s,c={};return void 0!==t.kind&&(c.kind=function(t){switch(t){case e.DataPacket_Kind.RELIABLE:return"RELIABLE";case e.DataPacket_Kind.LOSSY:return"LOSSY";case e.DataPacket_Kind.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(t.kind)),"user"===(null===(n=t.value)||void 0===n?void 0:n.$case)&&(c.user=(null===(i=t.value)||void 0===i?void 0:i.user)?Ot.toJSON(null===(r=t.value)||void 0===r?void 0:r.user):void 0),"speaker"===(null===(a=t.value)||void 0===a?void 0:a.$case)&&(c.speaker=(null===(o=t.value)||void 0===o?void 0:o.speaker)?Et.toJSON(null===(s=t.value)||void 0===s?void 0:s.speaker):void 0),c},create:function(e){return Pt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c={kind:0,value:void 0};return c.kind=null!==(t=e.kind)&&void 0!==t?t:0,"user"===(null===(n=e.value)||void 0===n?void 0:n.$case)&&void 0!==(null===(i=e.value)||void 0===i?void 0:i.user)&&null!==(null===(r=e.value)||void 0===r?void 0:r.user)&&(c.value={$case:"user",user:Ot.fromPartial(e.value.user)}),"speaker"===(null===(a=e.value)||void 0===a?void 0:a.$case)&&void 0!==(null===(o=e.value)||void 0===o?void 0:o.speaker)&&null!==(null===(s=e.value)||void 0===s?void 0:s.speaker)&&(c.value={$case:"speaker",speaker:Et.fromPartial(e.value.speaker)}),c}},Et={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.speakers);try{for(i.s();!(t=i.n()).done;){var r=t.value;_t.encode(r,n.uint32(10).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={speakers:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.speakers.push(_t.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{speakers:Array.isArray(null==e?void 0:e.speakers)?e.speakers.map((function(e){return _t.fromJSON(e)})):[]}},toJSON:function(e){var t={};return e.speakers?t.speakers=e.speakers.map((function(e){return e?_t.toJSON(e):void 0})):t.speakers=[],t},create:function(e){return Et.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={speakers:[]};return n.speakers=(null===(t=e.speakers)||void 0===t?void 0:t.map((function(e){return _t.fromPartial(e)})))||[],n}},_t={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.sid&&t.uint32(10).string(e.sid),0!==e.level&&t.uint32(21).float(e.level),!0===e.active&&t.uint32(24).bool(e.active),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={sid:"",level:0,active:!1};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.sid=n.string();continue;case 2:if(21!=a)break;r.level=n.float();continue;case 3:if(24!=a)break;r.active=n.bool();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{sid:jt(e.sid)?String(e.sid):"",level:jt(e.level)?Number(e.level):0,active:!!jt(e.active)&&Boolean(e.active)}},toJSON:function(e){var t={};return void 0!==e.sid&&(t.sid=e.sid),void 0!==e.level&&(t.level=e.level),void 0!==e.active&&(t.active=e.active),t},create:function(e){return _t.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={sid:"",level:0,active:!1};return r.sid=null!==(t=e.sid)&&void 0!==t?t:"",r.level=null!==(n=e.level)&&void 0!==n?n:0,r.active=null!==(i=e.active)&&void 0!==i&&i,r}};function xt(){return{participantSid:"",payload:new Uint8Array,destinationSids:[],topic:void 0}}var Ot={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.participantSid&&t.uint32(10).string(e.participantSid),0!==e.payload.length&&t.uint32(18).bytes(e.payload);var n,i=_createForOfIteratorHelper(e.destinationSids);try{for(i.s();!(n=i.n()).done;){var r=n.value;t.uint32(26).string(r)}}catch(e){i.e(e)}finally{i.f()}return void 0!==e.topic&&t.uint32(34).string(e.topic),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r=xt();n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.participantSid=n.string();continue;case 2:if(18!=a)break;r.payload=n.bytes();continue;case 3:if(26!=a)break;r.destinationSids.push(n.string());continue;case 4:if(34!=a)break;r.topic=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{participantSid:jt(e.participantSid)?String(e.participantSid):"",payload:jt(e.payload)?Ft(e.payload):new Uint8Array,destinationSids:Array.isArray(null==e?void 0:e.destinationSids)?e.destinationSids.map((function(e){return String(e)})):[],topic:jt(e.topic)?String(e.topic):void 0}},toJSON:function(e){var t={};return void 0!==e.participantSid&&(t.participantSid=e.participantSid),void 0!==e.payload&&(t.payload=function(e){if(Mt.Buffer)return Mt.Buffer.from(e).toString("base64");var t=[];return e.forEach((function(e){t.push(String.fromCharCode(e))})),Mt.btoa(t.join(""))}(void 0!==e.payload?e.payload:new Uint8Array)),e.destinationSids?t.destinationSids=e.destinationSids.map((function(e){return e})):t.destinationSids=[],void 0!==e.topic&&(t.topic=e.topic),t},create:function(e){return Ot.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a=xt();return a.participantSid=null!==(t=e.participantSid)&&void 0!==t?t:"",a.payload=null!==(n=e.payload)&&void 0!==n?n:new Uint8Array,a.destinationSids=(null===(i=e.destinationSids)||void 0===i?void 0:i.map((function(e){return e})))||[],a.topic=null!==(r=e.topic)&&void 0!==r?r:void 0,a}},Nt={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.participantSid&&t.uint32(10).string(e.participantSid);var n,i=_createForOfIteratorHelper(e.trackSids);try{for(i.s();!(n=i.n()).done;){var r=n.value;t.uint32(18).string(r)}}catch(e){i.e(e)}finally{i.f()}return t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={participantSid:"",trackSids:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.participantSid=n.string();continue;case 2:if(18!=a)break;r.trackSids.push(n.string());continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{participantSid:jt(e.participantSid)?String(e.participantSid):"",trackSids:Array.isArray(null==e?void 0:e.trackSids)?e.trackSids.map((function(e){return String(e)})):[]}},toJSON:function(e){var t={};return void 0!==e.participantSid&&(t.participantSid=e.participantSid),e.trackSids?t.trackSids=e.trackSids.map((function(e){return e})):t.trackSids=[],t},create:function(e){return Nt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={participantSid:"",trackSids:[]};return i.participantSid=null!==(t=e.participantSid)&&void 0!==t?t:"",i.trackSids=(null===(n=e.trackSids)||void 0===n?void 0:n.map((function(e){return e})))||[],i}},It={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return 0!==e.edition&&t.uint32(8).int32(e.edition),""!==e.version&&t.uint32(18).string(e.version),0!==e.protocol&&t.uint32(24).int32(e.protocol),""!==e.region&&t.uint32(34).string(e.region),""!==e.nodeId&&t.uint32(42).string(e.nodeId),""!==e.debugInfo&&t.uint32(50).string(e.debugInfo),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={edition:0,version:"",protocol:0,region:"",nodeId:"",debugInfo:""};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.edition=n.int32();continue;case 2:if(18!=a)break;r.version=n.string();continue;case 3:if(24!=a)break;r.protocol=n.int32();continue;case 4:if(34!=a)break;r.region=n.string();continue;case 5:if(42!=a)break;r.nodeId=n.string();continue;case 6:if(50!=a)break;r.debugInfo=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{edition:jt(e.edition)?gt(e.edition):0,version:jt(e.version)?String(e.version):"",protocol:jt(e.protocol)?Number(e.protocol):0,region:jt(e.region)?String(e.region):"",nodeId:jt(e.nodeId)?String(e.nodeId):"",debugInfo:jt(e.debugInfo)?String(e.debugInfo):""}},toJSON:function(e){var t={};return void 0!==e.edition&&(t.edition=function(e){switch(e){case et.Standard:return"Standard";case et.Cloud:return"Cloud";case et.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.edition)),void 0!==e.version&&(t.version=e.version),void 0!==e.protocol&&(t.protocol=Math.round(e.protocol)),void 0!==e.region&&(t.region=e.region),void 0!==e.nodeId&&(t.nodeId=e.nodeId),void 0!==e.debugInfo&&(t.debugInfo=e.debugInfo),t},create:function(e){return It.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s={edition:0,version:"",protocol:0,region:"",nodeId:"",debugInfo:""};return s.edition=null!==(t=e.edition)&&void 0!==t?t:0,s.version=null!==(n=e.version)&&void 0!==n?n:"",s.protocol=null!==(i=e.protocol)&&void 0!==i?i:0,s.region=null!==(r=e.region)&&void 0!==r?r:"",s.nodeId=null!==(a=e.nodeId)&&void 0!==a?a:"",s.debugInfo=null!==(o=e.debugInfo)&&void 0!==o?o:"",s}},Dt={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return 0!==e.sdk&&t.uint32(8).int32(e.sdk),""!==e.version&&t.uint32(18).string(e.version),0!==e.protocol&&t.uint32(24).int32(e.protocol),""!==e.os&&t.uint32(34).string(e.os),""!==e.osVersion&&t.uint32(42).string(e.osVersion),""!==e.deviceModel&&t.uint32(50).string(e.deviceModel),""!==e.browser&&t.uint32(58).string(e.browser),""!==e.browserVersion&&t.uint32(66).string(e.browserVersion),""!==e.address&&t.uint32(74).string(e.address),""!==e.network&&t.uint32(82).string(e.network),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={sdk:0,version:"",protocol:0,os:"",osVersion:"",deviceModel:"",browser:"",browserVersion:"",address:"",network:""};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.sdk=n.int32();continue;case 2:if(18!=a)break;r.version=n.string();continue;case 3:if(24!=a)break;r.protocol=n.int32();continue;case 4:if(34!=a)break;r.os=n.string();continue;case 5:if(42!=a)break;r.osVersion=n.string();continue;case 6:if(50!=a)break;r.deviceModel=n.string();continue;case 7:if(58!=a)break;r.browser=n.string();continue;case 8:if(66!=a)break;r.browserVersion=n.string();continue;case 9:if(74!=a)break;r.address=n.string();continue;case 10:if(82!=a)break;r.network=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{sdk:jt(e.sdk)?bt(e.sdk):0,version:jt(e.version)?String(e.version):"",protocol:jt(e.protocol)?Number(e.protocol):0,os:jt(e.os)?String(e.os):"",osVersion:jt(e.osVersion)?String(e.osVersion):"",deviceModel:jt(e.deviceModel)?String(e.deviceModel):"",browser:jt(e.browser)?String(e.browser):"",browserVersion:jt(e.browserVersion)?String(e.browserVersion):"",address:jt(e.address)?String(e.address):"",network:jt(e.network)?String(e.network):""}},toJSON:function(e){var t={};return void 0!==e.sdk&&(t.sdk=function(e){switch(e){case tt.UNKNOWN:return"UNKNOWN";case tt.JS:return"JS";case tt.SWIFT:return"SWIFT";case tt.ANDROID:return"ANDROID";case tt.FLUTTER:return"FLUTTER";case tt.GO:return"GO";case tt.UNITY:return"UNITY";case tt.REACT_NATIVE:return"REACT_NATIVE";case tt.RUST:return"RUST";case tt.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.sdk)),void 0!==e.version&&(t.version=e.version),void 0!==e.protocol&&(t.protocol=Math.round(e.protocol)),void 0!==e.os&&(t.os=e.os),void 0!==e.osVersion&&(t.osVersion=e.osVersion),void 0!==e.deviceModel&&(t.deviceModel=e.deviceModel),void 0!==e.browser&&(t.browser=e.browser),void 0!==e.browserVersion&&(t.browserVersion=e.browserVersion),void 0!==e.address&&(t.address=e.address),void 0!==e.network&&(t.network=e.network),t},create:function(e){return Dt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u,d,l={sdk:0,version:"",protocol:0,os:"",osVersion:"",deviceModel:"",browser:"",browserVersion:"",address:"",network:""};return l.sdk=null!==(t=e.sdk)&&void 0!==t?t:0,l.version=null!==(n=e.version)&&void 0!==n?n:"",l.protocol=null!==(i=e.protocol)&&void 0!==i?i:0,l.os=null!==(r=e.os)&&void 0!==r?r:"",l.osVersion=null!==(a=e.osVersion)&&void 0!==a?a:"",l.deviceModel=null!==(o=e.deviceModel)&&void 0!==o?o:"",l.browser=null!==(s=e.browser)&&void 0!==s?s:"",l.browserVersion=null!==(c=e.browserVersion)&&void 0!==c?c:"",l.address=null!==(u=e.address)&&void 0!==u?u:"",l.network=null!==(d=e.network)&&void 0!==d?d:"",l}},At={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return void 0!==e.video&&Ut.encode(e.video,t.uint32(10).fork()).ldelim(),void 0!==e.screen&&Ut.encode(e.screen,t.uint32(18).fork()).ldelim(),0!==e.resumeConnection&&t.uint32(24).int32(e.resumeConnection),void 0!==e.disabledCodecs&&Lt.encode(e.disabledCodecs,t.uint32(34).fork()).ldelim(),0!==e.forceRelay&&t.uint32(40).int32(e.forceRelay),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={video:void 0,screen:void 0,resumeConnection:0,disabledCodecs:void 0,forceRelay:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.video=Ut.decode(n,n.uint32());continue;case 2:if(18!=a)break;r.screen=Ut.decode(n,n.uint32());continue;case 3:if(24!=a)break;r.resumeConnection=n.int32();continue;case 4:if(34!=a)break;r.disabledCodecs=Lt.decode(n,n.uint32());continue;case 5:if(40!=a)break;r.forceRelay=n.int32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{video:jt(e.video)?Ut.fromJSON(e.video):void 0,screen:jt(e.screen)?Ut.fromJSON(e.screen):void 0,resumeConnection:jt(e.resumeConnection)?dt(e.resumeConnection):0,disabledCodecs:jt(e.disabledCodecs)?Lt.fromJSON(e.disabledCodecs):void 0,forceRelay:jt(e.forceRelay)?dt(e.forceRelay):0}},toJSON:function(e){var t={};return void 0!==e.video&&(t.video=e.video?Ut.toJSON(e.video):void 0),void 0!==e.screen&&(t.screen=e.screen?Ut.toJSON(e.screen):void 0),void 0!==e.resumeConnection&&(t.resumeConnection=lt(e.resumeConnection)),void 0!==e.disabledCodecs&&(t.disabledCodecs=e.disabledCodecs?Lt.toJSON(e.disabledCodecs):void 0),void 0!==e.forceRelay&&(t.forceRelay=lt(e.forceRelay)),t},create:function(e){return At.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={video:void 0,screen:void 0,resumeConnection:0,disabledCodecs:void 0,forceRelay:0};return i.video=void 0!==e.video&&null!==e.video?Ut.fromPartial(e.video):void 0,i.screen=void 0!==e.screen&&null!==e.screen?Ut.fromPartial(e.screen):void 0,i.resumeConnection=null!==(t=e.resumeConnection)&&void 0!==t?t:0,i.disabledCodecs=void 0!==e.disabledCodecs&&null!==e.disabledCodecs?Lt.fromPartial(e.disabledCodecs):void 0,i.forceRelay=null!==(n=e.forceRelay)&&void 0!==n?n:0,i}},Ut={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return 0!==e.hardwareEncoder&&t.uint32(8).int32(e.hardwareEncoder),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={hardwareEncoder:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.hardwareEncoder=n.int32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{hardwareEncoder:jt(e.hardwareEncoder)?dt(e.hardwareEncoder):0}},toJSON:function(e){var t={};return void 0!==e.hardwareEncoder&&(t.hardwareEncoder=lt(e.hardwareEncoder)),t},create:function(e){return Ut.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={hardwareEncoder:0};return n.hardwareEncoder=null!==(t=e.hardwareEncoder)&&void 0!==t?t:0,n}},Lt={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.codecs);try{for(i.s();!(t=i.n()).done;){var r=t.value;yt.encode(r,n.uint32(10).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={codecs:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.codecs.push(yt.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{codecs:Array.isArray(null==e?void 0:e.codecs)?e.codecs.map((function(e){return yt.fromJSON(e)})):[]}},toJSON:function(e){var t={};return e.codecs?t.codecs=e.codecs.map((function(e){return e?yt.toJSON(e):void 0})):t.codecs=[],t},create:function(e){return Lt.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={codecs:[]};return n.codecs=(null===(t=e.codecs)||void 0===t?void 0:t.map((function(e){return yt.fromPartial(e)})))||[],n}},Mt=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"}();function Ft(e){if(Mt.Buffer)return Uint8Array.from(Mt.Buffer.from(e,"base64"));for(var t=Mt.atob(e),n=new Uint8Array(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}function Bt(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new Mt.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}function jt(e){return null!=e}nt.util.Long!==H&&(nt.util.Long=H,nt.configure());var Jt=7e3,$t=[0,300,1200,2700,4800,Jt,Jt,Jt,Jt,Jt],Vt=function(){function e(t){_classCallCheck(this,e),this._retryDelays=void 0!==t?_toConsumableArray(t):$t}return _createClass(e,[{key:"nextRetryDelayInMs",value:function(e){if(e.retryCount>=this._retryDelays.length)return null;var t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}}]),e}();function qt(e,t,n,i){return new(n||(n=Promise))((function(r,a){function o(e){try{c(i.next(e))}catch(e){a(e)}}function s(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}c((i=i.apply(e,t||[])).next())}))}function Wt(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){!function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)}(i,r,(t=e[n](t)).done,t.value)}))}}}var Gt,Ht={exports:{}},Qt="object"==("undefined"==typeof Reflect?"undefined":_typeof(Reflect))?Reflect:null,zt=Qt&&"function"==typeof Qt.apply?Qt.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};Gt=Qt&&"function"==typeof Qt.ownKeys?Qt.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var Kt=Number.isNaN||function(e){return e!=e};function Zt(){Zt.init.call(this)}Ht.exports=Zt,Ht.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,a),i(n)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}cn(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&cn(e,"error",t,{once:!0})}(e,r)}))},Zt.EventEmitter=Zt,Zt.prototype._events=void 0,Zt.prototype._eventsCount=0,Zt.prototype._maxListeners=void 0;var Yt=10;function Xt(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+_typeof(e))}function en(e){return void 0===e._maxListeners?Zt.defaultMaxListeners:e._maxListeners}function tn(e,t,n,i){var r,a,o,s;if(Xt(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"==typeof o?o=a[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=en(e))>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,s=c,console&&console.warn&&console.warn(s)}return e}function nn(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function rn(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=nn.bind(i);return r.listener=n,i.wrapFn=r,r}function an(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):sn(r,r.length)}function on(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function sn(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function cn(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+_typeof(e));e.addEventListener(t,(function r(a){i.once&&e.removeEventListener(t,r),n(a)}))}}Object.defineProperty(Zt,"defaultMaxListeners",{enumerable:!0,get:function(){return Yt},set:function(e){if("number"!=typeof e||e<0||Kt(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Yt=e}}),Zt.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Zt.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||Kt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},Zt.prototype.getMaxListeners=function(){return en(this)},Zt.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var s=r[e];if(void 0===s)return!1;if("function"==typeof s)zt(s,this,t);else{var c=s.length,u=sn(s,c);for(n=0;n<c;++n)zt(u[n],this,t)}return!0},Zt.prototype.addListener=function(e,t){return tn(this,e,t,!1)},Zt.prototype.on=Zt.prototype.addListener,Zt.prototype.prependListener=function(e,t){return tn(this,e,t,!0)},Zt.prototype.once=function(e,t){return Xt(t),this.on(e,rn(this,e,t)),this},Zt.prototype.prependOnceListener=function(e,t){return Xt(t),this.prependListener(e,rn(this,e,t)),this},Zt.prototype.removeListener=function(e,t){var n,i,r,a,o;if(Xt(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},Zt.prototype.off=Zt.prototype.removeListener,Zt.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},Zt.prototype.listeners=function(e){return an(this,e,!0)},Zt.prototype.rawListeners=function(e){return an(this,e,!1)},Zt.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):on.call(e,t)},Zt.prototype.listenerCount=on,Zt.prototype.eventNames=function(){return this._eventsCount>0?Gt(this._events):[]};var un=Ht.exports,dn=n(un),ln=function(){function e(t,n){_classCallCheck(this,e),this.maxConcurrent=t||1,this.minCycle=n||0,this.queueRunning=[],this.queueWaiting={},this.lastRun=0}var t,n;return _createClass(e,[{key:"dequeue",value:function(e){var t=this.queueRunning,n=t.findIndex((function(t){return t.hash===e}));if(-1==n)throw"queue desync";var i=t[n];return t.splice(n,1),i}},{key:"getFirstWaiting",value:function(){var e,t=_createForOfIteratorHelper(Object.keys(this.queueWaiting).sort((function(e,t){return e-t})));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(void 0!==this.queueWaiting[n]&&this.queueWaiting[n].length>0)return this.queueWaiting[n]}}catch(e){t.e(e)}finally{t.f()}}},{key:"end",value:function(e){this.dequeue(e).resolve();var t=this.getFirstWaiting();void 0!==t&&t.shift().resolve()}},{key:"wait",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var i,r,a=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={hash:t,priority:i=void 0===n?0:n},null==this.queueWaiting[i]&&(this.queueWaiting[i]=[]),e.t0=this.queueRunning.length>=this.maxConcurrent,!e.t0){e.next=9;break}return r.promise=new Promise((function(e){r.resolve=e})),this.queueWaiting[i].push(r),e.next=9,r.promise;case 9:this.queueRunning.push(r),r.promise=new Promise((function(e){r.resolve=e}));case 11:if(!(Date.now()-this.lastRun<this.minCycle)){e.next=16;break}return e.next=14,new Promise((function(e){return setTimeout(e,a.minCycle-Date.now()+a.lastRun)}));case 14:e.next=11;break;case 16:this.lastRun=Date.now();case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"run",value:function(e,t){var n=this,i=void 0===t?0:t,r=Symbol();return this.wait(r,i).then((function(){return e()})).finally((function(){n.end(r)}))}},{key:"stat",value:function(){var e=this;return{running:this.queueRunning.length,waiting:Object.keys(this.queueWaiting).reduce((function(t,n){return t+e.queueWaiting[n].length}),0),last:this.lastRun}}},{key:"flush",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,i,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.stat().waiting>0)){e.next=23;break}t=_createForOfIteratorHelper(Object.keys(this.queueWaiting).sort((function(e,t){return t-e}))),e.prev=2,t.s();case 4:if((n=t.n()).done){e.next=13;break}if(i=n.value,r=this.queueWaiting[i],e.t0=void 0!==r&&r.length>0,!e.t0){e.next=11;break}return e.next=11,r[r.length-1].promise;case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(2),t.e(e.t1);case 18:return e.prev=18,t.f(),e.finish(18);case 21:e.next=0;break;case 23:if(!(this.queueRunning.length>0)){e.next=28;break}return e.next=26,Promise.allSettled(this.queueRunning.map((function(e){return e.promise})));case 26:e.next=23;break;case 28:case"end":return e.stop()}}),e,this,[[2,15,18,21]])}))),function(){return t.apply(this,arguments)})}]),e}(),pn=!0,fn=!0;function hn(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function vn(e,t,n){if(e.RTCPeerConnection){var i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);var a=function(e){var t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,a),r.apply(this,[e,a])};var a=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);var i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function mn(e){return"boolean"!=typeof e?new Error("Argument type: "+_typeof(e)+". Please use a boolean."):(pn=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function gn(e){return"boolean"!=typeof e?new Error("Argument type: "+_typeof(e)+". Please use a boolean."):(fn=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function bn(){if("object"==("undefined"==typeof window?"undefined":_typeof(window))){if(pn)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function kn(e,t){fn&&console.warn(e+" is deprecated, please use "+t+" instead.")}function yn(e){return"[object Object]"===Object.prototype.toString.call(e)}function Sn(e){return yn(e)?Object.keys(e).reduce((function(t,n){var i=yn(e[n]),r=i?Sn(e[n]):e[n],a=i&&!Object.keys(r).length;return void 0===r||a?t:Object.assign(t,_defineProperty({},n,r))}),{}):e}function wn(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(i){i.endsWith("Id")?wn(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((function(t){wn(e,e.get(t),n)}))})))}function Cn(e,t,n){var i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;var a=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((function(t){e.forEach((function(n){n.type===i&&n.trackId===t.id&&wn(e,n,r)}))})),r}var Rn=bn;function Tn(e,t){var n=e&&e.navigator;if(n.mediaDevices){var i=function(e){if("object"!=_typeof(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"==_typeof(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[r("min",n)]=i.ideal,t.optional.push(a),(a={})[r("max",n)]=i.ideal,t.optional.push(a)):(a[r("",n)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==_typeof(e.audio)){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==_typeof(e.video)){var o=e.video.facingMode;o=o&&("object"==_typeof(o)?o:{ideal:o});var s,c=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?s=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(s=["front"]),s)return n.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return s.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&s.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=o.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=i(e.video),Rn("chrome: "+JSON.stringify(e)),r(e)}));e.video=i(e.video)}return Rn("chrome: "+JSON.stringify(e)),r(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){i&&i(a(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){var o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return r(e,(function(e){return o(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(a(e))}))}))}}}}function Pn(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function En(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(i){var r;r=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===i.track.id})):{track:i.track};var a=new Event("track");a.track=i.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[t.stream],n.dispatchEvent(a)})),t.stream.getTracks().forEach((function(i){var r;r=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===i.id})):{track:i};var a=new Event("track");a.track=i,a.receiver=r,a.transceiver={receiver:r},a.streams=[t.stream],n.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else vn(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function _n(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"==_typeof(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function xn(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),i=n[0],r=n[1],a=n[2];if(arguments.length>0&&"function"==typeof i)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof i))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){return t.apply(this,[function(e){r(s(o(e)))},i])}return new Promise((function(n,i){t.apply(e,[function(e){n(s(o(e)))},i])})).then(r,a)}}}function On(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return Cn(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),vn(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return Cn(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,i,a=arguments[0];return this.getSenders().forEach((function(e){e.track===a&&(t?i=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===a&&(n?i=!0:n=e),e.track===a})),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}}}function Nn(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var i=this.getSenders();n.apply(this,arguments);var r=this.getSenders().filter((function(e){return-1===i.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(r)};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var i=t._shimmedLocalStreams[n].indexOf(e);-1!==i&&t._shimmedLocalStreams[n].splice(i,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),r.apply(this,arguments)}}function In(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Nn(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var i=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then((function(){i.dispatchEvent(new Event("negotiationneeded"))}));else{var o=new e.MediaStream([t]);this._streams[n.id]=o,this._reverseStreams[o.id]=n,this.addStream(o)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=_defineProperty({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(n){var i=s(e,n);t[0].apply(null,[i])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=i[t]}));var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(i){n._streams[i].getTracks().find((function(t){return e.track===t}))&&(t=n._streams[i])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}}function Dn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=_defineProperty({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=i[t]}))}function An(e,t){vn(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Un=Object.freeze({__proto__:null,fixNegotiationNeeded:An,shimAddTrackRemoveTrack:In,shimAddTrackRemoveTrackWithNative:Nn,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var i=n.video&&n.video.width,r=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_n,shimGetStats:xn,shimGetUserMedia:Tn,shimMediaStream:Pn,shimOnTrack:En,shimPeerConnection:Dn,shimSenderReceiverGetStats:On});function Ln(e,t){var n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){kn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var r=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==_typeof(e)&&"object"==_typeof(e.audio)&&(e=JSON.parse(JSON.stringify(e)),r(e.audio,"autoGainControl","mozAutoGainControl"),r(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},i&&i.prototype.getSettings){var o=i.prototype.getSettings;i.prototype.getSettings=function(){var e=o.apply(this,arguments);return r(e,"mozAutoGainControl","autoGainControl"),r(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var s=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==_typeof(e)&&(e=JSON.parse(JSON.stringify(e)),r(e,"autoGainControl","mozAutoGainControl"),r(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function Mn(e){"object"==_typeof(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Fn(e,t){if("object"==_typeof(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],i=_defineProperty({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=i[t]}));var n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),r=e[0],a=e[1],o=e[2];return i.apply(this,[r||null]).then((function(e){if(t.version<53&&!a)try{e.forEach((function(e){e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,i){e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(a,o)}}}function Bn(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function jn(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),vn(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Jn(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;kn("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})}function $n(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Vn(e){if("object"==_typeof(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var n=(e=_toConsumableArray(e)).length>0;n&&e.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var i=t.apply(this,arguments);if(n){var r=i.sender,a=r.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=e,r.sendEncodings=e,this.setParametersPromises.push(r.setParameters(a).then((function(){delete r.sendEncodings})).catch((function(){delete r.sendEncodings}))))}return i})}}function qn(e){if("object"==_typeof(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function Wn(e){if("object"==_typeof(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function Gn(e){if("object"==_typeof(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}var Hn=Object.freeze({__proto__:null,shimAddTransceiver:Vn,shimCreateAnswer:Gn,shimCreateOffer:Wn,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:qn,shimGetUserMedia:Ln,shimOnTrack:Mn,shimPeerConnection:Fn,shimRTCDataChannel:$n,shimReceiverGetStats:jn,shimRemoveStream:Jn,shimSenderGetStats:Bn});function Qn(e){if("object"==_typeof(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(i){return t.call(n,i,e)})),e.getVideoTracks().forEach((function(i){return t.call(n,i,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r&&r.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var i=e.getTracks();this.getSenders().forEach((function(e){i.includes(e.track)&&t.removeTrack(e)}))}})}}function zn(e){if("object"==_typeof(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function Kn(e){if("object"==_typeof(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var s=function(e,t,n){var i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){var i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){var i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}}function Zn(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return i(Yn(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Yn(e){return e&&void 0!==e.video?Object.assign({},e,{video:Sn(e.video)}):e}function Xn(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],r=0;r<e.iceServers.length;r++){var a=e.iceServers[r];void 0===a.urls&&a.url?(kn("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[r])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function ei(e){"object"==_typeof(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function ti(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function ni(e){"object"!=_typeof(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var ii=Object.freeze({__proto__:null,shimAudioContext:ni,shimCallbacksAPI:Kn,shimConstraints:Yn,shimCreateOfferLegacy:ti,shimGetUserMedia:Zn,shimLocalStreamsAPI:Qn,shimRTCIceServerUrls:Xn,shimRemoteStreamsAPI:zn,shimTrackEventTransceiver:ei}),ri={exports:{}};!function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation);var n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){var t=e.substring(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){for(var t,n={},i=e.substring(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){var t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){var t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){var t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==_typeof(e.keyParams)?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(var r=3;r<i.length;r++){var a=i[r],o=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=t.parseRtpMap(o),c=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))}));var u=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((function(e){u.forEach((function(t){e.rtcpFeedback.find((function(e){return e.type===t.type&&e.parameter===t.parameter}))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){var i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));var r=0;return n.codecs.forEach((function(e){e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((function(e){i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){var n,i=[],r=t.parseRtpParameters(e),a=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substring(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(n=u[0][1]),r.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),i.push(t),a&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(t))}})),0===i.length&&c&&i.push({ssrc:c});var d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,i.forEach((function(e){e.maxBitrate=d}))),i},t.parseRtcpParameters=function(e){var n={},i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;var a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){var n,i=t.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(n=i[0].substring(7).split(" "))[0],track:n[1]};var r=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return r.length>0?{stream:(n=r[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,i=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");r.length>0&&(n=parseInt(r[0].substring(19),10)),isNaN(n)&&(n=65536);var a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:n};var o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){var s=o[0].substring(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){var r=void 0!==n?n:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){for(var i=t.splitLines(e),r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),i=0;i<n.length;i++)if(n[i].length<2||"="!==n[i].charAt(1))return!1;return!0},e.exports=t}(ri);var ai=ri.exports,oi=n(ai),si=function(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}({__proto__:null,default:oi},[ai]);function ci(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==_typeof(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){var n=new t(e),i=oi.parseCandidate(e.candidate);for(var r in i)r in n||Object.defineProperty(n,r,{value:i[r]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,vn(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function ui(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||vn(e,"icecandidate",(function(e){if(e.candidate){var t=oi.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function di(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){(this._sctp=null,"chrome"===t.browser&&t.version>=76)&&("plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}));if(function(e){if(!e||!e.sdp)return!1;var t=oi.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=oi.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){var e,i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),r=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(i),a=function(e,n){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var r=oi.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],i);e=0===r&&0===a?Number.POSITIVE_INFINITY:0===r||0===a?Math.max(r,a):Math.min(r,a);var o={};Object.defineProperty(o,"maxMessageSize",{get:function(){return e}}),this._sctp=o}return n.apply(this,arguments)}}}function li(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},vn(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function pi(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}}function fi(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var i=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return n.apply(this,arguments)}}}function hi(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function vi(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!=_typeof(t)||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then((function(t){return n.apply(e,[t])}))})}}var mi,gi,bi,ki=Object.freeze({__proto__:null,removeExtmapAllowMixed:fi,shimAddIceCandidateNullOrEmpty:hi,shimConnectionState:pi,shimMaxMessageSize:di,shimParameterlessSetLocalDescription:vi,shimRTCIceCandidate:ci,shimRTCIceCandidateRelayProtocol:ui,shimSendThrowTypeError:li});function yi(e){switch(e){case 0:case"PUBLISHER":return mi.PUBLISHER;case 1:case"SUBSCRIBER":return mi.SUBSCRIBER;default:return mi.UNRECOGNIZED}}function Si(e){switch(e){case mi.PUBLISHER:return"PUBLISHER";case mi.SUBSCRIBER:return"SUBSCRIBER";case mi.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function wi(e){switch(e){case 0:case"ACTIVE":return gi.ACTIVE;case 1:case"PAUSED":return gi.PAUSED;default:return gi.UNRECOGNIZED}}function Ci(e){switch(e){case 0:case"UDP":return bi.UDP;case 1:case"TCP":return bi.TCP;case 2:case"TLS":return bi.TLS;default:return bi.UNRECOGNIZED}}!function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=bn,i=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=hn(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=hn(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=hn(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),r={browserDetails:i,commonShim:ki,extractVersion:hn,disableLog:mn,disableWarnings:gn,sdp:si};switch(i.browser){case"chrome":if(!Un||!Dn||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=Un,hi(e,i),vi(e),Tn(e,i),Pn(e),Dn(e,i),En(e),In(e,i),_n(e),xn(e),On(e),An(e,i),ci(e),ui(e),pi(e),di(e,i),li(e),fi(e,i);break;case"firefox":if(!Hn||!Fn||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Hn,hi(e,i),vi(e),Ln(e,i),Fn(e,i),Mn(e),Jn(e),Bn(e),jn(e),$n(e),Vn(e),qn(e),Wn(e),Gn(e),ci(e),pi(e),di(e,i),li(e);break;case"safari":if(!ii||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=ii,hi(e,i),vi(e),Xn(e),ti(e),Kn(e),Qn(e),zn(e),ei(e),Zn(e),ni(e),ci(e),ui(e),di(e,i),li(e),fi(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window}),function(e){e[e.PUBLISHER=0]="PUBLISHER",e[e.SUBSCRIBER=1]="SUBSCRIBER",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(mi||(mi={})),function(e){e[e.ACTIVE=0]="ACTIVE",e[e.PAUSED=1]="PAUSED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(gi||(gi={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.TLS=2]="TLS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"}(bi||(bi={}));var Ri,Ti={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();switch(null===(t=e.message)||void 0===t?void 0:t.$case){case"offer":Ui.encode(e.message.offer,n.uint32(10).fork()).ldelim();break;case"answer":Ui.encode(e.message.answer,n.uint32(18).fork()).ldelim();break;case"trickle":xi.encode(e.message.trickle,n.uint32(26).fork()).ldelim();break;case"addTrack":_i.encode(e.message.addTrack,n.uint32(34).fork()).ldelim();break;case"mute":Oi.encode(e.message.mute,n.uint32(42).fork()).ldelim();break;case"subscription":Mi.encode(e.message.subscription,n.uint32(50).fork()).ldelim();break;case"trackSetting":Fi.encode(e.message.trackSetting,n.uint32(58).fork()).ldelim();break;case"leave":Bi.encode(e.message.leave,n.uint32(66).fork()).ldelim();break;case"updateLayers":ji.encode(e.message.updateLayers,n.uint32(82).fork()).ldelim();break;case"subscriptionPermission":Xi.encode(e.message.subscriptionPermission,n.uint32(90).fork()).ldelim();break;case"syncState":tr.encode(e.message.syncState,n.uint32(98).fork()).ldelim();break;case"simulate":ir.encode(e.message.simulate,n.uint32(106).fork()).ldelim();break;case"ping":n.uint32(112).int64(e.message.ping);break;case"updateMetadata":Ji.encode(e.message.updateMetadata,n.uint32(122).fork()).ldelim();break;case"pingReq":rr.encode(e.message.pingReq,n.uint32(130).fork()).ldelim()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={message:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.message={$case:"offer",offer:Ui.decode(n,n.uint32())};continue;case 2:if(18!=a)break;r.message={$case:"answer",answer:Ui.decode(n,n.uint32())};continue;case 3:if(26!=a)break;r.message={$case:"trickle",trickle:xi.decode(n,n.uint32())};continue;case 4:if(34!=a)break;r.message={$case:"addTrack",addTrack:_i.decode(n,n.uint32())};continue;case 5:if(42!=a)break;r.message={$case:"mute",mute:Oi.decode(n,n.uint32())};continue;case 6:if(50!=a)break;r.message={$case:"subscription",subscription:Mi.decode(n,n.uint32())};continue;case 7:if(58!=a)break;r.message={$case:"trackSetting",trackSetting:Fi.decode(n,n.uint32())};continue;case 8:if(66!=a)break;r.message={$case:"leave",leave:Bi.decode(n,n.uint32())};continue;case 10:if(82!=a)break;r.message={$case:"updateLayers",updateLayers:ji.decode(n,n.uint32())};continue;case 11:if(90!=a)break;r.message={$case:"subscriptionPermission",subscriptionPermission:Xi.decode(n,n.uint32())};continue;case 12:if(98!=a)break;r.message={$case:"syncState",syncState:tr.decode(n,n.uint32())};continue;case 13:if(106!=a)break;r.message={$case:"simulate",simulate:ir.decode(n,n.uint32())};continue;case 14:if(112!=a)break;r.message={$case:"ping",ping:sr(n.int64())};continue;case 15:if(122!=a)break;r.message={$case:"updateMetadata",updateMetadata:Ji.decode(n,n.uint32())};continue;case 16:if(130!=a)break;r.message={$case:"pingReq",pingReq:rr.decode(n,n.uint32())};continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{message:cr(e.offer)?{$case:"offer",offer:Ui.fromJSON(e.offer)}:cr(e.answer)?{$case:"answer",answer:Ui.fromJSON(e.answer)}:cr(e.trickle)?{$case:"trickle",trickle:xi.fromJSON(e.trickle)}:cr(e.addTrack)?{$case:"addTrack",addTrack:_i.fromJSON(e.addTrack)}:cr(e.mute)?{$case:"mute",mute:Oi.fromJSON(e.mute)}:cr(e.subscription)?{$case:"subscription",subscription:Mi.fromJSON(e.subscription)}:cr(e.trackSetting)?{$case:"trackSetting",trackSetting:Fi.fromJSON(e.trackSetting)}:cr(e.leave)?{$case:"leave",leave:Bi.fromJSON(e.leave)}:cr(e.updateLayers)?{$case:"updateLayers",updateLayers:ji.fromJSON(e.updateLayers)}:cr(e.subscriptionPermission)?{$case:"subscriptionPermission",subscriptionPermission:Xi.fromJSON(e.subscriptionPermission)}:cr(e.syncState)?{$case:"syncState",syncState:tr.fromJSON(e.syncState)}:cr(e.simulate)?{$case:"simulate",simulate:ir.fromJSON(e.simulate)}:cr(e.ping)?{$case:"ping",ping:Number(e.ping)}:cr(e.updateMetadata)?{$case:"updateMetadata",updateMetadata:Ji.fromJSON(e.updateMetadata)}:cr(e.pingReq)?{$case:"pingReq",pingReq:rr.fromJSON(e.pingReq)}:void 0}},toJSON:function(e){var t,n,i,r,a,o,s,c,u,d,l,p,f,h,v,m,g,b,k,y,S,w,C,R,T,P,E,_,x,O,N,I,D,A,U,L,M,F,B,j,J,$,V,q,W={};return"offer"===(null===(t=e.message)||void 0===t?void 0:t.$case)&&(W.offer=(null===(n=e.message)||void 0===n?void 0:n.offer)?Ui.toJSON(null===(i=e.message)||void 0===i?void 0:i.offer):void 0),"answer"===(null===(r=e.message)||void 0===r?void 0:r.$case)&&(W.answer=(null===(a=e.message)||void 0===a?void 0:a.answer)?Ui.toJSON(null===(o=e.message)||void 0===o?void 0:o.answer):void 0),"trickle"===(null===(s=e.message)||void 0===s?void 0:s.$case)&&(W.trickle=(null===(c=e.message)||void 0===c?void 0:c.trickle)?xi.toJSON(null===(u=e.message)||void 0===u?void 0:u.trickle):void 0),"addTrack"===(null===(d=e.message)||void 0===d?void 0:d.$case)&&(W.addTrack=(null===(l=e.message)||void 0===l?void 0:l.addTrack)?_i.toJSON(null===(p=e.message)||void 0===p?void 0:p.addTrack):void 0),"mute"===(null===(f=e.message)||void 0===f?void 0:f.$case)&&(W.mute=(null===(h=e.message)||void 0===h?void 0:h.mute)?Oi.toJSON(null===(v=e.message)||void 0===v?void 0:v.mute):void 0),"subscription"===(null===(m=e.message)||void 0===m?void 0:m.$case)&&(W.subscription=(null===(g=e.message)||void 0===g?void 0:g.subscription)?Mi.toJSON(null===(b=e.message)||void 0===b?void 0:b.subscription):void 0),"trackSetting"===(null===(k=e.message)||void 0===k?void 0:k.$case)&&(W.trackSetting=(null===(y=e.message)||void 0===y?void 0:y.trackSetting)?Fi.toJSON(null===(S=e.message)||void 0===S?void 0:S.trackSetting):void 0),"leave"===(null===(w=e.message)||void 0===w?void 0:w.$case)&&(W.leave=(null===(C=e.message)||void 0===C?void 0:C.leave)?Bi.toJSON(null===(R=e.message)||void 0===R?void 0:R.leave):void 0),"updateLayers"===(null===(T=e.message)||void 0===T?void 0:T.$case)&&(W.updateLayers=(null===(P=e.message)||void 0===P?void 0:P.updateLayers)?ji.toJSON(null===(E=e.message)||void 0===E?void 0:E.updateLayers):void 0),"subscriptionPermission"===(null===(_=e.message)||void 0===_?void 0:_.$case)&&(W.subscriptionPermission=(null===(x=e.message)||void 0===x?void 0:x.subscriptionPermission)?Xi.toJSON(null===(O=e.message)||void 0===O?void 0:O.subscriptionPermission):void 0),"syncState"===(null===(N=e.message)||void 0===N?void 0:N.$case)&&(W.syncState=(null===(I=e.message)||void 0===I?void 0:I.syncState)?tr.toJSON(null===(D=e.message)||void 0===D?void 0:D.syncState):void 0),"simulate"===(null===(A=e.message)||void 0===A?void 0:A.$case)&&(W.simulate=(null===(U=e.message)||void 0===U?void 0:U.simulate)?ir.toJSON(null===(L=e.message)||void 0===L?void 0:L.simulate):void 0),"ping"===(null===(M=e.message)||void 0===M?void 0:M.$case)&&(W.ping=Math.round(null===(F=e.message)||void 0===F?void 0:F.ping)),"updateMetadata"===(null===(B=e.message)||void 0===B?void 0:B.$case)&&(W.updateMetadata=(null===(j=e.message)||void 0===j?void 0:j.updateMetadata)?Ji.toJSON(null===(J=e.message)||void 0===J?void 0:J.updateMetadata):void 0),"pingReq"===(null===($=e.message)||void 0===$?void 0:$.$case)&&(W.pingReq=(null===(V=e.message)||void 0===V?void 0:V.pingReq)?rr.toJSON(null===(q=e.message)||void 0===q?void 0:q.pingReq):void 0),W},create:function(e){return Ti.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u,d,l,p,f,h,v,m,g,b,k,y,S,w,C,R,T,P,E,_,x,O,N,I,D,A,U,L,M,F,B,j,J,$,V,q,W,G={message:void 0};return"offer"===(null===(t=e.message)||void 0===t?void 0:t.$case)&&void 0!==(null===(n=e.message)||void 0===n?void 0:n.offer)&&null!==(null===(i=e.message)||void 0===i?void 0:i.offer)&&(G.message={$case:"offer",offer:Ui.fromPartial(e.message.offer)}),"answer"===(null===(r=e.message)||void 0===r?void 0:r.$case)&&void 0!==(null===(a=e.message)||void 0===a?void 0:a.answer)&&null!==(null===(o=e.message)||void 0===o?void 0:o.answer)&&(G.message={$case:"answer",answer:Ui.fromPartial(e.message.answer)}),"trickle"===(null===(s=e.message)||void 0===s?void 0:s.$case)&&void 0!==(null===(c=e.message)||void 0===c?void 0:c.trickle)&&null!==(null===(u=e.message)||void 0===u?void 0:u.trickle)&&(G.message={$case:"trickle",trickle:xi.fromPartial(e.message.trickle)}),"addTrack"===(null===(d=e.message)||void 0===d?void 0:d.$case)&&void 0!==(null===(l=e.message)||void 0===l?void 0:l.addTrack)&&null!==(null===(p=e.message)||void 0===p?void 0:p.addTrack)&&(G.message={$case:"addTrack",addTrack:_i.fromPartial(e.message.addTrack)}),"mute"===(null===(f=e.message)||void 0===f?void 0:f.$case)&&void 0!==(null===(h=e.message)||void 0===h?void 0:h.mute)&&null!==(null===(v=e.message)||void 0===v?void 0:v.mute)&&(G.message={$case:"mute",mute:Oi.fromPartial(e.message.mute)}),"subscription"===(null===(m=e.message)||void 0===m?void 0:m.$case)&&void 0!==(null===(g=e.message)||void 0===g?void 0:g.subscription)&&null!==(null===(b=e.message)||void 0===b?void 0:b.subscription)&&(G.message={$case:"subscription",subscription:Mi.fromPartial(e.message.subscription)}),"trackSetting"===(null===(k=e.message)||void 0===k?void 0:k.$case)&&void 0!==(null===(y=e.message)||void 0===y?void 0:y.trackSetting)&&null!==(null===(S=e.message)||void 0===S?void 0:S.trackSetting)&&(G.message={$case:"trackSetting",trackSetting:Fi.fromPartial(e.message.trackSetting)}),"leave"===(null===(w=e.message)||void 0===w?void 0:w.$case)&&void 0!==(null===(C=e.message)||void 0===C?void 0:C.leave)&&null!==(null===(R=e.message)||void 0===R?void 0:R.leave)&&(G.message={$case:"leave",leave:Bi.fromPartial(e.message.leave)}),"updateLayers"===(null===(T=e.message)||void 0===T?void 0:T.$case)&&void 0!==(null===(P=e.message)||void 0===P?void 0:P.updateLayers)&&null!==(null===(E=e.message)||void 0===E?void 0:E.updateLayers)&&(G.message={$case:"updateLayers",updateLayers:ji.fromPartial(e.message.updateLayers)}),"subscriptionPermission"===(null===(_=e.message)||void 0===_?void 0:_.$case)&&void 0!==(null===(x=e.message)||void 0===x?void 0:x.subscriptionPermission)&&null!==(null===(O=e.message)||void 0===O?void 0:O.subscriptionPermission)&&(G.message={$case:"subscriptionPermission",subscriptionPermission:Xi.fromPartial(e.message.subscriptionPermission)}),"syncState"===(null===(N=e.message)||void 0===N?void 0:N.$case)&&void 0!==(null===(I=e.message)||void 0===I?void 0:I.syncState)&&null!==(null===(D=e.message)||void 0===D?void 0:D.syncState)&&(G.message={$case:"syncState",syncState:tr.fromPartial(e.message.syncState)}),"simulate"===(null===(A=e.message)||void 0===A?void 0:A.$case)&&void 0!==(null===(U=e.message)||void 0===U?void 0:U.simulate)&&null!==(null===(L=e.message)||void 0===L?void 0:L.simulate)&&(G.message={$case:"simulate",simulate:ir.fromPartial(e.message.simulate)}),"ping"===(null===(M=e.message)||void 0===M?void 0:M.$case)&&void 0!==(null===(F=e.message)||void 0===F?void 0:F.ping)&&null!==(null===(B=e.message)||void 0===B?void 0:B.ping)&&(G.message={$case:"ping",ping:e.message.ping}),"updateMetadata"===(null===(j=e.message)||void 0===j?void 0:j.$case)&&void 0!==(null===(J=e.message)||void 0===J?void 0:J.updateMetadata)&&null!==(null===($=e.message)||void 0===$?void 0:$.updateMetadata)&&(G.message={$case:"updateMetadata",updateMetadata:Ji.fromPartial(e.message.updateMetadata)}),"pingReq"===(null===(V=e.message)||void 0===V?void 0:V.$case)&&void 0!==(null===(q=e.message)||void 0===q?void 0:q.pingReq)&&null!==(null===(W=e.message)||void 0===W?void 0:W.pingReq)&&(G.message={$case:"pingReq",pingReq:rr.fromPartial(e.message.pingReq)}),G}},Pi={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();switch(null===(t=e.message)||void 0===t?void 0:t.$case){case"join":Ni.encode(e.message.join,n.uint32(10).fork()).ldelim();break;case"answer":Ui.encode(e.message.answer,n.uint32(18).fork()).ldelim();break;case"offer":Ui.encode(e.message.offer,n.uint32(26).fork()).ldelim();break;case"trickle":xi.encode(e.message.trickle,n.uint32(34).fork()).ldelim();break;case"update":Li.encode(e.message.update,n.uint32(42).fork()).ldelim();break;case"trackPublished":Di.encode(e.message.trackPublished,n.uint32(50).fork()).ldelim();break;case"leave":Bi.encode(e.message.leave,n.uint32(66).fork()).ldelim();break;case"mute":Oi.encode(e.message.mute,n.uint32(74).fork()).ldelim();break;case"speakersChanged":Vi.encode(e.message.speakersChanged,n.uint32(82).fork()).ldelim();break;case"roomUpdate":qi.encode(e.message.roomUpdate,n.uint32(90).fork()).ldelim();break;case"connectionQuality":Gi.encode(e.message.connectionQuality,n.uint32(98).fork()).ldelim();break;case"streamStateUpdate":Qi.encode(e.message.streamStateUpdate,n.uint32(106).fork()).ldelim();break;case"subscribedQualityUpdate":Zi.encode(e.message.subscribedQualityUpdate,n.uint32(114).fork()).ldelim();break;case"subscriptionPermissionUpdate":er.encode(e.message.subscriptionPermissionUpdate,n.uint32(122).fork()).ldelim();break;case"refreshToken":n.uint32(130).string(e.message.refreshToken);break;case"trackUnpublished":Ai.encode(e.message.trackUnpublished,n.uint32(138).fork()).ldelim();break;case"pong":n.uint32(144).int64(e.message.pong);break;case"reconnect":Ii.encode(e.message.reconnect,n.uint32(154).fork()).ldelim();break;case"pongResp":ar.encode(e.message.pongResp,n.uint32(162).fork()).ldelim()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={message:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.message={$case:"join",join:Ni.decode(n,n.uint32())};continue;case 2:if(18!=a)break;r.message={$case:"answer",answer:Ui.decode(n,n.uint32())};continue;case 3:if(26!=a)break;r.message={$case:"offer",offer:Ui.decode(n,n.uint32())};continue;case 4:if(34!=a)break;r.message={$case:"trickle",trickle:xi.decode(n,n.uint32())};continue;case 5:if(42!=a)break;r.message={$case:"update",update:Li.decode(n,n.uint32())};continue;case 6:if(50!=a)break;r.message={$case:"trackPublished",trackPublished:Di.decode(n,n.uint32())};continue;case 8:if(66!=a)break;r.message={$case:"leave",leave:Bi.decode(n,n.uint32())};continue;case 9:if(74!=a)break;r.message={$case:"mute",mute:Oi.decode(n,n.uint32())};continue;case 10:if(82!=a)break;r.message={$case:"speakersChanged",speakersChanged:Vi.decode(n,n.uint32())};continue;case 11:if(90!=a)break;r.message={$case:"roomUpdate",roomUpdate:qi.decode(n,n.uint32())};continue;case 12:if(98!=a)break;r.message={$case:"connectionQuality",connectionQuality:Gi.decode(n,n.uint32())};continue;case 13:if(106!=a)break;r.message={$case:"streamStateUpdate",streamStateUpdate:Qi.decode(n,n.uint32())};continue;case 14:if(114!=a)break;r.message={$case:"subscribedQualityUpdate",subscribedQualityUpdate:Zi.decode(n,n.uint32())};continue;case 15:if(122!=a)break;r.message={$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:er.decode(n,n.uint32())};continue;case 16:if(130!=a)break;r.message={$case:"refreshToken",refreshToken:n.string()};continue;case 17:if(138!=a)break;r.message={$case:"trackUnpublished",trackUnpublished:Ai.decode(n,n.uint32())};continue;case 18:if(144!=a)break;r.message={$case:"pong",pong:sr(n.int64())};continue;case 19:if(154!=a)break;r.message={$case:"reconnect",reconnect:Ii.decode(n,n.uint32())};continue;case 20:if(162!=a)break;r.message={$case:"pongResp",pongResp:ar.decode(n,n.uint32())};continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{message:cr(e.join)?{$case:"join",join:Ni.fromJSON(e.join)}:cr(e.answer)?{$case:"answer",answer:Ui.fromJSON(e.answer)}:cr(e.offer)?{$case:"offer",offer:Ui.fromJSON(e.offer)}:cr(e.trickle)?{$case:"trickle",trickle:xi.fromJSON(e.trickle)}:cr(e.update)?{$case:"update",update:Li.fromJSON(e.update)}:cr(e.trackPublished)?{$case:"trackPublished",trackPublished:Di.fromJSON(e.trackPublished)}:cr(e.leave)?{$case:"leave",leave:Bi.fromJSON(e.leave)}:cr(e.mute)?{$case:"mute",mute:Oi.fromJSON(e.mute)}:cr(e.speakersChanged)?{$case:"speakersChanged",speakersChanged:Vi.fromJSON(e.speakersChanged)}:cr(e.roomUpdate)?{$case:"roomUpdate",roomUpdate:qi.fromJSON(e.roomUpdate)}:cr(e.connectionQuality)?{$case:"connectionQuality",connectionQuality:Gi.fromJSON(e.connectionQuality)}:cr(e.streamStateUpdate)?{$case:"streamStateUpdate",streamStateUpdate:Qi.fromJSON(e.streamStateUpdate)}:cr(e.subscribedQualityUpdate)?{$case:"subscribedQualityUpdate",subscribedQualityUpdate:Zi.fromJSON(e.subscribedQualityUpdate)}:cr(e.subscriptionPermissionUpdate)?{$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:er.fromJSON(e.subscriptionPermissionUpdate)}:cr(e.refreshToken)?{$case:"refreshToken",refreshToken:String(e.refreshToken)}:cr(e.trackUnpublished)?{$case:"trackUnpublished",trackUnpublished:Ai.fromJSON(e.trackUnpublished)}:cr(e.pong)?{$case:"pong",pong:Number(e.pong)}:cr(e.reconnect)?{$case:"reconnect",reconnect:Ii.fromJSON(e.reconnect)}:cr(e.pongResp)?{$case:"pongResp",pongResp:ar.fromJSON(e.pongResp)}:void 0}},toJSON:function(e){var t,n,i,r,a,o,s,c,u,d,l,p,f,h,v,m,g,b,k,y,S,w,C,R,T,P,E,_,x,O,N,I,D,A,U,L,M,F,B,j,J,$,V,q,W,G,H,Q,z,K,Z,Y,X,ee,te,ne={};return"join"===(null===(t=e.message)||void 0===t?void 0:t.$case)&&(ne.join=(null===(n=e.message)||void 0===n?void 0:n.join)?Ni.toJSON(null===(i=e.message)||void 0===i?void 0:i.join):void 0),"answer"===(null===(r=e.message)||void 0===r?void 0:r.$case)&&(ne.answer=(null===(a=e.message)||void 0===a?void 0:a.answer)?Ui.toJSON(null===(o=e.message)||void 0===o?void 0:o.answer):void 0),"offer"===(null===(s=e.message)||void 0===s?void 0:s.$case)&&(ne.offer=(null===(c=e.message)||void 0===c?void 0:c.offer)?Ui.toJSON(null===(u=e.message)||void 0===u?void 0:u.offer):void 0),"trickle"===(null===(d=e.message)||void 0===d?void 0:d.$case)&&(ne.trickle=(null===(l=e.message)||void 0===l?void 0:l.trickle)?xi.toJSON(null===(p=e.message)||void 0===p?void 0:p.trickle):void 0),"update"===(null===(f=e.message)||void 0===f?void 0:f.$case)&&(ne.update=(null===(h=e.message)||void 0===h?void 0:h.update)?Li.toJSON(null===(v=e.message)||void 0===v?void 0:v.update):void 0),"trackPublished"===(null===(m=e.message)||void 0===m?void 0:m.$case)&&(ne.trackPublished=(null===(g=e.message)||void 0===g?void 0:g.trackPublished)?Di.toJSON(null===(b=e.message)||void 0===b?void 0:b.trackPublished):void 0),"leave"===(null===(k=e.message)||void 0===k?void 0:k.$case)&&(ne.leave=(null===(y=e.message)||void 0===y?void 0:y.leave)?Bi.toJSON(null===(S=e.message)||void 0===S?void 0:S.leave):void 0),"mute"===(null===(w=e.message)||void 0===w?void 0:w.$case)&&(ne.mute=(null===(C=e.message)||void 0===C?void 0:C.mute)?Oi.toJSON(null===(R=e.message)||void 0===R?void 0:R.mute):void 0),"speakersChanged"===(null===(T=e.message)||void 0===T?void 0:T.$case)&&(ne.speakersChanged=(null===(P=e.message)||void 0===P?void 0:P.speakersChanged)?Vi.toJSON(null===(E=e.message)||void 0===E?void 0:E.speakersChanged):void 0),"roomUpdate"===(null===(_=e.message)||void 0===_?void 0:_.$case)&&(ne.roomUpdate=(null===(x=e.message)||void 0===x?void 0:x.roomUpdate)?qi.toJSON(null===(O=e.message)||void 0===O?void 0:O.roomUpdate):void 0),"connectionQuality"===(null===(N=e.message)||void 0===N?void 0:N.$case)&&(ne.connectionQuality=(null===(I=e.message)||void 0===I?void 0:I.connectionQuality)?Gi.toJSON(null===(D=e.message)||void 0===D?void 0:D.connectionQuality):void 0),"streamStateUpdate"===(null===(A=e.message)||void 0===A?void 0:A.$case)&&(ne.streamStateUpdate=(null===(U=e.message)||void 0===U?void 0:U.streamStateUpdate)?Qi.toJSON(null===(L=e.message)||void 0===L?void 0:L.streamStateUpdate):void 0),"subscribedQualityUpdate"===(null===(M=e.message)||void 0===M?void 0:M.$case)&&(ne.subscribedQualityUpdate=(null===(F=e.message)||void 0===F?void 0:F.subscribedQualityUpdate)?Zi.toJSON(null===(B=e.message)||void 0===B?void 0:B.subscribedQualityUpdate):void 0),"subscriptionPermissionUpdate"===(null===(j=e.message)||void 0===j?void 0:j.$case)&&(ne.subscriptionPermissionUpdate=(null===(J=e.message)||void 0===J?void 0:J.subscriptionPermissionUpdate)?er.toJSON(null===($=e.message)||void 0===$?void 0:$.subscriptionPermissionUpdate):void 0),"refreshToken"===(null===(V=e.message)||void 0===V?void 0:V.$case)&&(ne.refreshToken=null===(q=e.message)||void 0===q?void 0:q.refreshToken),"trackUnpublished"===(null===(W=e.message)||void 0===W?void 0:W.$case)&&(ne.trackUnpublished=(null===(G=e.message)||void 0===G?void 0:G.trackUnpublished)?Ai.toJSON(null===(H=e.message)||void 0===H?void 0:H.trackUnpublished):void 0),"pong"===(null===(Q=e.message)||void 0===Q?void 0:Q.$case)&&(ne.pong=Math.round(null===(z=e.message)||void 0===z?void 0:z.pong)),"reconnect"===(null===(K=e.message)||void 0===K?void 0:K.$case)&&(ne.reconnect=(null===(Z=e.message)||void 0===Z?void 0:Z.reconnect)?Ii.toJSON(null===(Y=e.message)||void 0===Y?void 0:Y.reconnect):void 0),"pongResp"===(null===(X=e.message)||void 0===X?void 0:X.$case)&&(ne.pongResp=(null===(ee=e.message)||void 0===ee?void 0:ee.pongResp)?ar.toJSON(null===(te=e.message)||void 0===te?void 0:te.pongResp):void 0),ne},create:function(e){return Pi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u,d,l,p,f,h,v,m,g,b,k,y,S,w,C,R,T,P,E,_,x,O,N,I,D,A,U,L,M,F,B,j,J,$,V,q,W,G,H,Q,z,K,Z,Y,X,ee,te,ne,ie,re={message:void 0};return"join"===(null===(t=e.message)||void 0===t?void 0:t.$case)&&void 0!==(null===(n=e.message)||void 0===n?void 0:n.join)&&null!==(null===(i=e.message)||void 0===i?void 0:i.join)&&(re.message={$case:"join",join:Ni.fromPartial(e.message.join)}),"answer"===(null===(r=e.message)||void 0===r?void 0:r.$case)&&void 0!==(null===(a=e.message)||void 0===a?void 0:a.answer)&&null!==(null===(o=e.message)||void 0===o?void 0:o.answer)&&(re.message={$case:"answer",answer:Ui.fromPartial(e.message.answer)}),"offer"===(null===(s=e.message)||void 0===s?void 0:s.$case)&&void 0!==(null===(c=e.message)||void 0===c?void 0:c.offer)&&null!==(null===(u=e.message)||void 0===u?void 0:u.offer)&&(re.message={$case:"offer",offer:Ui.fromPartial(e.message.offer)}),"trickle"===(null===(d=e.message)||void 0===d?void 0:d.$case)&&void 0!==(null===(l=e.message)||void 0===l?void 0:l.trickle)&&null!==(null===(p=e.message)||void 0===p?void 0:p.trickle)&&(re.message={$case:"trickle",trickle:xi.fromPartial(e.message.trickle)}),"update"===(null===(f=e.message)||void 0===f?void 0:f.$case)&&void 0!==(null===(h=e.message)||void 0===h?void 0:h.update)&&null!==(null===(v=e.message)||void 0===v?void 0:v.update)&&(re.message={$case:"update",update:Li.fromPartial(e.message.update)}),"trackPublished"===(null===(m=e.message)||void 0===m?void 0:m.$case)&&void 0!==(null===(g=e.message)||void 0===g?void 0:g.trackPublished)&&null!==(null===(b=e.message)||void 0===b?void 0:b.trackPublished)&&(re.message={$case:"trackPublished",trackPublished:Di.fromPartial(e.message.trackPublished)}),"leave"===(null===(k=e.message)||void 0===k?void 0:k.$case)&&void 0!==(null===(y=e.message)||void 0===y?void 0:y.leave)&&null!==(null===(S=e.message)||void 0===S?void 0:S.leave)&&(re.message={$case:"leave",leave:Bi.fromPartial(e.message.leave)}),"mute"===(null===(w=e.message)||void 0===w?void 0:w.$case)&&void 0!==(null===(C=e.message)||void 0===C?void 0:C.mute)&&null!==(null===(R=e.message)||void 0===R?void 0:R.mute)&&(re.message={$case:"mute",mute:Oi.fromPartial(e.message.mute)}),"speakersChanged"===(null===(T=e.message)||void 0===T?void 0:T.$case)&&void 0!==(null===(P=e.message)||void 0===P?void 0:P.speakersChanged)&&null!==(null===(E=e.message)||void 0===E?void 0:E.speakersChanged)&&(re.message={$case:"speakersChanged",speakersChanged:Vi.fromPartial(e.message.speakersChanged)}),"roomUpdate"===(null===(_=e.message)||void 0===_?void 0:_.$case)&&void 0!==(null===(x=e.message)||void 0===x?void 0:x.roomUpdate)&&null!==(null===(O=e.message)||void 0===O?void 0:O.roomUpdate)&&(re.message={$case:"roomUpdate",roomUpdate:qi.fromPartial(e.message.roomUpdate)}),"connectionQuality"===(null===(N=e.message)||void 0===N?void 0:N.$case)&&void 0!==(null===(I=e.message)||void 0===I?void 0:I.connectionQuality)&&null!==(null===(D=e.message)||void 0===D?void 0:D.connectionQuality)&&(re.message={$case:"connectionQuality",connectionQuality:Gi.fromPartial(e.message.connectionQuality)}),"streamStateUpdate"===(null===(A=e.message)||void 0===A?void 0:A.$case)&&void 0!==(null===(U=e.message)||void 0===U?void 0:U.streamStateUpdate)&&null!==(null===(L=e.message)||void 0===L?void 0:L.streamStateUpdate)&&(re.message={$case:"streamStateUpdate",streamStateUpdate:Qi.fromPartial(e.message.streamStateUpdate)}),"subscribedQualityUpdate"===(null===(M=e.message)||void 0===M?void 0:M.$case)&&void 0!==(null===(F=e.message)||void 0===F?void 0:F.subscribedQualityUpdate)&&null!==(null===(B=e.message)||void 0===B?void 0:B.subscribedQualityUpdate)&&(re.message={$case:"subscribedQualityUpdate",subscribedQualityUpdate:Zi.fromPartial(e.message.subscribedQualityUpdate)}),"subscriptionPermissionUpdate"===(null===(j=e.message)||void 0===j?void 0:j.$case)&&void 0!==(null===(J=e.message)||void 0===J?void 0:J.subscriptionPermissionUpdate)&&null!==(null===($=e.message)||void 0===$?void 0:$.subscriptionPermissionUpdate)&&(re.message={$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:er.fromPartial(e.message.subscriptionPermissionUpdate)}),"refreshToken"===(null===(V=e.message)||void 0===V?void 0:V.$case)&&void 0!==(null===(q=e.message)||void 0===q?void 0:q.refreshToken)&&null!==(null===(W=e.message)||void 0===W?void 0:W.refreshToken)&&(re.message={$case:"refreshToken",refreshToken:e.message.refreshToken}),"trackUnpublished"===(null===(G=e.message)||void 0===G?void 0:G.$case)&&void 0!==(null===(H=e.message)||void 0===H?void 0:H.trackUnpublished)&&null!==(null===(Q=e.message)||void 0===Q?void 0:Q.trackUnpublished)&&(re.message={$case:"trackUnpublished",trackUnpublished:Ai.fromPartial(e.message.trackUnpublished)}),"pong"===(null===(z=e.message)||void 0===z?void 0:z.$case)&&void 0!==(null===(K=e.message)||void 0===K?void 0:K.pong)&&null!==(null===(Z=e.message)||void 0===Z?void 0:Z.pong)&&(re.message={$case:"pong",pong:e.message.pong}),"reconnect"===(null===(Y=e.message)||void 0===Y?void 0:Y.$case)&&void 0!==(null===(X=e.message)||void 0===X?void 0:X.reconnect)&&null!==(null===(ee=e.message)||void 0===ee?void 0:ee.reconnect)&&(re.message={$case:"reconnect",reconnect:Ii.fromPartial(e.message.reconnect)}),"pongResp"===(null===(te=e.message)||void 0===te?void 0:te.$case)&&void 0!==(null===(ne=e.message)||void 0===ne?void 0:ne.pongResp)&&null!==(null===(ie=e.message)||void 0===ie?void 0:ie.pongResp)&&(re.message={$case:"pongResp",pongResp:ar.fromPartial(e.message.pongResp)}),re}},Ei={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.codec&&t.uint32(10).string(e.codec),""!==e.cid&&t.uint32(18).string(e.cid),!0===e.enableSimulcastLayers&&t.uint32(24).bool(e.enableSimulcastLayers),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={codec:"",cid:"",enableSimulcastLayers:!1};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.codec=n.string();continue;case 2:if(18!=a)break;r.cid=n.string();continue;case 3:if(24!=a)break;r.enableSimulcastLayers=n.bool();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{codec:cr(e.codec)?String(e.codec):"",cid:cr(e.cid)?String(e.cid):"",enableSimulcastLayers:!!cr(e.enableSimulcastLayers)&&Boolean(e.enableSimulcastLayers)}},toJSON:function(e){var t={};return void 0!==e.codec&&(t.codec=e.codec),void 0!==e.cid&&(t.cid=e.cid),void 0!==e.enableSimulcastLayers&&(t.enableSimulcastLayers=e.enableSimulcastLayers),t},create:function(e){return Ei.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={codec:"",cid:"",enableSimulcastLayers:!1};return r.codec=null!==(t=e.codec)&&void 0!==t?t:"",r.cid=null!==(n=e.cid)&&void 0!==n?n:"",r.enableSimulcastLayers=null!==(i=e.enableSimulcastLayers)&&void 0!==i&&i,r}},_i={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.cid&&t.uint32(10).string(e.cid),""!==e.name&&t.uint32(18).string(e.name),0!==e.type&&t.uint32(24).int32(e.type),0!==e.width&&t.uint32(32).uint32(e.width),0!==e.height&&t.uint32(40).uint32(e.height),!0===e.muted&&t.uint32(48).bool(e.muted),!0===e.disableDtx&&t.uint32(56).bool(e.disableDtx),0!==e.source&&t.uint32(64).int32(e.source);var n,i=_createForOfIteratorHelper(e.layers);try{for(i.s();!(n=i.n()).done;){var r=n.value;Tt.encode(r,t.uint32(74).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}var a,o=_createForOfIteratorHelper(e.simulcastCodecs);try{for(o.s();!(a=o.n()).done;){var s=a.value;Ei.encode(s,t.uint32(82).fork()).ldelim()}}catch(e){o.e(e)}finally{o.f()}return""!==e.sid&&t.uint32(90).string(e.sid),!0===e.stereo&&t.uint32(96).bool(e.stereo),!0===e.disableRed&&t.uint32(104).bool(e.disableRed),0!==e.encryption&&t.uint32(112).int32(e.encryption),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={cid:"",name:"",type:0,width:0,height:0,muted:!1,disableDtx:!1,source:0,layers:[],simulcastCodecs:[],sid:"",stereo:!1,disableRed:!1,encryption:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.cid=n.string();continue;case 2:if(18!=a)break;r.name=n.string();continue;case 3:if(24!=a)break;r.type=n.int32();continue;case 4:if(32!=a)break;r.width=n.uint32();continue;case 5:if(40!=a)break;r.height=n.uint32();continue;case 6:if(48!=a)break;r.muted=n.bool();continue;case 7:if(56!=a)break;r.disableDtx=n.bool();continue;case 8:if(64!=a)break;r.source=n.int32();continue;case 9:if(74!=a)break;r.layers.push(Tt.decode(n,n.uint32()));continue;case 10:if(82!=a)break;r.simulcastCodecs.push(Ei.decode(n,n.uint32()));continue;case 11:if(90!=a)break;r.sid=n.string();continue;case 12:if(96!=a)break;r.stereo=n.bool();continue;case 13:if(104!=a)break;r.disableRed=n.bool();continue;case 14:if(112!=a)break;r.encryption=n.int32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{cid:cr(e.cid)?String(e.cid):"",name:cr(e.name)?String(e.name):"",type:cr(e.type)?it(e.type):0,width:cr(e.width)?Number(e.width):0,height:cr(e.height)?Number(e.height):0,muted:!!cr(e.muted)&&Boolean(e.muted),disableDtx:!!cr(e.disableDtx)&&Boolean(e.disableDtx),source:cr(e.source)?at(e.source):0,layers:Array.isArray(null==e?void 0:e.layers)?e.layers.map((function(e){return Tt.fromJSON(e)})):[],simulcastCodecs:Array.isArray(null==e?void 0:e.simulcastCodecs)?e.simulcastCodecs.map((function(e){return Ei.fromJSON(e)})):[],sid:cr(e.sid)?String(e.sid):"",stereo:!!cr(e.stereo)&&Boolean(e.stereo),disableRed:!!cr(e.disableRed)&&Boolean(e.disableRed),encryption:cr(e.encryption)?ht(e.encryption):0}},toJSON:function(e){var t={};return void 0!==e.cid&&(t.cid=e.cid),void 0!==e.name&&(t.name=e.name),void 0!==e.type&&(t.type=rt(e.type)),void 0!==e.width&&(t.width=Math.round(e.width)),void 0!==e.height&&(t.height=Math.round(e.height)),void 0!==e.muted&&(t.muted=e.muted),void 0!==e.disableDtx&&(t.disableDtx=e.disableDtx),void 0!==e.source&&(t.source=ot(e.source)),e.layers?t.layers=e.layers.map((function(e){return e?Tt.toJSON(e):void 0})):t.layers=[],e.simulcastCodecs?t.simulcastCodecs=e.simulcastCodecs.map((function(e){return e?Ei.toJSON(e):void 0})):t.simulcastCodecs=[],void 0!==e.sid&&(t.sid=e.sid),void 0!==e.stereo&&(t.stereo=e.stereo),void 0!==e.disableRed&&(t.disableRed=e.disableRed),void 0!==e.encryption&&(t.encryption=vt(e.encryption)),t},create:function(e){return _i.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u,d,l,p,f,h,v={cid:"",name:"",type:0,width:0,height:0,muted:!1,disableDtx:!1,source:0,layers:[],simulcastCodecs:[],sid:"",stereo:!1,disableRed:!1,encryption:0};return v.cid=null!==(t=e.cid)&&void 0!==t?t:"",v.name=null!==(n=e.name)&&void 0!==n?n:"",v.type=null!==(i=e.type)&&void 0!==i?i:0,v.width=null!==(r=e.width)&&void 0!==r?r:0,v.height=null!==(a=e.height)&&void 0!==a?a:0,v.muted=null!==(o=e.muted)&&void 0!==o&&o,v.disableDtx=null!==(s=e.disableDtx)&&void 0!==s&&s,v.source=null!==(c=e.source)&&void 0!==c?c:0,v.layers=(null===(u=e.layers)||void 0===u?void 0:u.map((function(e){return Tt.fromPartial(e)})))||[],v.simulcastCodecs=(null===(d=e.simulcastCodecs)||void 0===d?void 0:d.map((function(e){return Ei.fromPartial(e)})))||[],v.sid=null!==(l=e.sid)&&void 0!==l?l:"",v.stereo=null!==(p=e.stereo)&&void 0!==p&&p,v.disableRed=null!==(f=e.disableRed)&&void 0!==f&&f,v.encryption=null!==(h=e.encryption)&&void 0!==h?h:0,v}},xi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.candidateInit&&t.uint32(10).string(e.candidateInit),0!==e.target&&t.uint32(16).int32(e.target),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={candidateInit:"",target:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.candidateInit=n.string();continue;case 2:if(16!=a)break;r.target=n.int32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{candidateInit:cr(e.candidateInit)?String(e.candidateInit):"",target:cr(e.target)?yi(e.target):0}},toJSON:function(e){var t={};return void 0!==e.candidateInit&&(t.candidateInit=e.candidateInit),void 0!==e.target&&(t.target=Si(e.target)),t},create:function(e){return xi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={candidateInit:"",target:0};return i.candidateInit=null!==(t=e.candidateInit)&&void 0!==t?t:"",i.target=null!==(n=e.target)&&void 0!==n?n:0,i}},Oi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.sid&&t.uint32(10).string(e.sid),!0===e.muted&&t.uint32(16).bool(e.muted),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={sid:"",muted:!1};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.sid=n.string();continue;case 2:if(16!=a)break;r.muted=n.bool();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{sid:cr(e.sid)?String(e.sid):"",muted:!!cr(e.muted)&&Boolean(e.muted)}},toJSON:function(e){var t={};return void 0!==e.sid&&(t.sid=e.sid),void 0!==e.muted&&(t.muted=e.muted),t},create:function(e){return Oi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={sid:"",muted:!1};return i.sid=null!==(t=e.sid)&&void 0!==t?t:"",i.muted=null!==(n=e.muted)&&void 0!==n&&n,i}},Ni={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();void 0!==e.room&&kt.encode(e.room,t.uint32(10).fork()).ldelim(),void 0!==e.participant&&wt.encode(e.participant,t.uint32(18).fork()).ldelim();var n,i=_createForOfIteratorHelper(e.otherParticipants);try{for(i.s();!(n=i.n()).done;){var r=n.value;wt.encode(r,t.uint32(26).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}""!==e.serverVersion&&t.uint32(34).string(e.serverVersion);var a,o=_createForOfIteratorHelper(e.iceServers);try{for(o.s();!(a=o.n()).done;){var s=a.value;$i.encode(s,t.uint32(42).fork()).ldelim()}}catch(e){o.e(e)}finally{o.f()}return!0===e.subscriberPrimary&&t.uint32(48).bool(e.subscriberPrimary),""!==e.alternativeUrl&&t.uint32(58).string(e.alternativeUrl),void 0!==e.clientConfiguration&&At.encode(e.clientConfiguration,t.uint32(66).fork()).ldelim(),""!==e.serverRegion&&t.uint32(74).string(e.serverRegion),0!==e.pingTimeout&&t.uint32(80).int32(e.pingTimeout),0!==e.pingInterval&&t.uint32(88).int32(e.pingInterval),void 0!==e.serverInfo&&It.encode(e.serverInfo,t.uint32(98).fork()).ldelim(),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={room:void 0,participant:void 0,otherParticipants:[],serverVersion:"",iceServers:[],subscriberPrimary:!1,alternativeUrl:"",clientConfiguration:void 0,serverRegion:"",pingTimeout:0,pingInterval:0,serverInfo:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.room=kt.decode(n,n.uint32());continue;case 2:if(18!=a)break;r.participant=wt.decode(n,n.uint32());continue;case 3:if(26!=a)break;r.otherParticipants.push(wt.decode(n,n.uint32()));continue;case 4:if(34!=a)break;r.serverVersion=n.string();continue;case 5:if(42!=a)break;r.iceServers.push($i.decode(n,n.uint32()));continue;case 6:if(48!=a)break;r.subscriberPrimary=n.bool();continue;case 7:if(58!=a)break;r.alternativeUrl=n.string();continue;case 8:if(66!=a)break;r.clientConfiguration=At.decode(n,n.uint32());continue;case 9:if(74!=a)break;r.serverRegion=n.string();continue;case 10:if(80!=a)break;r.pingTimeout=n.int32();continue;case 11:if(88!=a)break;r.pingInterval=n.int32();continue;case 12:if(98!=a)break;r.serverInfo=It.decode(n,n.uint32());continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{room:cr(e.room)?kt.fromJSON(e.room):void 0,participant:cr(e.participant)?wt.fromJSON(e.participant):void 0,otherParticipants:Array.isArray(null==e?void 0:e.otherParticipants)?e.otherParticipants.map((function(e){return wt.fromJSON(e)})):[],serverVersion:cr(e.serverVersion)?String(e.serverVersion):"",iceServers:Array.isArray(null==e?void 0:e.iceServers)?e.iceServers.map((function(e){return $i.fromJSON(e)})):[],subscriberPrimary:!!cr(e.subscriberPrimary)&&Boolean(e.subscriberPrimary),alternativeUrl:cr(e.alternativeUrl)?String(e.alternativeUrl):"",clientConfiguration:cr(e.clientConfiguration)?At.fromJSON(e.clientConfiguration):void 0,serverRegion:cr(e.serverRegion)?String(e.serverRegion):"",pingTimeout:cr(e.pingTimeout)?Number(e.pingTimeout):0,pingInterval:cr(e.pingInterval)?Number(e.pingInterval):0,serverInfo:cr(e.serverInfo)?It.fromJSON(e.serverInfo):void 0}},toJSON:function(e){var t={};return void 0!==e.room&&(t.room=e.room?kt.toJSON(e.room):void 0),void 0!==e.participant&&(t.participant=e.participant?wt.toJSON(e.participant):void 0),e.otherParticipants?t.otherParticipants=e.otherParticipants.map((function(e){return e?wt.toJSON(e):void 0})):t.otherParticipants=[],void 0!==e.serverVersion&&(t.serverVersion=e.serverVersion),e.iceServers?t.iceServers=e.iceServers.map((function(e){return e?$i.toJSON(e):void 0})):t.iceServers=[],void 0!==e.subscriberPrimary&&(t.subscriberPrimary=e.subscriberPrimary),void 0!==e.alternativeUrl&&(t.alternativeUrl=e.alternativeUrl),void 0!==e.clientConfiguration&&(t.clientConfiguration=e.clientConfiguration?At.toJSON(e.clientConfiguration):void 0),void 0!==e.serverRegion&&(t.serverRegion=e.serverRegion),void 0!==e.pingTimeout&&(t.pingTimeout=Math.round(e.pingTimeout)),void 0!==e.pingInterval&&(t.pingInterval=Math.round(e.pingInterval)),void 0!==e.serverInfo&&(t.serverInfo=e.serverInfo?It.toJSON(e.serverInfo):void 0),t},create:function(e){return Ni.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u={room:void 0,participant:void 0,otherParticipants:[],serverVersion:"",iceServers:[],subscriberPrimary:!1,alternativeUrl:"",clientConfiguration:void 0,serverRegion:"",pingTimeout:0,pingInterval:0,serverInfo:void 0};return u.room=void 0!==e.room&&null!==e.room?kt.fromPartial(e.room):void 0,u.participant=void 0!==e.participant&&null!==e.participant?wt.fromPartial(e.participant):void 0,u.otherParticipants=(null===(t=e.otherParticipants)||void 0===t?void 0:t.map((function(e){return wt.fromPartial(e)})))||[],u.serverVersion=null!==(n=e.serverVersion)&&void 0!==n?n:"",u.iceServers=(null===(i=e.iceServers)||void 0===i?void 0:i.map((function(e){return $i.fromPartial(e)})))||[],u.subscriberPrimary=null!==(r=e.subscriberPrimary)&&void 0!==r&&r,u.alternativeUrl=null!==(a=e.alternativeUrl)&&void 0!==a?a:"",u.clientConfiguration=void 0!==e.clientConfiguration&&null!==e.clientConfiguration?At.fromPartial(e.clientConfiguration):void 0,u.serverRegion=null!==(o=e.serverRegion)&&void 0!==o?o:"",u.pingTimeout=null!==(s=e.pingTimeout)&&void 0!==s?s:0,u.pingInterval=null!==(c=e.pingInterval)&&void 0!==c?c:0,u.serverInfo=void 0!==e.serverInfo&&null!==e.serverInfo?It.fromPartial(e.serverInfo):void 0,u}},Ii={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.iceServers);try{for(i.s();!(t=i.n()).done;){var r=t.value;$i.encode(r,n.uint32(10).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return void 0!==e.clientConfiguration&&At.encode(e.clientConfiguration,n.uint32(18).fork()).ldelim(),n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={iceServers:[],clientConfiguration:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.iceServers.push($i.decode(n,n.uint32()));continue;case 2:if(18!=a)break;r.clientConfiguration=At.decode(n,n.uint32());continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{iceServers:Array.isArray(null==e?void 0:e.iceServers)?e.iceServers.map((function(e){return $i.fromJSON(e)})):[],clientConfiguration:cr(e.clientConfiguration)?At.fromJSON(e.clientConfiguration):void 0}},toJSON:function(e){var t={};return e.iceServers?t.iceServers=e.iceServers.map((function(e){return e?$i.toJSON(e):void 0})):t.iceServers=[],void 0!==e.clientConfiguration&&(t.clientConfiguration=e.clientConfiguration?At.toJSON(e.clientConfiguration):void 0),t},create:function(e){return Ii.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={iceServers:[],clientConfiguration:void 0};return n.iceServers=(null===(t=e.iceServers)||void 0===t?void 0:t.map((function(e){return $i.fromPartial(e)})))||[],n.clientConfiguration=void 0!==e.clientConfiguration&&null!==e.clientConfiguration?At.fromPartial(e.clientConfiguration):void 0,n}},Di={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.cid&&t.uint32(10).string(e.cid),void 0!==e.track&&Rt.encode(e.track,t.uint32(18).fork()).ldelim(),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={cid:"",track:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.cid=n.string();continue;case 2:if(18!=a)break;r.track=Rt.decode(n,n.uint32());continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{cid:cr(e.cid)?String(e.cid):"",track:cr(e.track)?Rt.fromJSON(e.track):void 0}},toJSON:function(e){var t={};return void 0!==e.cid&&(t.cid=e.cid),void 0!==e.track&&(t.track=e.track?Rt.toJSON(e.track):void 0),t},create:function(e){return Di.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={cid:"",track:void 0};return n.cid=null!==(t=e.cid)&&void 0!==t?t:"",n.track=void 0!==e.track&&null!==e.track?Rt.fromPartial(e.track):void 0,n}},Ai={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.trackSid&&t.uint32(10).string(e.trackSid),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={trackSid:""};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.trackSid=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{trackSid:cr(e.trackSid)?String(e.trackSid):""}},toJSON:function(e){var t={};return void 0!==e.trackSid&&(t.trackSid=e.trackSid),t},create:function(e){return Ai.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={trackSid:""};return n.trackSid=null!==(t=e.trackSid)&&void 0!==t?t:"",n}},Ui={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.type&&t.uint32(10).string(e.type),""!==e.sdp&&t.uint32(18).string(e.sdp),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={type:"",sdp:""};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.type=n.string();continue;case 2:if(18!=a)break;r.sdp=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{type:cr(e.type)?String(e.type):"",sdp:cr(e.sdp)?String(e.sdp):""}},toJSON:function(e){var t={};return void 0!==e.type&&(t.type=e.type),void 0!==e.sdp&&(t.sdp=e.sdp),t},create:function(e){return Ui.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={type:"",sdp:""};return i.type=null!==(t=e.type)&&void 0!==t?t:"",i.sdp=null!==(n=e.sdp)&&void 0!==n?n:"",i}},Li={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.participants);try{for(i.s();!(t=i.n()).done;){var r=t.value;wt.encode(r,n.uint32(10).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={participants:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.participants.push(wt.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{participants:Array.isArray(null==e?void 0:e.participants)?e.participants.map((function(e){return wt.fromJSON(e)})):[]}},toJSON:function(e){var t={};return e.participants?t.participants=e.participants.map((function(e){return e?wt.toJSON(e):void 0})):t.participants=[],t},create:function(e){return Li.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={participants:[]};return n.participants=(null===(t=e.participants)||void 0===t?void 0:t.map((function(e){return wt.fromPartial(e)})))||[],n}},Mi={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.trackSids);try{for(i.s();!(t=i.n()).done;){var r=t.value;n.uint32(10).string(r)}}catch(e){i.e(e)}finally{i.f()}!0===e.subscribe&&n.uint32(16).bool(e.subscribe);var a,o=_createForOfIteratorHelper(e.participantTracks);try{for(o.s();!(a=o.n()).done;){var s=a.value;Nt.encode(s,n.uint32(26).fork()).ldelim()}}catch(e){o.e(e)}finally{o.f()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={trackSids:[],subscribe:!1,participantTracks:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.trackSids.push(n.string());continue;case 2:if(16!=a)break;r.subscribe=n.bool();continue;case 3:if(26!=a)break;r.participantTracks.push(Nt.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{trackSids:Array.isArray(null==e?void 0:e.trackSids)?e.trackSids.map((function(e){return String(e)})):[],subscribe:!!cr(e.subscribe)&&Boolean(e.subscribe),participantTracks:Array.isArray(null==e?void 0:e.participantTracks)?e.participantTracks.map((function(e){return Nt.fromJSON(e)})):[]}},toJSON:function(e){var t={};return e.trackSids?t.trackSids=e.trackSids.map((function(e){return e})):t.trackSids=[],void 0!==e.subscribe&&(t.subscribe=e.subscribe),e.participantTracks?t.participantTracks=e.participantTracks.map((function(e){return e?Nt.toJSON(e):void 0})):t.participantTracks=[],t},create:function(e){return Mi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={trackSids:[],subscribe:!1,participantTracks:[]};return r.trackSids=(null===(t=e.trackSids)||void 0===t?void 0:t.map((function(e){return e})))||[],r.subscribe=null!==(n=e.subscribe)&&void 0!==n&&n,r.participantTracks=(null===(i=e.participantTracks)||void 0===i?void 0:i.map((function(e){return Nt.fromPartial(e)})))||[],r}},Fi={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.trackSids);try{for(i.s();!(t=i.n()).done;){var r=t.value;n.uint32(10).string(r)}}catch(e){i.e(e)}finally{i.f()}return!0===e.disabled&&n.uint32(24).bool(e.disabled),0!==e.quality&&n.uint32(32).int32(e.quality),0!==e.width&&n.uint32(40).uint32(e.width),0!==e.height&&n.uint32(48).uint32(e.height),0!==e.fps&&n.uint32(56).uint32(e.fps),0!==e.priority&&n.uint32(64).uint32(e.priority),n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={trackSids:[],disabled:!1,quality:0,width:0,height:0,fps:0,priority:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.trackSids.push(n.string());continue;case 3:if(24!=a)break;r.disabled=n.bool();continue;case 4:if(32!=a)break;r.quality=n.int32();continue;case 5:if(40!=a)break;r.width=n.uint32();continue;case 6:if(48!=a)break;r.height=n.uint32();continue;case 7:if(56!=a)break;r.fps=n.uint32();continue;case 8:if(64!=a)break;r.priority=n.uint32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{trackSids:Array.isArray(null==e?void 0:e.trackSids)?e.trackSids.map((function(e){return String(e)})):[],disabled:!!cr(e.disabled)&&Boolean(e.disabled),quality:cr(e.quality)?st(e.quality):0,width:cr(e.width)?Number(e.width):0,height:cr(e.height)?Number(e.height):0,fps:cr(e.fps)?Number(e.fps):0,priority:cr(e.priority)?Number(e.priority):0}},toJSON:function(e){var t={};return e.trackSids?t.trackSids=e.trackSids.map((function(e){return e})):t.trackSids=[],void 0!==e.disabled&&(t.disabled=e.disabled),void 0!==e.quality&&(t.quality=ct(e.quality)),void 0!==e.width&&(t.width=Math.round(e.width)),void 0!==e.height&&(t.height=Math.round(e.height)),void 0!==e.fps&&(t.fps=Math.round(e.fps)),void 0!==e.priority&&(t.priority=Math.round(e.priority)),t},create:function(e){return Fi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c={trackSids:[],disabled:!1,quality:0,width:0,height:0,fps:0,priority:0};return c.trackSids=(null===(t=e.trackSids)||void 0===t?void 0:t.map((function(e){return e})))||[],c.disabled=null!==(n=e.disabled)&&void 0!==n&&n,c.quality=null!==(i=e.quality)&&void 0!==i?i:0,c.width=null!==(r=e.width)&&void 0!==r?r:0,c.height=null!==(a=e.height)&&void 0!==a?a:0,c.fps=null!==(o=e.fps)&&void 0!==o?o:0,c.priority=null!==(s=e.priority)&&void 0!==s?s:0,c}},Bi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return!0===e.canReconnect&&t.uint32(8).bool(e.canReconnect),0!==e.reason&&t.uint32(16).int32(e.reason),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={canReconnect:!1,reason:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.canReconnect=n.bool();continue;case 2:if(16!=a)break;r.reason=n.int32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{canReconnect:!!cr(e.canReconnect)&&Boolean(e.canReconnect),reason:cr(e.reason)?pt(e.reason):0}},toJSON:function(t){var n={};return void 0!==t.canReconnect&&(n.canReconnect=t.canReconnect),void 0!==t.reason&&(n.reason=function(t){switch(t){case e.DisconnectReason.UNKNOWN_REASON:return"UNKNOWN_REASON";case e.DisconnectReason.CLIENT_INITIATED:return"CLIENT_INITIATED";case e.DisconnectReason.DUPLICATE_IDENTITY:return"DUPLICATE_IDENTITY";case e.DisconnectReason.SERVER_SHUTDOWN:return"SERVER_SHUTDOWN";case e.DisconnectReason.PARTICIPANT_REMOVED:return"PARTICIPANT_REMOVED";case e.DisconnectReason.ROOM_DELETED:return"ROOM_DELETED";case e.DisconnectReason.STATE_MISMATCH:return"STATE_MISMATCH";case e.DisconnectReason.JOIN_FAILURE:return"JOIN_FAILURE";case e.DisconnectReason.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(t.reason)),n},create:function(e){return Bi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={canReconnect:!1,reason:0};return i.canReconnect=null!==(t=e.canReconnect)&&void 0!==t&&t,i.reason=null!==(n=e.reason)&&void 0!==n?n:0,i}},ji={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.trackSid&&t.uint32(10).string(e.trackSid);var n,i=_createForOfIteratorHelper(e.layers);try{for(i.s();!(n=i.n()).done;){var r=n.value;Tt.encode(r,t.uint32(18).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={trackSid:"",layers:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.trackSid=n.string();continue;case 2:if(18!=a)break;r.layers.push(Tt.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{trackSid:cr(e.trackSid)?String(e.trackSid):"",layers:Array.isArray(null==e?void 0:e.layers)?e.layers.map((function(e){return Tt.fromJSON(e)})):[]}},toJSON:function(e){var t={};return void 0!==e.trackSid&&(t.trackSid=e.trackSid),e.layers?t.layers=e.layers.map((function(e){return e?Tt.toJSON(e):void 0})):t.layers=[],t},create:function(e){return ji.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={trackSid:"",layers:[]};return i.trackSid=null!==(t=e.trackSid)&&void 0!==t?t:"",i.layers=(null===(n=e.layers)||void 0===n?void 0:n.map((function(e){return Tt.fromPartial(e)})))||[],i}},Ji={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.metadata&&t.uint32(10).string(e.metadata),""!==e.name&&t.uint32(18).string(e.name),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={metadata:"",name:""};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.metadata=n.string();continue;case 2:if(18!=a)break;r.name=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{metadata:cr(e.metadata)?String(e.metadata):"",name:cr(e.name)?String(e.name):""}},toJSON:function(e){var t={};return void 0!==e.metadata&&(t.metadata=e.metadata),void 0!==e.name&&(t.name=e.name),t},create:function(e){return Ji.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={metadata:"",name:""};return i.metadata=null!==(t=e.metadata)&&void 0!==t?t:"",i.name=null!==(n=e.name)&&void 0!==n?n:"",i}},$i={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.urls);try{for(i.s();!(t=i.n()).done;){var r=t.value;n.uint32(10).string(r)}}catch(e){i.e(e)}finally{i.f()}return""!==e.username&&n.uint32(18).string(e.username),""!==e.credential&&n.uint32(26).string(e.credential),n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={urls:[],username:"",credential:""};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.urls.push(n.string());continue;case 2:if(18!=a)break;r.username=n.string();continue;case 3:if(26!=a)break;r.credential=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{urls:Array.isArray(null==e?void 0:e.urls)?e.urls.map((function(e){return String(e)})):[],username:cr(e.username)?String(e.username):"",credential:cr(e.credential)?String(e.credential):""}},toJSON:function(e){var t={};return e.urls?t.urls=e.urls.map((function(e){return e})):t.urls=[],void 0!==e.username&&(t.username=e.username),void 0!==e.credential&&(t.credential=e.credential),t},create:function(e){return $i.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={urls:[],username:"",credential:""};return r.urls=(null===(t=e.urls)||void 0===t?void 0:t.map((function(e){return e})))||[],r.username=null!==(n=e.username)&&void 0!==n?n:"",r.credential=null!==(i=e.credential)&&void 0!==i?i:"",r}},Vi={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.speakers);try{for(i.s();!(t=i.n()).done;){var r=t.value;_t.encode(r,n.uint32(10).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={speakers:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.speakers.push(_t.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{speakers:Array.isArray(null==e?void 0:e.speakers)?e.speakers.map((function(e){return _t.fromJSON(e)})):[]}},toJSON:function(e){var t={};return e.speakers?t.speakers=e.speakers.map((function(e){return e?_t.toJSON(e):void 0})):t.speakers=[],t},create:function(e){return Vi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={speakers:[]};return n.speakers=(null===(t=e.speakers)||void 0===t?void 0:t.map((function(e){return _t.fromPartial(e)})))||[],n}},qi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return void 0!==e.room&&kt.encode(e.room,t.uint32(10).fork()).ldelim(),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={room:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.room=kt.decode(n,n.uint32());continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{room:cr(e.room)?kt.fromJSON(e.room):void 0}},toJSON:function(e){var t={};return void 0!==e.room&&(t.room=e.room?kt.toJSON(e.room):void 0),t},create:function(e){return qi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t={room:void 0};return t.room=void 0!==e.room&&null!==e.room?kt.fromPartial(e.room):void 0,t}},Wi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.participantSid&&t.uint32(10).string(e.participantSid),0!==e.quality&&t.uint32(16).int32(e.quality),0!==e.score&&t.uint32(29).float(e.score),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={participantSid:"",quality:0,score:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.participantSid=n.string();continue;case 2:if(16!=a)break;r.quality=n.int32();continue;case 3:if(29!=a)break;r.score=n.float();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{participantSid:cr(e.participantSid)?String(e.participantSid):"",quality:cr(e.quality)?ut(e.quality):0,score:cr(e.score)?Number(e.score):0}},toJSON:function(e){var t={};return void 0!==e.participantSid&&(t.participantSid=e.participantSid),void 0!==e.quality&&(t.quality=function(e){switch(e){case He.POOR:return"POOR";case He.GOOD:return"GOOD";case He.EXCELLENT:return"EXCELLENT";case He.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.quality)),void 0!==e.score&&(t.score=e.score),t},create:function(e){return Wi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={participantSid:"",quality:0,score:0};return r.participantSid=null!==(t=e.participantSid)&&void 0!==t?t:"",r.quality=null!==(n=e.quality)&&void 0!==n?n:0,r.score=null!==(i=e.score)&&void 0!==i?i:0,r}},Gi={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.updates);try{for(i.s();!(t=i.n()).done;){var r=t.value;Wi.encode(r,n.uint32(10).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={updates:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.updates.push(Wi.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{updates:Array.isArray(null==e?void 0:e.updates)?e.updates.map((function(e){return Wi.fromJSON(e)})):[]}},toJSON:function(e){var t={};return e.updates?t.updates=e.updates.map((function(e){return e?Wi.toJSON(e):void 0})):t.updates=[],t},create:function(e){return Gi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={updates:[]};return n.updates=(null===(t=e.updates)||void 0===t?void 0:t.map((function(e){return Wi.fromPartial(e)})))||[],n}},Hi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.participantSid&&t.uint32(10).string(e.participantSid),""!==e.trackSid&&t.uint32(18).string(e.trackSid),0!==e.state&&t.uint32(24).int32(e.state),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={participantSid:"",trackSid:"",state:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.participantSid=n.string();continue;case 2:if(18!=a)break;r.trackSid=n.string();continue;case 3:if(24!=a)break;r.state=n.int32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{participantSid:cr(e.participantSid)?String(e.participantSid):"",trackSid:cr(e.trackSid)?String(e.trackSid):"",state:cr(e.state)?wi(e.state):0}},toJSON:function(e){var t={};return void 0!==e.participantSid&&(t.participantSid=e.participantSid),void 0!==e.trackSid&&(t.trackSid=e.trackSid),void 0!==e.state&&(t.state=function(e){switch(e){case gi.ACTIVE:return"ACTIVE";case gi.PAUSED:return"PAUSED";case gi.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.state)),t},create:function(e){return Hi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={participantSid:"",trackSid:"",state:0};return r.participantSid=null!==(t=e.participantSid)&&void 0!==t?t:"",r.trackSid=null!==(n=e.trackSid)&&void 0!==n?n:"",r.state=null!==(i=e.state)&&void 0!==i?i:0,r}},Qi={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create(),i=_createForOfIteratorHelper(e.streamStates);try{for(i.s();!(t=i.n()).done;){var r=t.value;Hi.encode(r,n.uint32(10).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={streamStates:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.streamStates.push(Hi.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{streamStates:Array.isArray(null==e?void 0:e.streamStates)?e.streamStates.map((function(e){return Hi.fromJSON(e)})):[]}},toJSON:function(e){var t={};return e.streamStates?t.streamStates=e.streamStates.map((function(e){return e?Hi.toJSON(e):void 0})):t.streamStates=[],t},create:function(e){return Qi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n={streamStates:[]};return n.streamStates=(null===(t=e.streamStates)||void 0===t?void 0:t.map((function(e){return Hi.fromPartial(e)})))||[],n}},zi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return 0!==e.quality&&t.uint32(8).int32(e.quality),!0===e.enabled&&t.uint32(16).bool(e.enabled),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={quality:0,enabled:!1};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.quality=n.int32();continue;case 2:if(16!=a)break;r.enabled=n.bool();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{quality:cr(e.quality)?st(e.quality):0,enabled:!!cr(e.enabled)&&Boolean(e.enabled)}},toJSON:function(e){var t={};return void 0!==e.quality&&(t.quality=ct(e.quality)),void 0!==e.enabled&&(t.enabled=e.enabled),t},create:function(e){return zi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={quality:0,enabled:!1};return i.quality=null!==(t=e.quality)&&void 0!==t?t:0,i.enabled=null!==(n=e.enabled)&&void 0!==n&&n,i}},Ki={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.codec&&t.uint32(10).string(e.codec);var n,i=_createForOfIteratorHelper(e.qualities);try{for(i.s();!(n=i.n()).done;){var r=n.value;zi.encode(r,t.uint32(18).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={codec:"",qualities:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.codec=n.string();continue;case 2:if(18!=a)break;r.qualities.push(zi.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{codec:cr(e.codec)?String(e.codec):"",qualities:Array.isArray(null==e?void 0:e.qualities)?e.qualities.map((function(e){return zi.fromJSON(e)})):[]}},toJSON:function(e){var t={};return void 0!==e.codec&&(t.codec=e.codec),e.qualities?t.qualities=e.qualities.map((function(e){return e?zi.toJSON(e):void 0})):t.qualities=[],t},create:function(e){return Ki.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={codec:"",qualities:[]};return i.codec=null!==(t=e.codec)&&void 0!==t?t:"",i.qualities=(null===(n=e.qualities)||void 0===n?void 0:n.map((function(e){return zi.fromPartial(e)})))||[],i}},Zi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.trackSid&&t.uint32(10).string(e.trackSid);var n,i=_createForOfIteratorHelper(e.subscribedQualities);try{for(i.s();!(n=i.n()).done;){var r=n.value;zi.encode(r,t.uint32(18).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}var a,o=_createForOfIteratorHelper(e.subscribedCodecs);try{for(o.s();!(a=o.n()).done;){var s=a.value;Ki.encode(s,t.uint32(26).fork()).ldelim()}}catch(e){o.e(e)}finally{o.f()}return t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={trackSid:"",subscribedQualities:[],subscribedCodecs:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.trackSid=n.string();continue;case 2:if(18!=a)break;r.subscribedQualities.push(zi.decode(n,n.uint32()));continue;case 3:if(26!=a)break;r.subscribedCodecs.push(Ki.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{trackSid:cr(e.trackSid)?String(e.trackSid):"",subscribedQualities:Array.isArray(null==e?void 0:e.subscribedQualities)?e.subscribedQualities.map((function(e){return zi.fromJSON(e)})):[],subscribedCodecs:Array.isArray(null==e?void 0:e.subscribedCodecs)?e.subscribedCodecs.map((function(e){return Ki.fromJSON(e)})):[]}},toJSON:function(e){var t={};return void 0!==e.trackSid&&(t.trackSid=e.trackSid),e.subscribedQualities?t.subscribedQualities=e.subscribedQualities.map((function(e){return e?zi.toJSON(e):void 0})):t.subscribedQualities=[],e.subscribedCodecs?t.subscribedCodecs=e.subscribedCodecs.map((function(e){return e?Ki.toJSON(e):void 0})):t.subscribedCodecs=[],t},create:function(e){return Zi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={trackSid:"",subscribedQualities:[],subscribedCodecs:[]};return r.trackSid=null!==(t=e.trackSid)&&void 0!==t?t:"",r.subscribedQualities=(null===(n=e.subscribedQualities)||void 0===n?void 0:n.map((function(e){return zi.fromPartial(e)})))||[],r.subscribedCodecs=(null===(i=e.subscribedCodecs)||void 0===i?void 0:i.map((function(e){return Ki.fromPartial(e)})))||[],r}},Yi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();""!==e.participantSid&&t.uint32(10).string(e.participantSid),!0===e.allTracks&&t.uint32(16).bool(e.allTracks);var n,i=_createForOfIteratorHelper(e.trackSids);try{for(i.s();!(n=i.n()).done;){var r=n.value;t.uint32(26).string(r)}}catch(e){i.e(e)}finally{i.f()}return""!==e.participantIdentity&&t.uint32(34).string(e.participantIdentity),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={participantSid:"",allTracks:!1,trackSids:[],participantIdentity:""};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.participantSid=n.string();continue;case 2:if(16!=a)break;r.allTracks=n.bool();continue;case 3:if(26!=a)break;r.trackSids.push(n.string());continue;case 4:if(34!=a)break;r.participantIdentity=n.string();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{participantSid:cr(e.participantSid)?String(e.participantSid):"",allTracks:!!cr(e.allTracks)&&Boolean(e.allTracks),trackSids:Array.isArray(null==e?void 0:e.trackSids)?e.trackSids.map((function(e){return String(e)})):[],participantIdentity:cr(e.participantIdentity)?String(e.participantIdentity):""}},toJSON:function(e){var t={};return void 0!==e.participantSid&&(t.participantSid=e.participantSid),void 0!==e.allTracks&&(t.allTracks=e.allTracks),e.trackSids?t.trackSids=e.trackSids.map((function(e){return e})):t.trackSids=[],void 0!==e.participantIdentity&&(t.participantIdentity=e.participantIdentity),t},create:function(e){return Yi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a={participantSid:"",allTracks:!1,trackSids:[],participantIdentity:""};return a.participantSid=null!==(t=e.participantSid)&&void 0!==t?t:"",a.allTracks=null!==(n=e.allTracks)&&void 0!==n&&n,a.trackSids=(null===(i=e.trackSids)||void 0===i?void 0:i.map((function(e){return e})))||[],a.participantIdentity=null!==(r=e.participantIdentity)&&void 0!==r?r:"",a}},Xi={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();!0===e.allParticipants&&t.uint32(8).bool(e.allParticipants);var n,i=_createForOfIteratorHelper(e.trackPermissions);try{for(i.s();!(n=i.n()).done;){var r=n.value;Yi.encode(r,t.uint32(18).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}return t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={allParticipants:!1,trackPermissions:[]};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.allParticipants=n.bool();continue;case 2:if(18!=a)break;r.trackPermissions.push(Yi.decode(n,n.uint32()));continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{allParticipants:!!cr(e.allParticipants)&&Boolean(e.allParticipants),trackPermissions:Array.isArray(null==e?void 0:e.trackPermissions)?e.trackPermissions.map((function(e){return Yi.fromJSON(e)})):[]}},toJSON:function(e){var t={};return void 0!==e.allParticipants&&(t.allParticipants=e.allParticipants),e.trackPermissions?t.trackPermissions=e.trackPermissions.map((function(e){return e?Yi.toJSON(e):void 0})):t.trackPermissions=[],t},create:function(e){return Xi.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={allParticipants:!1,trackPermissions:[]};return i.allParticipants=null!==(t=e.allParticipants)&&void 0!==t&&t,i.trackPermissions=(null===(n=e.trackPermissions)||void 0===n?void 0:n.map((function(e){return Yi.fromPartial(e)})))||[],i}},er={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.participantSid&&t.uint32(10).string(e.participantSid),""!==e.trackSid&&t.uint32(18).string(e.trackSid),!0===e.allowed&&t.uint32(24).bool(e.allowed),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={participantSid:"",trackSid:"",allowed:!1};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.participantSid=n.string();continue;case 2:if(18!=a)break;r.trackSid=n.string();continue;case 3:if(24!=a)break;r.allowed=n.bool();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{participantSid:cr(e.participantSid)?String(e.participantSid):"",trackSid:cr(e.trackSid)?String(e.trackSid):"",allowed:!!cr(e.allowed)&&Boolean(e.allowed)}},toJSON:function(e){var t={};return void 0!==e.participantSid&&(t.participantSid=e.participantSid),void 0!==e.trackSid&&(t.trackSid=e.trackSid),void 0!==e.allowed&&(t.allowed=e.allowed),t},create:function(e){return er.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={participantSid:"",trackSid:"",allowed:!1};return r.participantSid=null!==(t=e.participantSid)&&void 0!==t?t:"",r.trackSid=null!==(n=e.trackSid)&&void 0!==n?n:"",r.allowed=null!==(i=e.allowed)&&void 0!==i&&i,r}},tr={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();void 0!==e.answer&&Ui.encode(e.answer,t.uint32(10).fork()).ldelim(),void 0!==e.subscription&&Mi.encode(e.subscription,t.uint32(18).fork()).ldelim();var n,i=_createForOfIteratorHelper(e.publishTracks);try{for(i.s();!(n=i.n()).done;){var r=n.value;Di.encode(r,t.uint32(26).fork()).ldelim()}}catch(e){i.e(e)}finally{i.f()}var a,o=_createForOfIteratorHelper(e.dataChannels);try{for(o.s();!(a=o.n()).done;){var s=a.value;nr.encode(s,t.uint32(34).fork()).ldelim()}}catch(e){o.e(e)}finally{o.f()}return void 0!==e.offer&&Ui.encode(e.offer,t.uint32(42).fork()).ldelim(),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={answer:void 0,subscription:void 0,publishTracks:[],dataChannels:[],offer:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.answer=Ui.decode(n,n.uint32());continue;case 2:if(18!=a)break;r.subscription=Mi.decode(n,n.uint32());continue;case 3:if(26!=a)break;r.publishTracks.push(Di.decode(n,n.uint32()));continue;case 4:if(34!=a)break;r.dataChannels.push(nr.decode(n,n.uint32()));continue;case 5:if(42!=a)break;r.offer=Ui.decode(n,n.uint32());continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{answer:cr(e.answer)?Ui.fromJSON(e.answer):void 0,subscription:cr(e.subscription)?Mi.fromJSON(e.subscription):void 0,publishTracks:Array.isArray(null==e?void 0:e.publishTracks)?e.publishTracks.map((function(e){return Di.fromJSON(e)})):[],dataChannels:Array.isArray(null==e?void 0:e.dataChannels)?e.dataChannels.map((function(e){return nr.fromJSON(e)})):[],offer:cr(e.offer)?Ui.fromJSON(e.offer):void 0}},toJSON:function(e){var t={};return void 0!==e.answer&&(t.answer=e.answer?Ui.toJSON(e.answer):void 0),void 0!==e.subscription&&(t.subscription=e.subscription?Mi.toJSON(e.subscription):void 0),e.publishTracks?t.publishTracks=e.publishTracks.map((function(e){return e?Di.toJSON(e):void 0})):t.publishTracks=[],e.dataChannels?t.dataChannels=e.dataChannels.map((function(e){return e?nr.toJSON(e):void 0})):t.dataChannels=[],void 0!==e.offer&&(t.offer=e.offer?Ui.toJSON(e.offer):void 0),t},create:function(e){return tr.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={answer:void 0,subscription:void 0,publishTracks:[],dataChannels:[],offer:void 0};return i.answer=void 0!==e.answer&&null!==e.answer?Ui.fromPartial(e.answer):void 0,i.subscription=void 0!==e.subscription&&null!==e.subscription?Mi.fromPartial(e.subscription):void 0,i.publishTracks=(null===(t=e.publishTracks)||void 0===t?void 0:t.map((function(e){return Di.fromPartial(e)})))||[],i.dataChannels=(null===(n=e.dataChannels)||void 0===n?void 0:n.map((function(e){return nr.fromPartial(e)})))||[],i.offer=void 0!==e.offer&&null!==e.offer?Ui.fromPartial(e.offer):void 0,i}},nr={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return""!==e.label&&t.uint32(10).string(e.label),0!==e.id&&t.uint32(16).uint32(e.id),0!==e.target&&t.uint32(24).int32(e.target),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={label:"",id:0,target:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(10!=a)break;r.label=n.string();continue;case 2:if(16!=a)break;r.id=n.uint32();continue;case 3:if(24!=a)break;r.target=n.int32();continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{label:cr(e.label)?String(e.label):"",id:cr(e.id)?Number(e.id):0,target:cr(e.target)?yi(e.target):0}},toJSON:function(e){var t={};return void 0!==e.label&&(t.label=e.label),void 0!==e.id&&(t.id=Math.round(e.id)),void 0!==e.target&&(t.target=Si(e.target)),t},create:function(e){return nr.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r={label:"",id:0,target:0};return r.label=null!==(t=e.label)&&void 0!==t?t:"",r.id=null!==(n=e.id)&&void 0!==n?n:0,r.target=null!==(i=e.target)&&void 0!==i?i:0,r}},ir={encode:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();switch(null===(t=e.scenario)||void 0===t?void 0:t.$case){case"speakerUpdate":n.uint32(8).int32(e.scenario.speakerUpdate);break;case"nodeFailure":n.uint32(16).bool(e.scenario.nodeFailure);break;case"migration":n.uint32(24).bool(e.scenario.migration);break;case"serverLeave":n.uint32(32).bool(e.scenario.serverLeave);break;case"switchCandidateProtocol":n.uint32(40).int32(e.scenario.switchCandidateProtocol);break;case"subscriberBandwidth":n.uint32(48).int64(e.scenario.subscriberBandwidth)}return n},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={scenario:void 0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.scenario={$case:"speakerUpdate",speakerUpdate:n.int32()};continue;case 2:if(16!=a)break;r.scenario={$case:"nodeFailure",nodeFailure:n.bool()};continue;case 3:if(24!=a)break;r.scenario={$case:"migration",migration:n.bool()};continue;case 4:if(32!=a)break;r.scenario={$case:"serverLeave",serverLeave:n.bool()};continue;case 5:if(40!=a)break;r.scenario={$case:"switchCandidateProtocol",switchCandidateProtocol:n.int32()};continue;case 6:if(48!=a)break;r.scenario={$case:"subscriberBandwidth",subscriberBandwidth:sr(n.int64())};continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{scenario:cr(e.speakerUpdate)?{$case:"speakerUpdate",speakerUpdate:Number(e.speakerUpdate)}:cr(e.nodeFailure)?{$case:"nodeFailure",nodeFailure:Boolean(e.nodeFailure)}:cr(e.migration)?{$case:"migration",migration:Boolean(e.migration)}:cr(e.serverLeave)?{$case:"serverLeave",serverLeave:Boolean(e.serverLeave)}:cr(e.switchCandidateProtocol)?{$case:"switchCandidateProtocol",switchCandidateProtocol:Ci(e.switchCandidateProtocol)}:cr(e.subscriberBandwidth)?{$case:"subscriberBandwidth",subscriberBandwidth:Number(e.subscriberBandwidth)}:void 0}},toJSON:function(e){var t,n,i,r,a,o,s,c,u,d,l,p,f,h={};return"speakerUpdate"===(null===(t=e.scenario)||void 0===t?void 0:t.$case)&&(h.speakerUpdate=Math.round(null===(n=e.scenario)||void 0===n?void 0:n.speakerUpdate)),"nodeFailure"===(null===(i=e.scenario)||void 0===i?void 0:i.$case)&&(h.nodeFailure=null===(r=e.scenario)||void 0===r?void 0:r.nodeFailure),"migration"===(null===(a=e.scenario)||void 0===a?void 0:a.$case)&&(h.migration=null===(o=e.scenario)||void 0===o?void 0:o.migration),"serverLeave"===(null===(s=e.scenario)||void 0===s?void 0:s.$case)&&(h.serverLeave=null===(c=e.scenario)||void 0===c?void 0:c.serverLeave),"switchCandidateProtocol"===(null===(u=e.scenario)||void 0===u?void 0:u.$case)&&(h.switchCandidateProtocol=void 0!==(null===(d=e.scenario)||void 0===d?void 0:d.switchCandidateProtocol)?function(e){switch(e){case bi.UDP:return"UDP";case bi.TCP:return"TCP";case bi.TLS:return"TLS";case bi.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(null===(l=e.scenario)||void 0===l?void 0:l.switchCandidateProtocol):void 0),"subscriberBandwidth"===(null===(p=e.scenario)||void 0===p?void 0:p.$case)&&(h.subscriberBandwidth=Math.round(null===(f=e.scenario)||void 0===f?void 0:f.subscriberBandwidth)),h},create:function(e){return ir.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i,r,a,o,s,c,u,d,l,p,f,h,v,m,g,b,k={scenario:void 0};return"speakerUpdate"===(null===(t=e.scenario)||void 0===t?void 0:t.$case)&&void 0!==(null===(n=e.scenario)||void 0===n?void 0:n.speakerUpdate)&&null!==(null===(i=e.scenario)||void 0===i?void 0:i.speakerUpdate)&&(k.scenario={$case:"speakerUpdate",speakerUpdate:e.scenario.speakerUpdate}),"nodeFailure"===(null===(r=e.scenario)||void 0===r?void 0:r.$case)&&void 0!==(null===(a=e.scenario)||void 0===a?void 0:a.nodeFailure)&&null!==(null===(o=e.scenario)||void 0===o?void 0:o.nodeFailure)&&(k.scenario={$case:"nodeFailure",nodeFailure:e.scenario.nodeFailure}),"migration"===(null===(s=e.scenario)||void 0===s?void 0:s.$case)&&void 0!==(null===(c=e.scenario)||void 0===c?void 0:c.migration)&&null!==(null===(u=e.scenario)||void 0===u?void 0:u.migration)&&(k.scenario={$case:"migration",migration:e.scenario.migration}),"serverLeave"===(null===(d=e.scenario)||void 0===d?void 0:d.$case)&&void 0!==(null===(l=e.scenario)||void 0===l?void 0:l.serverLeave)&&null!==(null===(p=e.scenario)||void 0===p?void 0:p.serverLeave)&&(k.scenario={$case:"serverLeave",serverLeave:e.scenario.serverLeave}),"switchCandidateProtocol"===(null===(f=e.scenario)||void 0===f?void 0:f.$case)&&void 0!==(null===(h=e.scenario)||void 0===h?void 0:h.switchCandidateProtocol)&&null!==(null===(v=e.scenario)||void 0===v?void 0:v.switchCandidateProtocol)&&(k.scenario={$case:"switchCandidateProtocol",switchCandidateProtocol:e.scenario.switchCandidateProtocol}),"subscriberBandwidth"===(null===(m=e.scenario)||void 0===m?void 0:m.$case)&&void 0!==(null===(g=e.scenario)||void 0===g?void 0:g.subscriberBandwidth)&&null!==(null===(b=e.scenario)||void 0===b?void 0:b.subscriberBandwidth)&&(k.scenario={$case:"subscriberBandwidth",subscriberBandwidth:e.scenario.subscriberBandwidth}),k}},rr={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return 0!==e.timestamp&&t.uint32(8).int64(e.timestamp),0!==e.rtt&&t.uint32(16).int64(e.rtt),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={timestamp:0,rtt:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.timestamp=sr(n.int64());continue;case 2:if(16!=a)break;r.rtt=sr(n.int64());continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{timestamp:cr(e.timestamp)?Number(e.timestamp):0,rtt:cr(e.rtt)?Number(e.rtt):0}},toJSON:function(e){var t={};return void 0!==e.timestamp&&(t.timestamp=Math.round(e.timestamp)),void 0!==e.rtt&&(t.rtt=Math.round(e.rtt)),t},create:function(e){return rr.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={timestamp:0,rtt:0};return i.timestamp=null!==(t=e.timestamp)&&void 0!==t?t:0,i.rtt=null!==(n=e.rtt)&&void 0!==n?n:0,i}},ar={encode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:nt.Writer.create();return 0!==e.lastPingTimestamp&&t.uint32(8).int64(e.lastPingTimestamp),0!==e.timestamp&&t.uint32(16).int64(e.timestamp),t},decode:function(e,t){for(var n=e instanceof nt.Reader?e:nt.Reader.create(e),i=void 0===t?n.len:n.pos+t,r={lastPingTimestamp:0,timestamp:0};n.pos<i;){var a=n.uint32();switch(a>>>3){case 1:if(8!=a)break;r.lastPingTimestamp=sr(n.int64());continue;case 2:if(16!=a)break;r.timestamp=sr(n.int64());continue}if(4==(7&a)||0==a)break;n.skipType(7&a)}return r},fromJSON:function(e){return{lastPingTimestamp:cr(e.lastPingTimestamp)?Number(e.lastPingTimestamp):0,timestamp:cr(e.timestamp)?Number(e.timestamp):0}},toJSON:function(e){var t={};return void 0!==e.lastPingTimestamp&&(t.lastPingTimestamp=Math.round(e.lastPingTimestamp)),void 0!==e.timestamp&&(t.timestamp=Math.round(e.timestamp)),t},create:function(e){return ar.fromPartial(null!=e?e:{})},fromPartial:function(e){var t,n,i={lastPingTimestamp:0,timestamp:0};return i.lastPingTimestamp=null!==(t=e.lastPingTimestamp)&&void 0!==t?t:0,i.timestamp=null!==(n=e.timestamp)&&void 0!==n?n:0,i}},or=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"}();function sr(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new or.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}function cr(e){return null!=e}nt.util.Long!==H&&(nt.util.Long=H,nt.configure());var ur=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e,i){var r;return _classCallCheck(this,n),(r=t.call(this,i||"an error has occured")).code=e,r}return _createClass(n)}(),dr=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,r){var a;return _classCallCheck(this,n),(a=t.call(this,1,e)).status=r,a.reason=i,a}return _createClass(n)}(ur),lr=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,21,null!=e?e:"device is unsupported")}return _createClass(n)}(ur),pr=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,20,null!=e?e:"track is invalid")}return _createClass(n)}(ur),fr=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,10,null!=e?e:"unsupported server")}return _createClass(n)}(ur),hr=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,12,null!=e?e:"unexpected connection state")}return _createClass(n)}(ur),vr=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,13,null!=e?e:"unable to negotiate")}return _createClass(n)}(ur);e.MediaDeviceFailure=void 0,(Ri=e.MediaDeviceFailure||(e.MediaDeviceFailure={})).PermissionDenied="PermissionDenied",Ri.NotFound="NotFound",Ri.DeviceInUse="DeviceInUse",Ri.Other="Other",function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(e.MediaDeviceFailure||(e.MediaDeviceFailure={}));var mr=_createClass((function e(){_classCallCheck(this,e)}));mr.setTimeout=function(){return setTimeout.apply(void 0,arguments)},mr.setInterval=function(){return setInterval.apply(void 0,arguments)},mr.clearTimeout=function(){return clearTimeout.apply(void 0,arguments)},mr.clearInterval=function(){return clearInterval.apply(void 0,arguments)};var gr={exports:{}};!function(e,n){!function(t,i){var r="function",a="undefined",o="object",s="string",c="major",u="model",d="name",l="type",p="vendor",f="version",h="architecture",v="console",m="mobile",g="tablet",b="smarttv",k="wearable",y="embedded",S="Amazon",w="Apple",C="ASUS",R="BlackBerry",T="Browser",P="Chrome",E="Firefox",_="Google",x="Huawei",O="LG",N="Microsoft",I="Motorola",D="Opera",A="Samsung",U="Sharp",L="Sony",M="Xiaomi",F="Zebra",B="Facebook",j="Chromium OS",J="Mac OS",$=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},V=function(e,t){return _typeof(e)===s&&-1!==q(t).indexOf(q(e))},q=function(e){return e.toLowerCase()},W=function(e,t){if(_typeof(e)===s)return e=e.replace(/^\s\s*/,""),_typeof(t)===a?e:e.substring(0,350)},G=function(e,t){for(var n,a,s,c,u,d,l=0;l<t.length&&!u;){var p=t[l],f=t[l+1];for(n=a=0;n<p.length&&!u&&p[n];)if(u=p[n++].exec(e))for(s=0;s<f.length;s++)d=u[++a],_typeof(c=f[s])===o&&c.length>0?2===c.length?_typeof(c[1])==r?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?_typeof(c[1])!==r||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):i:this[c[0]]=d?c[1].call(this,d,c[2]):i:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):i):this[c]=d||i;l+=2}},H=function(e,t){for(var n in t)if(_typeof(t[n])===o&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(V(t[n][r],e))return"?"===n?i:n}else if(V(t[n],e))return"?"===n?i:n;return e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,f],[/opios[\/ ]+([\w\.]+)/i],[f,[d,D+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[d,D]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[d,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[f,[d,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[d,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+T],f],[/\bfocus\/([\w\.]+)/i],[f,[d,E+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[d,D+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[d,D+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[d,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[f,[d,E]],[/\bqihu|(qi?ho?o?|360)browser/i],[[d,"360 "+T]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1 "+T],f],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[d,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,B],f],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[d,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[d,P+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,P+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[d,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[f,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[d,E+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[d,f],[/(cobalt)\/([\w\.]+)/i],[d,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,q]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",q]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[p,A],[l,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[p,A],[l,m]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[p,w],[l,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[p,w],[l,g]],[/(macintosh);/i],[u,[p,w]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[p,U],[l,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[p,x],[l,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[p,x],[l,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[p,M],[l,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[p,M],[l,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[p,"OPPO"],[l,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[p,"Vivo"],[l,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[p,"Realme"],[l,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[p,I],[l,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[p,I],[l,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[p,O],[l,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[p,O],[l,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[p,"Lenovo"],[l,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[p,"Nokia"],[l,m]],[/(pixel c)\b/i],[u,[p,_],[l,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[p,_],[l,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[p,L],[l,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[p,L],[l,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[p,"OnePlus"],[l,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[p,S],[l,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[p,S],[l,m]],[/(playbook);[-\w\),; ]+(rim)/i],[u,p,[l,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[p,R],[l,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[p,C],[l,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[p,C],[l,m]],[/(nexus 9)/i],[u,[p,"HTC"],[l,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[u,/_/g," "],[l,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[p,"Acer"],[l,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[p,"Meizu"],[l,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,u,[l,m]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,u,[l,g]],[/(surface duo)/i],[u,[p,N],[l,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[p,"Fairphone"],[l,m]],[/(u304aa)/i],[u,[p,"AT&T"],[l,m]],[/\bsie-(\w*)/i],[u,[p,"Siemens"],[l,m]],[/\b(rct\w+) b/i],[u,[p,"RCA"],[l,g]],[/\b(venue[\d ]{2,7}) b/i],[u,[p,"Dell"],[l,g]],[/\b(q(?:mv|ta)\w+) b/i],[u,[p,"Verizon"],[l,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[p,"Barnes & Noble"],[l,g]],[/\b(tm\d{3}\w+) b/i],[u,[p,"NuVision"],[l,g]],[/\b(k88) b/i],[u,[p,"ZTE"],[l,g]],[/\b(nx\d{3}j) b/i],[u,[p,"ZTE"],[l,m]],[/\b(gen\d{3}) b.+49h/i],[u,[p,"Swiss"],[l,m]],[/\b(zur\d{3}) b/i],[u,[p,"Swiss"],[l,g]],[/\b((zeki)?tb.*\b) b/i],[u,[p,"Zeki"],[l,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],u,[l,g]],[/\b(ns-?\w{0,9}) b/i],[u,[p,"Insignia"],[l,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[p,"NextBook"],[l,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],u,[l,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],u,[l,m]],[/\b(ph-1) /i],[u,[p,"Essential"],[l,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[p,"Envizen"],[l,g]],[/\b(trio[-\w\. ]+) b/i],[u,[p,"MachSpeed"],[l,g]],[/\btu_(1491) b/i],[u,[p,"Rotor"],[l,g]],[/(shield[\w ]+) b/i],[u,[p,"Nvidia"],[l,g]],[/(sprint) (\w+)/i],[p,u,[l,m]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[p,N],[l,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[p,F],[l,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[p,F],[l,m]],[/smart-tv.+(samsung)/i],[p,[l,b]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[p,A],[l,b]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,O],[l,b]],[/(apple) ?tv/i],[p,[u,w+" TV"],[l,b]],[/crkey/i],[[u,P+"cast"],[p,_],[l,b]],[/droid.+aft(\w)( bui|\))/i],[u,[p,S],[l,b]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[p,U],[l,b]],[/(bravia[\w ]+)( bui|\))/i],[u,[p,L],[l,b]],[/(mitv-\w{5}) bui/i],[u,[p,M],[l,b]],[/Hbbtv.*(technisat) (.*);/i],[p,u,[l,b]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,W],[u,W],[l,b]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,u,[l,v]],[/droid.+; (shield) bui/i],[u,[p,"Nvidia"],[l,v]],[/(playstation [345portablevi]+)/i],[u,[p,L],[l,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[p,N],[l,v]],[/((pebble))app/i],[p,u,[l,k]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[p,w],[l,k]],[/droid.+; (glass) \d/i],[u,[p,_],[l,k]],[/droid.+; (wt63?0{2,3})\)/i],[u,[p,F],[l,k]],[/(quest( 2| pro)?)/i],[u,[p,B],[l,k]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[l,y]],[/(aeobc)\b/i],[u,[p,S],[l,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[l,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[l,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,m]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[d,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[d,[f,H,Q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[d,"Windows"],[f,H,Q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,J],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,f],[/\(bb(10);/i],[f,[d,R]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[d,E+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[d,P+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,j],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,f],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,f]]},K=function e(n,v){if(_typeof(n)===o&&(v=n,n=i),!(this instanceof e))return new e(n,v).getResult();var b=_typeof(t)!==a&&t.navigator?t.navigator:i,k=n||(b&&b.userAgent?b.userAgent:""),y=b&&b.userAgentData?b.userAgentData:i,S=v?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(z,v):z,w=b&&b.userAgent==k;return this.getBrowser=function(){var e={};return e[d]=i,e[f]=i,G.call(e,k,S.browser),e[c]=function(e){return _typeof(e)===s?e.replace(/[^\d\.]/g,"").split(".")[0]:i}(e[f]),w&&b&&b.brave&&_typeof(b.brave.isBrave)==r&&(e[d]="Brave"),e},this.getCPU=function(){var e={};return e[h]=i,G.call(e,k,S.cpu),e},this.getDevice=function(){var e={};return e[p]=i,e[u]=i,e[l]=i,G.call(e,k,S.device),w&&!e[l]&&y&&y.mobile&&(e[l]=m),w&&"Macintosh"==e[u]&&b&&_typeof(b.standalone)!==a&&b.maxTouchPoints&&b.maxTouchPoints>2&&(e[u]="iPad",e[l]=g),e},this.getEngine=function(){var e={};return e[d]=i,e[f]=i,G.call(e,k,S.engine),e},this.getOS=function(){var e={};return e[d]=i,e[f]=i,G.call(e,k,S.os),w&&!e[d]&&y&&"Unknown"!=y.platform&&(e[d]=y.platform.replace(/chrome os/i,j).replace(/macos/i,J)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return k},this.setUA=function(e){return k=_typeof(e)===s&&e.length>350?W(e,350):e,this},this.setUA(k),this};K.VERSION="1.0.35",K.BROWSER=$([d,f,c]),K.CPU=$([h]),K.DEVICE=$([u,p,l,v,m,b,g,k,y]),K.ENGINE=K.OS=$([d,f]),e.exports&&(n=e.exports=K),n.UAParser=K;var Z=_typeof(t)!==a&&(t.jQuery||t.Zepto);if(Z&&!Z.ua){var Y=new K;Z.ua=Y.getResult(),Z.ua.get=function(){return Y.getUA()},Z.ua.set=function(e){Y.setUA(e);var t=Y.getResult();for(var n in t)Z.ua[n]=t[n]}}}("object"==("undefined"==typeof window?"undefined":_typeof(window))?window:t)}(gr,gr.exports);var br=n(gr.exports),kr="1.9.2",yr=9;function Sr(e,t,n){var i=Object.assign({},e);return!0===i.audio&&(i.audio={}),!0===i.video&&(i.video={}),i.audio&&wr(i.audio,t),i.video&&wr(i.video,n),i}function wr(e,t){return Object.keys(t).forEach((function(n){void 0===e[n]&&(e[n]=t[n])})),e}function Cr(e){var t={};if(e.video)if("object"==_typeof(e.video)){var n={},i=n,r=e.video;Object.keys(r).forEach((function(e){"resolution"===e?wr(i,r.resolution):i[e]=r[e]})),t.video=n}else t.video=e.video;else t.video=!1;return e.audio?"object"==_typeof(e.audio)?t.audio=e.audio:t.audio=!0:t.audio=!1,t}function Rr(){var e="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);if(e)return new e({latencyHint:"interactive"})}var Tr="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function Pr(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))}function Er(){return"addTransceiver"in RTCPeerConnection.prototype}function _r(){return"addTrack"in RTCPeerConnection.prototype}function xr(){var e=RTCRtpReceiver.getCapabilities("video"),t=!1;if(e){var n,i=_createForOfIteratorHelper(e.codecs);try{for(i.s();!(n=i.n()).done;){if("video/AV1"===n.value.mimeType){t=!0;break}}}catch(e){i.e(e)}finally{i.f()}}return t}function Or(e){return"av1"===e||"vp9"===e}function Nr(e){return!!document&&(e||(e=document.createElement("audio")),"setSinkId"in e)}var Ir={Chrome:"100",Chromium:"100",Safari:"15",Firefox:"100",Edge:"100",Brave:"1.40"};function Dr(){return!!Lr()&&-1!==navigator.userAgent.indexOf("Firefox")}function Ar(){return!!Lr()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Ur(){return!!Lr()&&/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent)}function Lr(){return"undefined"!=typeof document}function Mr(){return"ReactNative"==navigator.product}function Fr(e){return e.hostname.endsWith(".livekit.cloud")}function Br(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function jr(){if(Lr())return window.devicePixelRatio;if(Mr()){var e=Br();if(e)return e.devicePixelRatio}return 1}function Jr(e){var t,n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.target.handleResize(i)}}catch(e){n.e(e)}finally{n.f()}}function $r(e){var t,n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.target.handleVisibilityChanged(i)}}catch(e){n.e(e)}finally{n.f()}}var Vr,qr,Wr=null,Gr=function(){return Wr||(Wr=new ResizeObserver(Jr)),Wr},Hr=null,Qr=function(){return Hr||(Hr=new IntersectionObserver($r,{root:document,rootMargin:"0px"})),Hr};function zr(){return Vr||(Vr=Kr()),Vr}function Kr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=document.createElement("canvas");r.width=e,r.height=t;var a=r.getContext("2d");null==a||a.fillRect(0,0,r.width,r.height),i&&a&&(a.beginPath(),a.arc(e/2,t/2,50,0,2*Math.PI,!0),a.closePath(),a.fillStyle="grey",a.fill());var o=_slicedToArray(r.captureStream().getTracks(),1)[0];if(!o)throw Error("Could not get empty media stream video track");return o.enabled=n,o}function Zr(){if(!qr){var e,t=new AudioContext,n=t.createOscillator(),i=t.createMediaStreamDestination();if(n.connect(i),n.start(),e=_slicedToArray(i.stream.getAudioTracks(),1),!(qr=e[0]))throw Error("Could not get empty media stream audio track");qr.enabled=!1}return qr}var Yr=_createClass((function e(t,n){var i=this;_classCallCheck(this,e),this.onFinally=n,this.promise=new Promise((function(e,n){return qt(i,void 0,void 0,_regeneratorRuntime().mark((function i(){return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.resolve=e,this.reject=n,i.t0=t,!i.t0){i.next=6;break}return i.next=6,t(e,n);case 6:case"end":return i.stop()}}),i,this)})))})).finally((function(){var e;return null===(e=i.onFinally)||void 0===e?void 0:e.call(i)}))})),Xr=function(){function e(){_classCallCheck(this,e),this._locking=Promise.resolve(),this._locks=0}return _createClass(e,[{key:"isLocked",value:function(){return this._locks>0}},{key:"lock",value:function(){var e,t=this;this._locks+=1;var n=new Promise((function(n){return e=function(){t._locks-=1,n()}})),i=this._locking.then((function(){return e}));return this._locking=this._locking.then((function(){return n})),i}}]),e}(),ea=["syncState","trickle","offer","answer","simulate","leave"],ta=function(){function t(){_classCallCheck(this,t);var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.rtt=0,this.isConnected=!1,this.isReconnecting=!1,this.useJSON=e,this.requestQueue=new ln,this.queuedRequests=[],this.closingLock=new Xr}return _createClass(t,[{key:"join",value:function(e,t,n,i){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.isConnected=!1,this.options=n,r.next=3,this.connect(e,t,n,i);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r,this)})))}},{key:"reconnect",value:function(e,t,n,i){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.options){r.next=2;break}return r.abrupt("return",void o.warn("attempted to reconnect without signal options being set, ignoring"));case 2:return this.isReconnecting=!0,this.clearPingInterval(),r.next=5,this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}));case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}}),r,this)})))}},{key:"connect",value:function(e,t,n,i){var r=this;this.connectOptions=n,e.startsWith("http")&&(e=e.replace("http","ws")),e=e.replace(/\/$/,""),e+="/rtc";var a=function(e,t,n){var i,r=new URLSearchParams;return r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Mr()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel),t.os&&r.set("os",t.os),t.osVersion&&r.set("os_version",t.osVersion),t.browser&&r.set("browser",t.browser),t.browserVersion&&r.set("browser_version",t.browserVersion),void 0!==n.publishOnly&&r.set("publish",n.publishOnly),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type),"?".concat(r.toString())}(t,function(){var e,t=Dt.fromPartial({sdk:tt.JS,protocol:yr,version:kr});return Mr()&&(t.os=null!==(e=function(){if(Mr()){var e=Br();return e?e.platform:void 0}}())&&void 0!==e?e:""),t}(),n);return new Promise((function(t,s){return qt(r,void 0,void 0,_regeneratorRuntime().mark((function r(){var c,u=this;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(c=function(){return qt(u,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.close();case 2:s(new dr("room connection has been cancelled (signal)"));case 3:case"end":return e.stop()}}),e,this)})))},(null==i?void 0:i.aborted)&&c(),null==i||i.addEventListener("abort",c),o.debug("connecting to ".concat(e+a)),r.t0=this.ws,!r.t0){r.next=8;break}return r.next=8,this.close();case 8:this.ws=new WebSocket(e+a),this.ws.binaryType="arraybuffer",this.ws.onerror=function(t){return qt(u,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.isConnected){n.next=4;break}this.handleWSError(t),n.next=21;break;case 4:return n.prev=4,n.next=7,fetch("http".concat(e.substring(2),"/validate").concat(a));case 7:if(!(i=n.sent).status.toFixed(0).startsWith("4")){n.next=15;break}return n.next=11,i.text();case 11:r=n.sent,s(new dr(r,0,i.status)),n.next=16;break;case 15:s(new dr("Internal error",2,i.status));case 16:n.next=21;break;case 18:n.prev=18,n.t0=n.catch(4),s(new dr("server was not reachable",1));case 21:case"end":return n.stop()}}),n,this,[[4,18]])})))},this.ws.onmessage=function(e){return qt(u,void 0,void 0,_regeneratorRuntime().mark((function r(){var a,u,d,l,p,f,h;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("string"!=typeof e.data){r.next=5;break}f=JSON.parse(e.data),p=Pi.fromJSON(f),r.next=8;break;case 5:if(e.data instanceof ArrayBuffer){r.next=7;break}return r.abrupt("return",void o.error("could not decode websocket message: ".concat(_typeof(e.data))));case 7:p=Pi.decode(new Uint8Array(e.data));case 8:if(this.isConnected){r.next=12;break}if(h=!1,"join"===(null===(a=p.message)||void 0===a?void 0:a.$case)?(this.isConnected=!0,null==i||i.removeEventListener("abort",c),this.pingTimeoutDuration=p.message.join.pingTimeout,this.pingIntervalDuration=p.message.join.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(o.debug("ping config",{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration}),this.startPingInterval()),t(p.message.join)):n.reconnect?(this.isConnected=!0,null==i||i.removeEventListener("abort",c),this.startPingInterval(),"reconnect"===(null===(u=p.message)||void 0===u?void 0:u.$case)?t(null===(d=p.message)||void 0===d?void 0:d.reconnect):(t(),h=!0)):n.reconnect||s(new dr("did not receive join response, got ".concat(null===(l=p.message)||void 0===l?void 0:l.$case," instead"))),h){r.next=12;break}return r.abrupt("return");case 12:if(r.t0=this.signalLatency,!r.t0){r.next=16;break}return r.next=16,Pr(this.signalLatency);case 16:this.handleSignalResponse(p);case 17:case"end":return r.stop()}}),r,this)})))},this.ws.onclose=function(e){o.warn("websocket closed",{ev:e}),u.handleOnClose(e.reason)};case 13:case"end":return r.stop()}}),r,this)})))}))}},{key:"close",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n,i=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.closingLock.lock();case 2:if(t=e.sent,e.prev=3,this.isConnected=!1,!this.ws){e.next=14;break}if(this.ws.onclose=null,this.ws.onmessage=null,this.ws.onopen=null,n=new Promise((function(e){i.ws?i.ws.onclose=e:e(!0)})),e.t0=this.ws.readyState<this.ws.CLOSING,!e.t0){e.next=12;break}return this.ws.close(),e.next=12,Promise.race([n,Pr(250)]);case 12:this.ws=void 0,this.clearPingInterval();case 14:return e.prev=14,t(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[3,,14,17]])})))}},{key:"sendOffer",value:function(e){o.debug("sending offer",e),this.sendRequest({$case:"offer",offer:ia(e)})}},{key:"sendAnswer",value:function(e){return o.debug("sending answer"),this.sendRequest({$case:"answer",answer:ia(e)})}},{key:"sendIceCandidate",value:function(e,t){return o.trace("sending ice candidate",e),this.sendRequest({$case:"trickle",trickle:{candidateInit:JSON.stringify(e),target:t}})}},{key:"sendMuteTrack",value:function(e,t){return this.sendRequest({$case:"mute",mute:{sid:e,muted:t}})}},{key:"sendAddTrack",value:function(e){return this.sendRequest({$case:"addTrack",addTrack:_i.fromPartial(e)})}},{key:"sendUpdateLocalMetadata",value:function(e,t){return this.sendRequest({$case:"updateMetadata",updateMetadata:{metadata:e,name:t}})}},{key:"sendUpdateTrackSettings",value:function(e){this.sendRequest({$case:"trackSetting",trackSetting:e})}},{key:"sendUpdateSubscription",value:function(e){return this.sendRequest({$case:"subscription",subscription:e})}},{key:"sendSyncState",value:function(e){return this.sendRequest({$case:"syncState",syncState:e})}},{key:"sendUpdateVideoLayers",value:function(e,t){return this.sendRequest({$case:"updateLayers",updateLayers:{trackSid:e,layers:t}})}},{key:"sendUpdateSubscriptionPermissions",value:function(e,t){return this.sendRequest({$case:"subscriptionPermission",subscriptionPermission:{allParticipants:e,trackPermissions:t}})}},{key:"sendSimulateScenario",value:function(e){return this.sendRequest({$case:"simulate",simulate:e})}},{key:"sendPing",value:function(){return Promise.all([this.sendRequest({$case:"ping",ping:Date.now()}),this.sendRequest({$case:"pingReq",pingReq:{timestamp:Date.now(),rtt:this.rtt}})])}},{key:"sendLeave",value:function(){return this.sendRequest({$case:"leave",leave:{canReconnect:!1,reason:e.DisconnectReason.CLIENT_INITIATED}})}},{key:"sendRequest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a=this;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=!t&&!function(e){var t=ea.includes(e.$case);return o.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e),!i||!this.isReconnecting){n.next=3;break}return n.abrupt("return",void this.queuedRequests.push((function(){return qt(a,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendRequest(e,!0);case 2:case"end":return t.stop()}}),t,this)})))})));case 3:if(n.t0=t,n.t0){n.next=7;break}return n.next=7,this.requestQueue.flush();case 7:if(n.t1=this.signalLatency,!n.t1){n.next=11;break}return n.next=11,Pr(this.signalLatency);case 11:if(this.ws&&this.ws.readyState===this.ws.OPEN){n.next=13;break}return n.abrupt("return",void o.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.$case)));case 13:r={message:e};try{this.useJSON?this.ws.send(JSON.stringify(Ti.toJSON(r))):this.ws.send(Ti.encode(r).finish())}catch(e){o.error("error sending signal message",{error:e})}case 15:case"end":return n.stop()}}),n,this)})))}},{key:"handleSignalResponse",value:function(e){var t,n,i=e.message;if(null!=i)if("answer"===i.$case){var r=na(i.answer);this.onAnswer&&this.onAnswer(r)}else if("offer"===i.$case){var a=na(i.offer);this.onOffer&&this.onOffer(a)}else if("trickle"===i.$case){var s=JSON.parse(i.trickle.candidateInit);this.onTrickle&&this.onTrickle(s,i.trickle.target)}else"update"===i.$case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.update.participants)&&void 0!==t?t:[]):"trackPublished"===i.$case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.trackPublished):"speakersChanged"===i.$case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.speakersChanged.speakers)&&void 0!==n?n:[]):"leave"===i.$case?this.onLeave&&this.onLeave(i.leave):"mute"===i.$case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.mute.sid,i.mute.muted):"roomUpdate"===i.$case?this.onRoomUpdate&&i.roomUpdate.room&&this.onRoomUpdate(i.roomUpdate.room):"connectionQuality"===i.$case?this.onConnectionQuality&&this.onConnectionQuality(i.connectionQuality):"streamStateUpdate"===i.$case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.streamStateUpdate):"subscribedQualityUpdate"===i.$case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.subscribedQualityUpdate):"subscriptionPermissionUpdate"===i.$case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.subscriptionPermissionUpdate):"refreshToken"===i.$case?this.onTokenRefresh&&this.onTokenRefresh(i.refreshToken):"trackUnpublished"===i.$case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.trackUnpublished):"pong"===i.$case?this.resetPingTimeout():"pongResp"===i.$case?(this.rtt=Date.now()-i.pongResp.lastPingTimestamp,this.resetPingTimeout()):o.debug("unsupported message",i);else o.debug("received unsupported message")}},{key:"setReconnected",value:function(){for(;this.queuedRequests.length>0;){var e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}this.isReconnecting=!1}},{key:"handleOnClose",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.isConnected,!t.t0){t.next=6;break}return t.next=4,this.close();case 4:o.debug("websocket connection closed: ".concat(e)),this.onClose&&this.onClose(e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"handleWSError",value:function(e){o.error("websocket error",e)}},{key:"resetPingTimeout",value:function(){var e=this;this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=mr.setTimeout((function(){o.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*e.pingTimeoutDuration).toUTCString())),e.handleOnClose("ping timeout")}),1e3*this.pingTimeoutDuration):o.warn("ping timeout duration not set")}},{key:"clearPingTimeout",value:function(){this.pingTimeout&&mr.clearTimeout(this.pingTimeout)}},{key:"startPingInterval",value:function(){var e=this;this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(o.debug("start ping interval"),this.pingInterval=mr.setInterval((function(){e.sendPing()}),1e3*this.pingIntervalDuration)):o.warn("ping interval duration not set")}},{key:"clearPingInterval",value:function(){o.debug("clearing ping interval"),this.clearPingTimeout(),this.pingInterval&&mr.clearInterval(this.pingInterval)}}]),t}();function na(e){var t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function ia(e){return{sdp:e.sdp,type:e.type}}var ra="default",aa=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getDevices",value:function(t){var n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var a,s,c;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!((null===(n=e.userMediaPromiseMap)||void 0===n?void 0:n.size)>0)){r.next=15;break}if(o.debug("awaiting getUserMedia promise"),r.prev=2,!t){r.next=8;break}return r.next=6,e.userMediaPromiseMap.get(t);case 6:r.next=10;break;case 8:return r.next=10,Promise.all(e.userMediaPromiseMap.values());case 10:r.next=15;break;case 12:r.prev=12,r.t0=r.catch(2),o.warn("error waiting for media permissons");case 15:return r.next=17,navigator.mediaDevices.enumerateDevices();case 17:if(a=r.sent,!i||!t||e.userMediaPromiseMap.get(t)&&Ar()){r.next=28;break}if(0!==a.length&&!a.some((function(e){var n=""===e.label,i=!t||e.kind===t;return n&&i}))){r.next=28;break}return s={video:"audioinput"!==t&&"audiooutput"!==t,audio:"videoinput"!==t},r.next=23,navigator.mediaDevices.getUserMedia(s);case 23:return c=r.sent,r.next=26,navigator.mediaDevices.enumerateDevices();case 26:a=r.sent,c.getTracks().forEach((function(e){e.stop()}));case 28:return r.abrupt("return",(t&&(a=a.filter((function(e){return e.kind===t}))),a));case 29:case"end":return r.stop()}}),r,null,[[2,12]])})))}},{key:"normalizeDeviceId",value:function(e,t,n){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var r;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(t===ra){i.next=2;break}return i.abrupt("return",t);case 2:return i.next=4,this.getDevices(e);case 4:return r=i.sent.find((function(e){return e.groupId===n&&e.deviceId!==ra})),i.abrupt("return",null==r?void 0:r.deviceId);case 6:case"end":return i.stop()}}),i,this)})))}}],[{key:"getInstance",value:function(){return void 0===this.instance&&(this.instance=new e),this.instance}}]),e}();aa.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],aa.userMediaPromiseMap=new Map;var oa={},sa={exports:{}},ca=sa.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(ca).forEach((function(e){ca[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}));var ua=sa.exports;!function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var a=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var a=0;a<i.length;a+=1)null!=e[a+1]&&(n[i[a]]=t(e[a+1]))}(i.match(e.reg),a,e.names,e.name),e.push&&n[e.push].push(a)},i=ua,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},a=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),o=a[a.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,o,r)}})),t.media=a,t};var a=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(oa);var da=ua,la=/%[sdv%]/g,pa=function(e){var t=1,n=arguments,i=n.length;return e.replace(la,(function(e){if(t>=i)return e;var r=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},fa=function(e,t,n){var i=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var a=t.names[r];t.name?i.push(n[t.name][a]):i.push(n[t.names[r]])}else i.push(n[t.name]);return pa.apply(null,i)},ha=["v","o","s","i","u","e","p","c","b","t","r","z","a"],va=["i","c","b","a"],ma=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||ha,i=t.innerOrder||va,r=[];return n.forEach((function(t){da[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(fa(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(fa(t,n,e))}))}))})),e.media.forEach((function(e){r.push(fa("m",da.m[0],e)),i.forEach((function(t){da[t].forEach((function(n){n.name in e&&null!=e[n.name]?r.push(fa(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){r.push(fa(t,n,e))}))}))}))})),r.join("\r\n")+"\r\n"},ga=oa.parse;function ba(e,t,n){var i,r,a;void 0===t&&(t=50),void 0===n&&(n={});var o=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,u=Date.now(),d=[];function l(){if(void 0!==c){var e=Date.now()-u;if(e+t>=c)return c-e}return t}var p=function(){var t=[].slice.call(arguments),n=this;return new Promise((function(i,r){var c=o&&void 0===a;if(void 0!==a&&clearTimeout(a),a=setTimeout((function(){if(a=void 0,u=Date.now(),!o){var i=e.apply(n,t);s&&s(i),d.forEach((function(e){return(0,e.resolve)(i)})),d=[]}}),l()),c){var p=e.apply(n,t);return s&&s(p),i(p)}d.push({resolve:i,reject:r})}))};return p.cancel=function(e){void 0!==a&&clearTimeout(a),d.forEach((function(t){return(0,t.reject)(e)})),d=[]},p}var ka="negotiationStarted",ya="negotiationComplete",Sa=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var i;_classCallCheck(this,n);var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(i=t.call(this)).pendingCandidates=[],i.restartingIce=!1,i.renegotiate=!1,i.trackBitrates=[],i.remoteStereoMids=[],i.remoteNackMids=[],i.negotiate=ba((function(e){i.emit(ka);try{i.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}),100),i.pc=Lr()&&-1!==navigator.userAgent.indexOf("Chrom")?new RTCPeerConnection(e,r):new RTCPeerConnection(e),i}return _createClass(n,[{key:"isICEConnected",get:function(){return"connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState}},{key:"addIceCandidate",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.pc.remoteDescription||this.restartingIce){t.next=2;break}return t.abrupt("return",this.pc.addIceCandidate(e));case 2:this.pendingCandidates.push(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"setRemoteDescription",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i,r,a=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"offer"===e.type&&(n=function(e){var t,n=[],i=[],r=ga(null!==(t=e.sdp)&&void 0!==t?t:""),a=0;return r.media.forEach((function(e){var t;"audio"===e.type&&(e.rtp.some((function(e){return"opus"===e.codec&&(a=e.payload,!0)})),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some((function(e){return e.payload===a&&"nack"===e.type})))&&i.push(e.mid),e.fmtp.some((function(t){return t.payload===a&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0)})))})),{stereoMids:n,nackMids:i}}(e),i=n.stereoMids,r=n.nackMids,this.remoteStereoMids=i,this.remoteNackMids=r),t.next=3,this.pc.setRemoteDescription(e);case 3:this.pendingCandidates.forEach((function(e){a.pc.addIceCandidate(e)})),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,this.createAndSendOffer()):"answer"===e.type&&this.emit(ya);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"createAndSendOffer",value:function(e){var t;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,s=this;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==this.onOffer){n.next=2;break}return n.abrupt("return");case 2:if((null==e?void 0:e.iceRestart)&&(o.debug("restarting ICE"),this.restartingIce=!0),"have-local-offer"!==this.pc.signalingState){n.next=10;break}if(i=this.pc.remoteDescription,(null==e?void 0:e.iceRestart)&&i){n.next=6;break}return n.abrupt("return",void(this.renegotiate=!0));case 6:return n.next=8,this.pc.setRemoteDescription(i);case 8:n.next=12;break;case 10:if("closed"!==this.pc.signalingState){n.next=12;break}return n.abrupt("return",void o.warn("could not createOffer with closed peer connection"));case 12:return o.debug("starting to negotiate"),n.next=15,this.pc.createOffer(e);case 15:return r=n.sent,(a=ga(null!==(t=r.sdp)&&void 0!==t?t:"")).media.forEach((function(e){"audio"===e.type?wa(e,[],[]):"video"===e.type&&(function(e){var t,n,i,r;if(Or(null===(n=null===(t=e.rtp[0])||void 0===t?void 0:t.codec)||void 0===n?void 0:n.toLowerCase())){var a=0,o=null===(i=e.ext)||void 0===i?void 0:i.some((function(e){return e.uri===Tr||(e.value>a&&(a=e.value),!1)}));o||null===(r=e.ext)||void 0===r||r.push({value:a+1,uri:Tr})}}(e),s.trackBitrates.some((function(t){if(!e.msid||!e.msid.includes(t.sid))return!1;var n=0;return e.rtp.some((function(e){return e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)})),n>0&&(e.fmtp.some((function(e){return e.payload===n&&(e.config.includes("x-google-start-bitrate")||(e.config+=";x-google-start-bitrate=".concat(.7*t.maxbr)),e.config.includes("x-google-max-bitrate")||(e.config+=";x-google-max-bitrate=".concat(t.maxbr)),!0)}))||e.fmtp.push({payload:n,config:"x-google-start-bitrate=".concat(.7*t.maxbr,";x-google-max-bitrate=").concat(t.maxbr)})),!0})))})),this.trackBitrates=[],n.next=21,this.setMungedLocalDescription(r,ma(a));case 21:this.onOffer(r);case 22:case"end":return n.stop()}}),n,this)})))}},{key:"createAndSetAnswer",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i,r=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.pc.createAnswer();case 2:return n=t.sent,(i=ga(null!==(e=n.sdp)&&void 0!==e?e:"")).media.forEach((function(e){"audio"===e.type&&wa(e,r.remoteStereoMids,r.remoteNackMids)})),t.next=7,this.setMungedLocalDescription(n,ma(i));case 7:return t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"setTrackCodecBitrate",value:function(e,t,n){this.trackBitrates.push({sid:e,codec:t,maxbr:n})}},{key:"close",value:function(){this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.close()}},{key:"setMungedLocalDescription",value:function(e,t){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.sdp,e.sdp=t,n.prev=2,o.debug("setting munged local description"),n.next=6,this.pc.setLocalDescription(e);case 6:return n.abrupt("return",void n.sent);case 9:n.prev=9,n.t0=n.catch(2),o.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),{error:n.t0}),e.sdp=i;case 12:return n.prev=12,n.next=15,this.pc.setLocalDescription(e);case 15:n.next=21;break;case 17:throw n.prev=17,n.t1=n.catch(12),r="unknown error",n.t1 instanceof Error?r=n.t1.message:"string"==typeof n.t1&&(r=n.t1),new vr(r);case 21:case"end":return n.stop()}}),n,this,[[2,9],[12,17]])})))}}]),n}(dn);function wa(e,t,n){var i=0;e.rtp.some((function(e){return"opus"===e.codec&&(i=e.payload,!0)})),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some((function(e){return e.payload===i&&"nack"===e.type}))&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some((function(e){return e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0)})))}var Ca,Ra=function(){function e(t,n){_classCallCheck(this,e),this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=n}return _createClass(e,[{key:"isCloud",value:function(){return Fr(this.serverUrl)}},{key:"getNextBestRegionUrl",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i,r=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isCloud()){t.next=2;break}throw Error("region availability is only supported for LiveKit Cloud domains");case 2:if(t.t0=!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime,!t.t0){t.next=7;break}return t.next=6,this.fetchRegionSettings(e);case 6:this.regionSettings=t.sent;case 7:if(n=this.regionSettings.regions.filter((function(e){return!r.attemptedRegions.find((function(t){return t.url===e.url}))})),!(n.length>0)){t.next=11;break}return i=n[0],t.abrupt("return",(this.attemptedRegions.push(i),o.debug("next region: ".concat(i.region)),i.url));case 11:return t.abrupt("return",null);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"resetAttempts",value:function(){this.attemptedRegions=[]}},{key:"fetchRegionSettings",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i,r;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat((i=this.serverUrl,"".concat(i.protocol.replace("ws","http"),"//").concat(i.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});case 2:if(!(n=t.sent).ok){t.next=8;break}return t.next=6,n.json();case 6:return r=t.sent,t.abrupt("return",(this.lastUpdateAt=Date.now(),r));case 8:throw new dr("Could not fetch region settings: ".concat(n.statusText),401===n.status?0:void 0,n.status);case 9:case"end":return t.stop()}}),t,this)})))}}]),e}(),Ta=function(){function e(t,n,i,r,a){_classCallCheck(this,e),this.width=t,this.height=n,this.encoding={maxBitrate:i,maxFramerate:r,priority:a}}return _createClass(e,[{key:"resolution",get:function(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}]),e}(),Pa=["vp8","h264"];function Ea(e){return!!Pa.find((function(t){return t===e}))}function _a(e,t){return(null==e?void 0:e.toLowerCase().replace(new RegExp("audio\\/|video\\/","y"),""))===(null==t?void 0:t.toLowerCase().replace(new RegExp("audio\\/|video\\/","y"),""))}e.AudioPresets=void 0,(Ca=e.AudioPresets||(e.AudioPresets={})).telephone={maxBitrate:12e3},Ca.speech={maxBitrate:2e4},Ca.music={maxBitrate:32e3},Ca.musicStereo={maxBitrate:48e3},Ca.musicHighQuality={maxBitrate:64e3},Ca.musicHighQualityStereo={maxBitrate:96e3};var xa,Oa,Na,Ia,Da={h90:new Ta(160,90,6e4,15),h180:new Ta(320,180,12e4,15),h216:new Ta(384,216,18e4,15),h360:new Ta(640,360,3e5,20),h540:new Ta(960,540,6e5,25),h720:new Ta(1280,720,17e5,30),h1080:new Ta(1920,1080,3e6,30),h1440:new Ta(2560,1440,5e6,30),h2160:new Ta(3840,2160,8e6,30)},Aa={h120:new Ta(160,120,8e4,15),h180:new Ta(240,180,1e5,15),h240:new Ta(320,240,15e4,15),h360:new Ta(480,360,225e3,20),h480:new Ta(640,480,3e5,20),h540:new Ta(720,540,45e4,25),h720:new Ta(960,720,15e5,30),h1080:new Ta(1440,1080,25e5,30),h1440:new Ta(1920,1440,35e5,30)},Ua={h360fps3:new Ta(640,360,2e5,3,"medium"),h720fps5:new Ta(1280,720,4e5,5,"medium"),h720fps15:new Ta(1280,720,1e6,15,"medium"),h1080fps15:new Ta(1920,1080,15e5,15,"medium"),h1080fps30:new Ta(1920,1080,3e6,30,"medium")},La={audioBitrate:e.AudioPresets.music.maxBitrate,audioPreset:e.AudioPresets.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Ua.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",backupCodec:{codec:"vp8",encoding:Da.h540.encoding}},Ma={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},Fa={resolution:Da.h720.resolution},Ba={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Vt,disconnectOnPageLeave:!0,expWebAudioMix:!1},ja={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3};e.RoomEvent=void 0,(xa=e.RoomEvent||(e.RoomEvent={})).Connected="connected",xa.Reconnecting="reconnecting",xa.Reconnected="reconnected",xa.Disconnected="disconnected",xa.ConnectionStateChanged="connectionStateChanged",xa.StateChanged="connectionStateChanged",xa.MediaDevicesChanged="mediaDevicesChanged",xa.ParticipantConnected="participantConnected",xa.ParticipantDisconnected="participantDisconnected",xa.TrackPublished="trackPublished",xa.TrackSubscribed="trackSubscribed",xa.TrackSubscriptionFailed="trackSubscriptionFailed",xa.TrackUnpublished="trackUnpublished",xa.TrackUnsubscribed="trackUnsubscribed",xa.TrackMuted="trackMuted",xa.TrackUnmuted="trackUnmuted",xa.LocalTrackPublished="localTrackPublished",xa.LocalTrackUnpublished="localTrackUnpublished",xa.LocalAudioSilenceDetected="localAudioSilenceDetected",xa.ActiveSpeakersChanged="activeSpeakersChanged",xa.ParticipantMetadataChanged="participantMetadataChanged",xa.ParticipantNameChanged="participantNameChanged",xa.RoomMetadataChanged="roomMetadataChanged",xa.DataReceived="dataReceived",xa.ConnectionQualityChanged="connectionQualityChanged",xa.TrackStreamStateChanged="trackStreamStateChanged",xa.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",xa.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",xa.AudioPlaybackStatusChanged="audioPlaybackChanged",xa.MediaDevicesError="mediaDevicesError",xa.ParticipantPermissionsChanged="participantPermissionsChanged",xa.SignalConnected="signalConnected",xa.RecordingStatusChanged="recordingStatusChanged",xa.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantEvent=void 0,(Oa=e.ParticipantEvent||(e.ParticipantEvent={})).TrackPublished="trackPublished",Oa.TrackSubscribed="trackSubscribed",Oa.TrackSubscriptionFailed="trackSubscriptionFailed",Oa.TrackUnpublished="trackUnpublished",Oa.TrackUnsubscribed="trackUnsubscribed",Oa.TrackMuted="trackMuted",Oa.TrackUnmuted="trackUnmuted",Oa.LocalTrackPublished="localTrackPublished",Oa.LocalTrackUnpublished="localTrackUnpublished",Oa.ParticipantMetadataChanged="participantMetadataChanged",Oa.ParticipantNameChanged="participantNameChanged",Oa.DataReceived="dataReceived",Oa.IsSpeakingChanged="isSpeakingChanged",Oa.ConnectionQualityChanged="connectionQualityChanged",Oa.TrackStreamStateChanged="trackStreamStateChanged",Oa.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",Oa.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",Oa.MediaDevicesError="mediaDevicesError",Oa.ParticipantPermissionsChanged="participantPermissionsChanged",e.EngineEvent=void 0,(Na=e.EngineEvent||(e.EngineEvent={})).TransportsCreated="transportsCreated",Na.Connected="connected",Na.Disconnected="disconnected",Na.Resuming="resuming",Na.Resumed="resumed",Na.Restarting="restarting",Na.Restarted="restarted",Na.SignalResumed="signalResumed",Na.SignalRestarted="signalRestarted",Na.Closing="closing",Na.MediaTrackAdded="mediaTrackAdded",Na.ActiveSpeakersUpdate="activeSpeakersUpdate",Na.DataPacketReceived="dataPacketReceived",Na.DCBufferStatusChanged="dcBufferStatusChanged",e.TrackEvent=void 0,(Ia=e.TrackEvent||(e.TrackEvent={})).Message="message",Ia.Muted="muted",Ia.Unmuted="unmuted",Ia.Restarted="restarted",Ia.Ended="ended",Ia.Subscribed="subscribed",Ia.Unsubscribed="unsubscribed",Ia.UpdateSettings="updateSettings",Ia.UpdateSubscription="updateSubscription",Ia.AudioPlaybackStarted="audioPlaybackStarted",Ia.AudioPlaybackFailed="audioPlaybackFailed",Ia.AudioSilenceDetected="audioSilenceDetected",Ia.VisibilityChanged="visibilityChanged",Ia.VideoDimensionsChanged="videoDimensionsChanged",Ia.ElementAttached="elementAttached",Ia.ElementDetached="elementDetached",Ia.UpstreamPaused="upstreamPaused",Ia.UpstreamResumed="upstreamResumed",Ia.SubscriptionPermissionChanged="subscriptionPermissionChanged",Ia.SubscriptionStatusChanged="subscriptionStatusChanged";var Ja=[],$a=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t){var r;return _classCallCheck(this,i),(r=n.call(this)).attachedElements=[],r.isMuted=!1,r.streamState=i.StreamState.Active,r.isInBackground=!1,r._currentBitrate=0,r.appVisibilityChangedListener=function(){r.backgroundTimeout&&clearTimeout(r.backgroundTimeout),"hidden"===document.visibilityState?r.backgroundTimeout=setTimeout((function(){return r.handleAppVisibilityChanged()}),5e3):r.handleAppVisibilityChanged()},r.setMaxListeners(100),r.kind=t,r._mediaStreamTrack=e,r._mediaStreamID=e.id,r.source=i.Source.Unknown,r}return _createClass(i,[{key:"currentBitrate",get:function(){return this._currentBitrate}},{key:"mediaStreamTrack",get:function(){return this._mediaStreamTrack}},{key:"mediaStreamID",get:function(){return this._mediaStreamID}},{key:"attach",value:function(t){var n=this,r="audio";this.kind===i.Kind.Video&&(r="video"),0===this.attachedElements.length&&i.Kind.Video&&this.addAppVisibilityListener(),t||("audio"===r&&(Ja.forEach((function(e){null!==e.parentElement||t||(t=e)})),t&&Ja.splice(Ja.indexOf(t),1)),t||(t=document.createElement(r))),this.attachedElements.includes(t)||this.attachedElements.push(t),Va(this._mediaStreamTrack,t);var a=t.srcObject.getTracks();return a.some((function(e){return"audio"===e.kind}))&&t.play().then((function(){n.emit(e.TrackEvent.AudioPlaybackStarted)})).catch((function(i){"NotAllowedError"===i.name?n.emit(e.TrackEvent.AudioPlaybackFailed,i):o.warn("could not playback audio",i),t&&a.some((function(e){return"video"===e.kind}))&&"NotAllowedError"===i.name&&(t.muted=!0,t.play().catch((function(){})))})),this.emit(e.TrackEvent.ElementAttached,t),t}},{key:"detach",value:function(t){var n=this;try{if(t){qa(this._mediaStreamTrack,t);var i=this.attachedElements.indexOf(t);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(t),this.emit(e.TrackEvent.ElementDetached,t)),t}var r=[];return this.attachedElements.forEach((function(t){qa(n._mediaStreamTrack,t),r.push(t),n.recycleElement(t),n.emit(e.TrackEvent.ElementDetached,t)})),this.attachedElements=[],r}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}},{key:"stop",value:function(){this.stopMonitor(),this._mediaStreamTrack.stop()}},{key:"enable",value:function(){this._mediaStreamTrack.enabled=!0}},{key:"disable",value:function(){this._mediaStreamTrack.enabled=!1}},{key:"stopMonitor",value:function(){this.monitorInterval&&clearInterval(this.monitorInterval)}},{key:"recycleElement",value:function(e){if(e instanceof HTMLAudioElement){var t=!0;e.pause(),Ja.forEach((function(e){e.parentElement||(t=!1)})),t&&Ja.push(e)}}},{key:"handleAppVisibilityChanged",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.isInBackground="hidden"===document.visibilityState;case 1:case"end":return e.stop()}}),e,this)})))}},{key:"addAppVisibilityListener",value:function(){Lr()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}},{key:"removeAppVisibilityListener",value:function(){Lr()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}]),i}(un.EventEmitter);function Va(e,t){var n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,(i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks()).includes(e)||(i.forEach((function(e){n.removeTrack(e)})),n.addTrack(e)),t.autoplay=!0,t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(Ar()||Dr())&&t instanceof HTMLVideoElement&&setTimeout((function(){t.srcObject=n,t.play().catch((function(){}))}),0))}function qa(e,t){if(t.srcObject instanceof MediaStream){var n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){var t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return qe.AUDIO;case t.Video:return qe.VIDEO;default:return qe.UNRECOGNIZED}},e.kindFromProto=function(e){switch(e){case qe.AUDIO:return t.Audio;case qe.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return We.CAMERA;case n.Microphone:return We.MICROPHONE;case n.ScreenShare:return We.SCREEN_SHARE;case n.ScreenShareAudio:return We.SCREEN_SHARE_AUDIO;default:return We.UNRECOGNIZED}},e.sourceFromProto=function(e){switch(e){case We.CAMERA:return n.Camera;case We.MICROPHONE:return n.Microphone;case We.SCREEN_SHARE:return n.ScreenShare;case We.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case gi.ACTIVE:return i.Active;case gi.PAUSED:return i.Paused;default:return i.Unknown}}}($a||($a={}));var Wa,Ga="_lossy",Ha="_reliable",Qa="leave-reconnect";!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Wa||(Wa={}));var za=function(t){_inherits(i,t);var n=_createSuper(i);function i(t){var r;return _classCallCheck(this,i),(r=n.call(this)).options=t,r.rtcConfig={},r.peerConnectionTimeout=ja.peerConnectionTimeout,r.fullReconnectOnNext=!1,r.subscriberPrimary=!1,r.pcState=Wa.New,r._isClosed=!0,r.pendingTrackResolvers={},r.hasPublished=!1,r.reconnectAttempts=0,r.reconnectStart=0,r.attemptingReconnect=!1,r.joinAttempts=0,r.maxJoinAttempts=1,r.shouldFailNext=!1,r.handleDataChannel=function(e){var t=e.channel;return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}if(t.label!==Ha){e.next=5;break}this.reliableDCSub=t,e.next=8;break;case 5:if(t.label===Ga){e.next=7;break}return e.abrupt("return");case 7:this.lossyDCSub=t;case 8:o.debug("on data channel ".concat(t.id,", ").concat(t.label)),t.onmessage=this.handleDataMessage;case 9:case"end":return e.stop()}}),e,this)})))},r.handleDataMessage=function(t){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,s,c;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.dataProcessLock.lock();case 2:if(a=n.sent,n.prev=3,!(t.data instanceof ArrayBuffer)){n.next=8;break}s=t.data,n.next=13;break;case 8:if(t.data instanceof Blob){n.next=10;break}return n.abrupt("return",void o.error("unsupported data type",t.data));case 10:return n.next=12,t.data.arrayBuffer();case 12:s=n.sent;case 13:c=Pt.decode(new Uint8Array(s)),"speaker"===(null===(i=c.value)||void 0===i?void 0:i.$case)?this.emit(e.EngineEvent.ActiveSpeakersUpdate,c.value.speaker.speakers):"user"===(null===(r=c.value)||void 0===r?void 0:r.$case)&&this.emit(e.EngineEvent.DataPacketReceived,c.value.user,c.kind);case 15:return n.prev=15,a(),n.finish(15);case 18:case"end":return n.stop()}}),n,this,[[3,,15,18]])})))},r.handleDataError=function(e){var t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent){var n=e.error.error;o.error("DataChannel error on ".concat(t,": ").concat(e.message),n)}else o.error("Unknown DataChannel Error on ".concat(t),e)},r.handleBufferedAmountLow=function(t){var n=0===t.currentTarget.maxRetransmits?e.DataPacket_Kind.LOSSY:e.DataPacket_Kind.RELIABLE;r.updateAndEmitDCBufferStatus(n)},r.handleDisconnect=function(t,n){if(!r._isClosed){o.warn("".concat(t," disconnected")),0===r.reconnectAttempts&&(r.reconnectStart=Date.now());var i=Date.now()-r.reconnectStart,a=r.getNextRetryDelay({elapsedMs:i,retryCount:r.reconnectAttempts});null!==a?(t===Qa&&(a=0),o.debug("reconnecting in ".concat(a,"ms")),r.clearReconnectTimeout(),r.url&&r.token&&Fr(new URL(r.url))&&(r.regionUrlProvider=new Ra(r.url,r.token)),r.reconnectTimeout=mr.setTimeout((function(){return r.attemptReconnect(n)}),a)):function(t){o.warn("could not recover connection after ".concat(r.reconnectAttempts," attempts, ").concat(t,"ms. giving up")),r.emit(e.EngineEvent.Disconnected),r.close()}(i)}},r.waitForRestarted=function(){return new Promise((function(t,n){r.pcState===Wa.Connected&&t();var i=function(){r.off(e.EngineEvent.Disconnected,a),t()},a=function(){r.off(e.EngineEvent.Restarted,i),n()};r.once(e.EngineEvent.Restarted,i),r.once(e.EngineEvent.Disconnected,a)}))},r.updateAndEmitDCBufferStatus=function(t){var n=r.isBufferStatusLow(t);void 0!==n&&n!==r.dcBufferStatus.get(t)&&(r.dcBufferStatus.set(t,n),r.emit(e.EngineEvent.DCBufferStatusChanged,n,t))},r.isBufferStatusLow=function(e){var t=r.dataChannelForKind(e);if(t)return t.bufferedAmount<=t.bufferedAmountLowThreshold},r.handleBrowserOnLine=function(){r.client.isReconnecting&&(r.clearReconnectTimeout(),r.attemptReconnect(Ke.RR_SIGNAL_DISCONNECTED))},r.client=new ta,r.client.signalLatency=r.options.expSignalLatency,r.reconnectPolicy=r.options.reconnectPolicy,r.registerOnLineListener(),r.closingLock=new Xr,r.dataProcessLock=new Xr,r.dcBufferStatus=new Map([[e.DataPacket_Kind.LOSSY,!0],[e.DataPacket_Kind.RELIABLE,!0]]),r}return _createClass(i,[{key:"isClosed",get:function(){return this._isClosed}},{key:"join",value:function(e,t,n,i){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var a;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.url=e,this.token=t,this.signalOpts=n,r.prev=1,this.joinAttempts+=1,r.next=5,this.client.join(e,t,n,i);case 5:return a=r.sent,r.abrupt("return",(this._isClosed=!1,this.subscriberPrimary=a.subscriberPrimary,this.publisher||this.configure(a),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=a.clientConfiguration,a));case 9:if(r.prev=9,r.t0=r.catch(1),!(r.t0 instanceof dr&&1===r.t0.reason&&(o.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts)),this.joinAttempts<this.maxJoinAttempts))){r.next=13;break}return r.abrupt("return",this.join(e,t,n,i));case 13:throw r.t0;case 14:case"end":return r.stop()}}),r,this,[[1,9]])})))}},{key:"close",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.closingLock.lock();case 2:if(n=t.sent,!this.isClosed){t.next=7;break}n(),t.next=20;break;case 7:return t.prev=7,this._isClosed=!0,this.emit(e.EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.publisher&&"closed"!==this.publisher.pc.signalingState&&(this.publisher.pc.getSenders().forEach((function(e){var t,n;try{(null===(t=i.publisher)||void 0===t?void 0:t.pc.removeTrack)&&(null===(n=i.publisher)||void 0===n||n.pc.removeTrack(e))}catch(e){o.warn("could not removeTrack",{error:e})}})),this.publisher.close(),this.publisher=void 0),this.subscriber&&(this.subscriber.close(),this.subscriber=void 0),t.next=17,this.client.close();case 17:return t.prev=17,n(),t.finish(17);case 20:case"end":return t.stop()}}),t,this,[[7,,17,20]])})))}},{key:"addTrack",value:function(e){var t=this;if(this.pendingTrackResolvers[e.cid])throw new pr("a track with the same ID has already been published");return new Promise((function(n,i){var r=setTimeout((function(){delete t.pendingTrackResolvers[e.cid],i(new dr("publication of local track timed out, no response from server"))}),1e4);t.pendingTrackResolvers[e.cid]={resolve:function(e){clearTimeout(r),n(e)},reject:function(){clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},t.client.sendAddTrack(e)}))}},{key:"removeTrack",value:function(e){var t;if(e.track&&this.pendingTrackResolvers[e.track.id]){var n=this.pendingTrackResolvers[e.track.id].reject;n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return null===(t=this.publisher)||void 0===t||t.pc.removeTrack(e),!0}catch(e){o.warn("failed to remove track",{error:e,method:"removeTrack"})}return!1}},{key:"updateMuteStatus",value:function(e,t){this.client.sendMuteTrack(e,t)}},{key:"dataSubscriberReadyState",get:function(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}},{key:"getConnectedServerAddress",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.primaryPC){e.next=2;break}return e.abrupt("return",function(e){var t;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,o;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i="",r=new Map,a=new Map,n.next=4,e.getStats();case 4:if(n.sent.forEach((function(e){switch(e.type){case"transport":i=e.selectedCandidatePairId;break;case"candidate-pair":""===i&&e.selected&&(i=e.id),r.set(e.id,e);break;case"remote-candidate":a.set(e.id,"".concat(e.address,":").concat(e.port))}})),""!==i){n.next=7;break}return n.abrupt("return");case 7:return o=null===(t=r.get(i))||void 0===t?void 0:t.remoteCandidateId,n.abrupt("return",void 0!==o?a.get(o):void 0);case 9:case"end":return n.stop()}}),n)})))}(this.primaryPC));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"configure",value:function(t){var n,i=this;if(!this.publisher&&!this.subscriber){this.participantSid=null===(n=t.participant)||void 0===n?void 0:n.sid;var r=this.makeRTCConfiguration(t);this.publisher=new Sa(r,{optional:[{googDscp:!0}]}),this.subscriber=new Sa(r),this.emit(e.EngineEvent.TransportsCreated,this.publisher,this.subscriber),this.publisher.pc.onicecandidate=function(e){e.candidate&&(o.trace("adding ICE candidate for peer",e.candidate),i.client.sendIceCandidate(e.candidate,mi.PUBLISHER))},this.subscriber.pc.onicecandidate=function(e){e.candidate&&i.client.sendIceCandidate(e.candidate,mi.SUBSCRIBER)},this.publisher.onOffer=function(e){i.client.sendOffer(e)};var a=this.publisher.pc,s=this.subscriber.pc,c=t.subscriberPrimary;c&&(a=this.subscriber.pc,s=this.publisher.pc,this.subscriber.pc.ondatachannel=this.handleDataChannel),this.primaryPC=a,a.onconnectionstatechange=function(){return qt(i,void 0,void 0,_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o.debug("primary PC state changed ".concat(a.connectionState)),"connected"===a.connectionState?(i=this.pcState===Wa.New,this.pcState=Wa.Connected,i&&this.emit(e.EngineEvent.Connected,t)):"failed"===a.connectionState&&this.pcState===Wa.Connected&&(this.pcState=Wa.Disconnected,this.handleDisconnect("primary peerconnection",c?Ke.RR_SUBSCRIBER_FAILED:Ke.RR_PUBLISHER_FAILED));case 1:case"end":return n.stop()}}),n,this)})))},s.onconnectionstatechange=function(){return qt(i,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.debug("secondary PC state changed ".concat(s.connectionState)),"failed"===s.connectionState&&this.handleDisconnect("secondary peerconnection",c?Ke.RR_PUBLISHER_FAILED:Ke.RR_SUBSCRIBER_FAILED);case 1:case"end":return e.stop()}}),e,this)})))},this.subscriber.pc.ontrack=function(t){i.emit(e.EngineEvent.MediaTrackAdded,t.track,t.streams[0],t.receiver)},this.createDataChannels(),this.client.onAnswer=function(e){return qt(i,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.publisher,!t.t0){t.next=5;break}return o.debug("received server answer",{RTCSdpType:e.type,signalingState:this.publisher.pc.signalingState}),t.next=5,this.publisher.setRemoteDescription(e);case 5:case"end":return t.stop()}}),t,this)})))},this.client.onTrickle=function(e,t){i.publisher&&i.subscriber&&(o.trace("got ICE candidate from peer",{candidate:e,target:t}),t===mi.PUBLISHER?i.publisher.addIceCandidate(e):i.subscriber.addIceCandidate(e))},this.client.onOffer=function(e){return qt(i,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.subscriber){t.next=2;break}return t.abrupt("return");case 2:return o.debug("received server offer",{RTCSdpType:e.type,signalingState:this.subscriber.pc.signalingState}),t.next=5,this.subscriber.setRemoteDescription(e);case 5:return t.next=7,this.subscriber.createAndSetAnswer();case 7:n=t.sent,this.client.sendAnswer(n);case 9:case"end":return t.stop()}}),t,this)})))},this.client.onLocalTrackPublished=function(e){o.debug("received trackPublishedResponse",e);var t=i.pendingTrackResolvers[e.cid].resolve;t?(delete i.pendingTrackResolvers[e.cid],t(e.track)):o.error("missing track resolver for ".concat(e.cid))},this.client.onTokenRefresh=function(e){i.token=e},this.client.onClose=function(){i.handleDisconnect("signal",Ke.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=function(t){(null==t?void 0:t.canReconnect)?(i.fullReconnectOnNext=!0,i.primaryPC=void 0,i.handleDisconnect(Qa)):(i.emit(e.EngineEvent.Disconnected,null==t?void 0:t.reason),i.close()),o.trace("leave request",{leave:t})}}}},{key:"makeRTCConfiguration",value:function(e){var t=Object.assign({},this.rtcConfig);if(e.iceServers&&!t.iceServers){var n=[];e.iceServers.forEach((function(e){var t={urls:e.urls};e.username&&(t.username=e.username),e.credential&&(t.credential=e.credential),n.push(t)})),t.iceServers=n}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Qe.ENABLED&&(t.iceTransportPolicy="relay"),t.sdpSemantics="unified-plan",t.continualGatheringPolicy="gather_continually",t}},{key:"createDataChannels",value:function(){this.publisher&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.publisher.pc.createDataChannel(Ga,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.publisher.pc.createDataChannel(Ha,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}},{key:"setPreferredCodec",value:function(e,t,n){if("getCapabilities"in RTCRtpSender){var i=RTCRtpSender.getCapabilities(t);if(i){o.debug("get capabilities",i);var r=[],a=[],s=[];i.codecs.forEach((function(e){var t=e.mimeType.toLowerCase();"audio/opus"!==t?t==="video/".concat(n)?"h264"!==n||e.sdpFmtpLine&&e.sdpFmtpLine.includes("profile-level-id=42e01f")?r.push(e):a.push(e):s.push(e):r.push(e)})),function(e){if(!Lr())return!1;if(!("setCodecPreferences"in e))return!1;var t=br();if(!t.browser.name||!t.browser.version)return!1;var n=Ir[t.browser.name];return!!n&&function(e,t){for(var n=e.split("."),i=t.split("."),r=Math.min(e.length,t.length),a=0;a<r;++a){var o=parseInt(n[a],10),s=parseInt(i[a],10);if(o>s)return 1;if(o<s)return-1}return n.length==i.length?0:n.length<i.length?-1:1}(t.browser.version,n)>=0}(e)&&e.setCodecPreferences(r.concat(a,s))}}}},{key:"createSender",value:function(e,t,n){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!Er()){i.next=2;break}return i.abrupt("return",this.createTransceiverRTCRtpSender(e,t,n));case 2:if(!_r()){i.next=4;break}return i.abrupt("return",(o.debug("using add-track fallback"),this.createRTCRtpSender(e.mediaStreamTrack)));case 4:throw new hr("Required webRTC APIs not supported on this device");case 5:case"end":return i.stop()}}),i,this)})))}},{key:"createSimulcastSender",value:function(e,t,n,i){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!Er()){r.next=2;break}return r.abrupt("return",this.createSimulcastTransceiverSender(e,t,n,i));case 2:if(!_r()){r.next=4;break}return r.abrupt("return",(o.debug("using add-track fallback"),this.createRTCRtpSender(e.mediaStreamTrack)));case 4:throw new hr("Cannot stream on this device");case 5:case"end":return r.stop()}}),r,this)})))}},{key:"createTransceiverRTCRtpSender",value:function(e,t,n){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var r,a;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.publisher){i.next=2;break}throw new hr("publisher is closed");case 2:return r={direction:"sendonly"},n&&(r.sendEncodings=n),i.next=6,this.publisher.pc.addTransceiver(e.mediaStreamTrack,r);case 6:return a=i.sent,i.abrupt("return",(e.kind===$a.Kind.Video&&t.videoCodec&&(this.setPreferredCodec(a,e.kind,t.videoCodec),e.codec=t.videoCodec),a.sender));case 8:case"end":return i.stop()}}),i,this)})))}},{key:"createSimulcastTransceiverSender",value:function(e,t,n,i){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var a,o;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.publisher){r.next=2;break}throw new hr("publisher is closed");case 2:return a={direction:"sendonly"},i&&(a.sendEncodings=i),r.next=6,this.publisher.pc.addTransceiver(t.mediaStreamTrack,a);case 6:if(o=r.sent,!n.videoCodec){r.next=9;break}return r.abrupt("return",(this.setPreferredCodec(o,e.kind,n.videoCodec),e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender));case 9:case"end":return r.stop()}}),r,this)})))}},{key:"createRTCRtpSender",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.publisher){t.next=2;break}throw new hr("publisher is closed");case 2:return t.abrupt("return",this.publisher.pc.addTrack(e));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"attemptReconnect",value:function(t){var n,i,r;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var s;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._isClosed||this.attemptingReconnect){a.next=31;break}if((null===(n=this.clientConfiguration)||void 0===n?void 0:n.resumeConnection)!==Qe.DISABLED&&"closed"!==(null!==(r=null===(i=this.primaryPC)||void 0===i?void 0:i.signalingState)&&void 0!==r?r:"closed")||(this.fullReconnectOnNext=!0),a.prev=2,this.attemptingReconnect=!0,!this.fullReconnectOnNext){a.next=9;break}return a.next=7,this.restartConnection();case 7:a.next=11;break;case 9:return a.next=11,this.resumeConnection(t);case 11:this.clearPendingReconnect(),this.fullReconnectOnNext=!1,a.next=28;break;case 15:if(a.prev=15,a.t0=a.catch(2),this.reconnectAttempts+=1,s=!0,a.t0 instanceof hr?(o.debug("received unrecoverable error",{error:a.t0}),s=!1):a.t0 instanceof Ka||(this.fullReconnectOnNext=!0),!s){a.next=24;break}this.handleDisconnect("reconnect",Ke.RR_UNKOWN),a.next=28;break;case 24:return o.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up")),this.emit(e.EngineEvent.Disconnected),a.next=28,this.close();case 28:return a.prev=28,this.attemptingReconnect=!1,a.finish(28);case 31:case"end":return a.stop()}}),a,this,[[2,15,28,31]])})))}},{key:"getNextRetryDelay",value:function(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){o.warn("encountered error in reconnect policy",{error:e})}return null}},{key:"restartConnection",value:function(t){var n,i,r,a,s;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function c(){var u,d;return _regeneratorRuntime().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(c.prev=0,this.url&&this.token){c.next=3;break}throw new hr("could not reconnect, url or token not saved");case 3:if(o.info("reconnecting, attempt: ".concat(this.reconnectAttempts)),this.emit(e.EngineEvent.Restarting),c.t0=this.client.isConnected,!c.t0){c.next=9;break}return c.next=9,this.client.sendLeave();case 9:return c.next=11,this.client.close();case 11:if(this.primaryPC=void 0,null===(n=this.publisher)||void 0===n||n.close(),this.publisher=void 0,null===(i=this.subscriber)||void 0===i||i.close(),this.subscriber=void 0,c.prev=16,this.signalOpts){c.next=19;break}throw o.warn("attempted connection restart, without signal options present"),new Ka;case 19:return c.next=21,this.join(null!=t?t:this.url,this.token,this.signalOpts);case 21:u=c.sent,c.next=29;break;case 24:if(c.prev=24,c.t1=c.catch(16),!(c.t1 instanceof dr&&0===c.t1.reason)){c.next=28;break}throw new hr("could not reconnect, token might be expired");case 28:throw new Ka;case 29:if(!this.shouldFailNext){c.next=31;break}throw this.shouldFailNext=!1,new Error("simulated failure");case 31:return this.client.setReconnected(),this.emit(e.EngineEvent.SignalRestarted,u),c.next=35,this.waitForPCReconnected();case 35:null===(r=this.regionUrlProvider)||void 0===r||r.resetAttempts(),this.emit(e.EngineEvent.Restarted),c.next=49;break;case 39:return c.prev=39,c.t2=c.catch(0),c.next=43,null===(a=this.regionUrlProvider)||void 0===a?void 0:a.getNextBestRegionUrl();case 43:if(!(d=c.sent)){c.next=48;break}return c.next=47,this.restartConnection(d);case 47:return c.abrupt("return",void c.sent);case 48:throw null===(s=this.regionUrlProvider)||void 0===s||s.resetAttempts(),c.t2;case 49:case"end":return c.stop()}}),c,this,[[0,39],[16,24]])})))}},{key:"resumeConnection",value:function(t){var n;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var r,a,s;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.url&&this.token){i.next=2;break}throw new hr("could not reconnect, url or token not saved");case 2:if(this.publisher&&this.subscriber){i.next=4;break}throw new hr("publisher and subscriber connections unset");case 4:return o.info("resuming signal connection, attempt ".concat(this.reconnectAttempts)),this.emit(e.EngineEvent.Resuming),i.prev=5,i.next=8,this.client.reconnect(this.url,this.token,this.participantSid,t);case 8:(r=i.sent)&&(a=this.makeRTCConfiguration(r),this.publisher.pc.setConfiguration(a),this.subscriber.pc.setConfiguration(a)),i.next=18;break;case 12:if(i.prev=12,i.t0=i.catch(5),s="",i.t0 instanceof Error&&(s=i.t0.message),!(i.t0 instanceof dr&&0===i.t0.reason)){i.next=17;break}throw new hr("could not reconnect, token might be expired");case 17:throw new Ka(s);case 18:if(this.emit(e.EngineEvent.SignalResumed),!this.shouldFailNext){i.next=20;break}throw this.shouldFailNext=!1,new Error("simulated failure");case 20:if(this.subscriber.restartingIce=!0,i.t1=this.hasPublished,!i.t1){i.next=25;break}return i.next=25,this.publisher.createAndSendOffer({iceRestart:!0});case 25:return i.next=27,this.waitForPCReconnected();case 27:this.client.setReconnected(),"open"===(null===(n=this.reliableDC)||void 0===n?void 0:n.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),this.emit(e.EngineEvent.Resumed);case 30:case"end":return i.stop()}}),i,this,[[5,12]])})))}},{key:"waitForPCInitialConnection",value:function(t,n){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var r=this;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.pcState===Wa.Connected){i.next=4;break}if(this.pcState===Wa.New){i.next=3;break}throw new hr("Expected peer connection to be new on initial connection");case 3:return i.abrupt("return",new Promise((function(i,a){var s=function(){o.warn("closing engine"),mr.clearTimeout(u),a(new dr("room connection has been cancelled",3))};(null==n?void 0:n.signal.aborted)&&s(),null==n||n.signal.addEventListener("abort",s);var c=function(){mr.clearTimeout(u),null==n||n.signal.removeEventListener("abort",s),i()},u=mr.setTimeout((function(){r.off(e.EngineEvent.Connected,c),a(new dr("could not establish pc connection"))}),null!=t?t:r.peerConnectionTimeout);r.once(e.EngineEvent.Connected,c)})));case 4:case"end":return i.stop()}}),i,this)})))}},{key:"waitForPCReconnected",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Date.now(),i=n,this.pcState=Wa.Reconnecting,o.debug("waiting for peer connection to reconnect");case 3:if(!(i-n<this.peerConnectionTimeout&&void 0!==this.primaryPC)){t.next=11;break}if(i-n>2e3&&"connected"===(null===(e=this.primaryPC)||void 0===e?void 0:e.connectionState)&&(this.pcState=Wa.Connected),this.pcState!==Wa.Connected){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,Pr(100);case 8:i=Date.now();case 9:t.next=3;break;case 11:throw new dr("could not establish PC connection");case 12:case"end":return t.stop()}}),t,this)})))}},{key:"sendDataPacket",value:function(e,t){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=Pt.encode(e).finish(),n.next=3,this.ensurePublisherConnected(t);case 3:(r=this.dataChannelForKind(t))&&r.send(i),this.updateAndEmitDCBufferStatus(t);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"ensureDataTransportConnected",value:function(e){var t,n,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o,s,c,u;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=r?this.subscriber:this.publisher,s=r?"Subscriber":"Publisher",o){a.next=3;break}throw new dr("".concat(s," connection not set"));case 3:if(r||(null===(t=this.publisher)||void 0===t?void 0:t.isICEConnected)||"checking"===(null===(n=this.publisher)||void 0===n?void 0:n.pc.iceConnectionState)||this.negotiate(),"open"!==(null==(c=this.dataChannelForKind(e,r))?void 0:c.readyState)){a.next=7;break}return a.abrupt("return");case 7:u=(new Date).getTime()+this.peerConnectionTimeout;case 8:if(!((new Date).getTime()<u)){a.next=15;break}if(!o.isICEConnected||"open"!==(null===(i=this.dataChannelForKind(e,r))||void 0===i?void 0:i.readyState)){a.next=11;break}return a.abrupt("return");case 11:return a.next=13,Pr(50);case 13:a.next=8;break;case 15:throw new dr("could not establish ".concat(s," connection, state: ").concat(o.pc.iceConnectionState));case 16:case"end":return a.stop()}}),a,this)})))}},{key:"ensurePublisherConnected",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureDataTransportConnected(e,!1);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"verifyTransport",value:function(){if(!this.primaryPC)return!1;if("closed"===this.primaryPC.connectionState||"failed"===this.primaryPC.connectionState)return!1;if(this.hasPublished&&this.subscriberPrimary){if(!this.publisher)return!1;if("closed"===this.publisher.pc.connectionState||"failed"===this.publisher.pc.connectionState)return!1}return!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}},{key:"negotiate",value:function(){var t=this;return new Promise((function(n,i){if(t.publisher){t.hasPublished=!0;var r=function(){o.debug("engine disconnected while negotiation was ongoing"),s(),n()};t.on(e.EngineEvent.Closing,r);var a=setTimeout((function(){i("negotiation timed out"),t.handleDisconnect("negotiation",Ke.RR_SIGNAL_DISCONNECTED)}),t.peerConnectionTimeout),s=function(){clearTimeout(a),t.off(e.EngineEvent.Closing,r)};t.publisher.once(ka,(function(){var e;null===(e=t.publisher)||void 0===e||e.once(ya,(function(){s(),n()}))})),t.publisher.negotiate((function(e){s(),i(e),e instanceof vr&&(t.fullReconnectOnNext=!0),t.handleDisconnect("negotiation",Ke.RR_UNKOWN)}))}else i(new vr("publisher is not defined"))}))}},{key:"dataChannelForKind",value:function(t,n){if(n){if(t===e.DataPacket_Kind.LOSSY)return this.lossyDCSub;if(t===e.DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(t===e.DataPacket_Kind.LOSSY)return this.lossyDC;if(t===e.DataPacket_Kind.RELIABLE)return this.reliableDC}}},{key:"failNext",value:function(){this.shouldFailNext=!0}},{key:"clearReconnectTimeout",value:function(){this.reconnectTimeout&&mr.clearTimeout(this.reconnectTimeout)}},{key:"clearPendingReconnect",value:function(){this.clearReconnectTimeout(),this.reconnectAttempts=0}},{key:"registerOnLineListener",value:function(){Lr()&&window.addEventListener("online",this.handleBrowserOnLine)}},{key:"deregisterOnLineListener",value:function(){Lr()&&window.removeEventListener("online",this.handleBrowserOnLine)}}]),i}(un.EventEmitter),Ka=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n)}(),Za=2e3;function Ya(e,t){return t?("bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)):0;var n,i}var Xa=function(t){_inherits(i,t);var n=_createSuper(i);function i(t,r,a){var o;_classCallCheck(this,i);var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(o=n.call(this,t,r))._isUpstreamPaused=!1,o.handleEnded=function(){o.isInBackground&&(o.reacquireTrack=!0),o.emit(e.TrackEvent.Ended,_assertThisInitialized(o))},o._mediaStreamTrack.addEventListener("ended",o.handleEnded),o.constraints=null!=a?a:t.getConstraints(),o.reacquireTrack=!1,o.providedByUser=s,o.muteLock=new Xr,o.pauseUpstreamLock=new Xr,o}return _createClass(i,[{key:"id",get:function(){return this._mediaStreamTrack.id}},{key:"dimensions",get:function(){if(this.kind===$a.Kind.Video){var e=this._mediaStreamTrack.getSettings(),t=e.width,n=e.height;return t&&n?{width:t,height:n}:void 0}}},{key:"isUpstreamPaused",get:function(){return this._isUpstreamPaused}},{key:"isUserProvided",get:function(){return this.providedByUser}},{key:"waitForDimensions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.kind!==$a.Kind.Audio){t.next=2;break}throw new Error("cannot get dimensions for audio tracks");case 2:n=Date.now();case 3:if(!(Date.now()-n<e)){t.next=11;break}if(!(i=this.dimensions)){t.next=7;break}return t.abrupt("return",i);case 7:return t.next=9,Pr(50);case 9:t.next=3;break;case 11:throw new pr("unable to get track dimensions after timeout");case 12:case"end":return t.stop()}}),t,this)})))}},{key:"getDeviceId",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n,i,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.source!==$a.Source.ScreenShare){e.next=2;break}return e.abrupt("return");case 2:return t=this._mediaStreamTrack.getSettings(),n=t.deviceId,i=t.groupId,r=this.kind===$a.Kind.Audio?"audioinput":"videoinput",e.abrupt("return",aa.getInstance().normalizeDeviceId(r,n,i));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"mute",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.setTrackMuted(!0),this));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"unmute",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.setTrackMuted(!1),this));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"replaceTrack",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i=this;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.sender){n.next=2;break}throw new pr("unable to replace an unpublished track");case 2:if(this.attachedElements.forEach((function(e){qa(i._mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this.providedByUser||this._mediaStreamTrack.stop(),e.addEventListener("ended",this.handleEnded),o.debug("replace MediaStreamTrack"),n.t0=this.sender,!n.t0){n.next=11;break}return n.next=11,this.sender.replaceTrack(e);case 11:return this._mediaStreamTrack=e,this._mediaStreamTrack.enabled=!this.isMuted,n.next=15,this.resumeUpstream();case 15:return this.attachedElements.forEach((function(t){Va(e,t)})),this.mediaStream=new MediaStream([e]),this.providedByUser=t,n.abrupt("return",this);case 19:case"end":return n.stop()}}),n,this)})))}},{key:"restart",value:function(t){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,s=this;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t||(t=this.constraints),o.debug("restarting track with constraints",t),i={audio:!1,video:!1},this.kind===$a.Kind.Video?i.video=t:i.audio=t,this.attachedElements.forEach((function(e){qa(s._mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop(),n.next=5,navigator.mediaDevices.getUserMedia(i);case 5:if(r=n.sent,(a=r.getTracks()[0]).addEventListener("ended",this.handleEnded),o.debug("re-acquired MediaStreamTrack"),n.t0=this.sender,!n.t0){n.next=13;break}return n.next=13,this.sender.replaceTrack(a);case 13:return this._mediaStreamTrack=a,n.next=16,this.resumeUpstream();case 16:return this.attachedElements.forEach((function(e){Va(a,e)})),this.mediaStream=r,this.constraints=t,this.emit(e.TrackEvent.Restarted,this),n.abrupt("return",this);case 21:case"end":return n.stop()}}),n,this)})))}},{key:"setTrackMuted",value:function(t){o.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted")),this.isMuted===t&&this._mediaStreamTrack.enabled!==t||(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}},{key:"needsReAcquisition",get:function(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}},{key:"handleAppVisibilityChanged",value:function(){var e=this,t=Object.create(null,{handleAppVisibilityChanged:{get:function(){return _get(_getPrototypeOf(i.prototype),"handleAppVisibilityChanged",e)}}});return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.handleAppVisibilityChanged.call(this);case 2:if(e.t0=Ur(),!e.t0){e.next=11;break}if(o.debug("visibility changed, is in Background: ".concat(this.isInBackground)),e.t1=this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted,e.t1){e.next=11;break}return o.debug("track needs to be reaquired, restarting ".concat(this.source)),e.next=10,this.restart();case 10:this.reacquireTrack=!1;case 11:case"end":return e.stop()}}),e,this)})))}},{key:"pauseUpstream",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.pauseUpstreamLock.lock();case 2:if(n=t.sent,t.prev=3,!0!==this._isUpstreamPaused){t.next=6;break}return t.abrupt("return");case 6:if(this.sender){t.next=8;break}return t.abrupt("return",void o.warn("unable to pause upstream for an unpublished track"));case 8:return this._isUpstreamPaused=!0,this.emit(e.TrackEvent.UpstreamPaused,this),i=this.kind===$a.Kind.Audio?Zr():zr(),t.next=12,this.sender.replaceTrack(i);case 12:return t.prev=12,n(),t.finish(12);case 15:case"end":return t.stop()}}),t,this,[[3,,12,15]])})))}},{key:"resumeUpstream",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.pauseUpstreamLock.lock();case 2:if(n=t.sent,t.prev=3,!1!==this._isUpstreamPaused){t.next=6;break}return t.abrupt("return");case 6:if(this.sender){t.next=8;break}return t.abrupt("return",void o.warn("unable to resume upstream for an unpublished track"));case 8:return this._isUpstreamPaused=!1,this.emit(e.TrackEvent.UpstreamResumed,this),t.next=12,this.sender.replaceTrack(this._mediaStreamTrack);case 12:return t.prev=12,n(),t.finish(12);case 15:case"end":return t.stop()}}),t,this,[[3,,12,15]])})))}}]),i}($a),eo=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t){var r;_classCallCheck(this,i);var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(r=n.call(this,e,$a.Kind.Audio,t,a)).stopOnMute=!1,r.monitorSender=function(){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sender){e.next=2;break}return e.abrupt("return",void(this._currentBitrate=0));case 2:return e.prev=2,e.next=5,this.getSenderStats();case 5:t=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",void o.error("could not get audio sender stats",{error:e.t0}));case 11:t&&this.prevStats&&(this._currentBitrate=Ya(t,this.prevStats)),this.prevStats=t;case 12:case"end":return e.stop()}}),e,this,[[2,8]])})))},r.checkForSilence(),r}return _createClass(i,[{key:"setDeviceId",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.constraints.deviceId!==e,!t.t0){t.next=7;break}if(this.constraints.deviceId=e,t.t1=this.isMuted,t.t1){t.next=7;break}return t.next=7,this.restartTrack();case 7:case"end":return t.stop()}}),t,this)})))}},{key:"mute",value:function(){var e=this,t=Object.create(null,{mute:{get:function(){return _get(_getPrototypeOf(i.prototype),"mute",e)}}});return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.muteLock.lock();case 2:return n=e.sent,e.prev=3,this.source===$a.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(o.debug("stopping mic track"),this._mediaStreamTrack.stop()),e.next=7,t.mute.call(this);case 7:return e.abrupt("return",this);case 8:return e.prev=8,n(),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[3,,8,11]])})))}},{key:"unmute",value:function(){var e=this,t=Object.create(null,{unmute:{get:function(){return _get(_getPrototypeOf(i.prototype),"unmute",e)}}});return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.muteLock.lock();case 2:if(n=e.sent,e.prev=3,e.t0=this.source!==$a.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState||this.isUserProvided,e.t0){e.next=9;break}return o.debug("reacquiring mic track"),e.next=9,this.restartTrack();case 9:return e.next=11,t.unmute.call(this);case 11:return e.abrupt("return",this);case 12:return e.prev=12,n(),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[3,,12,15]])})))}},{key:"restartTrack",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e&&"boolean"!=typeof(i=Cr({audio:e})).audio&&(n=i.audio),t.next=3,this.restart(n);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"restart",value:function(e){var t=this,n=Object.create(null,{restart:{get:function(){return _get(_getPrototypeOf(i.prototype),"restart",t)}}});return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.restart.call(this,e);case 2:return i=t.sent,t.abrupt("return",(this.checkForSilence(),i));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"startMonitor",value:function(){var e=this;Lr()&&(this.monitorInterval||(this.monitorInterval=setInterval((function(){e.monitorSender()}),Za)))}},{key:"getSenderStats",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(e=this.sender)||void 0===e?void 0:e.getStats){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.sender.getStats();case 4:return t.sent.forEach((function(e){"outbound-rtp"===e.type&&(n={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})})),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"checkForSilence",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,o,s;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(i=Rr())){n.next=11;break}return(r=i.createAnalyser()).fftSize=2048,a=r.frequencyBinCount,o=new Uint8Array(a),i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),n.next=8,Pr(t);case 8:return r.getByteTimeDomainData(o),s=o.some((function(e){return 128!==e&&0!==e})),n.abrupt("return",(i.close(),!s));case 11:return n.abrupt("return",!1);case 12:case"end":return n.stop()}}),n)})))}(this);case 2:return n=t.sent,t.abrupt("return",(n&&(this.isMuted||o.warn("silence detected on local audio track"),this.emit(e.TrackEvent.AudioSilenceDetected)),n));case 4:case"end":return t.stop()}}),t,this)})))}}]),i}(Xa),to=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t){var r;_classCallCheck(this,i);var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(r=n.call(this,e,$a.Kind.Video,t,a)).simulcastCodecs=new Map,r.monitorSender=function(){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n,i,r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sender){e.next=2;break}return e.abrupt("return",void(this._currentBitrate=0));case 2:return e.prev=2,e.next=5,this.getSenderStats();case 5:t=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",void o.error("could not get audio sender stats",{error:e.t0}));case 11:n=new Map(t.map((function(e){return[e.rid,e]}))),this.prevStats&&(i=0,n.forEach((function(e,t){var n,a=null===(n=r.prevStats)||void 0===n?void 0:n.get(t);i+=Ya(e,a)})),this._currentBitrate=i),this.prevStats=n;case 14:case"end":return e.stop()}}),e,this,[[2,8]])})))},r.senderLock=new Xr,r}return _createClass(i,[{key:"isSimulcast",get:function(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}},{key:"startMonitor",value:function(e){var t,n=this;if(this.signalClient=e,Lr()){var i=null===(t=this.sender)||void 0===t?void 0:t.getParameters();i&&(this.encodings=i.encodings),this.monitorInterval||(this.monitorInterval=setInterval((function(){n.monitorSender()}),Za))}}},{key:"stop",value:function(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach((function(e){e.mediaStreamTrack.stop()})),_get(_getPrototypeOf(i.prototype),"stop",this).call(this)}},{key:"mute",value:function(){var e=this,t=Object.create(null,{mute:{get:function(){return _get(_getPrototypeOf(i.prototype),"mute",e)}}});return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.muteLock.lock();case 2:return n=e.sent,e.prev=3,this.source!==$a.Source.Camera||this.isUserProvided||(o.debug("stopping camera track"),this._mediaStreamTrack.stop()),e.next=7,t.mute.call(this);case 7:return e.abrupt("return",this);case 8:return e.prev=8,n(),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[3,,8,11]])})))}},{key:"unmute",value:function(){var e=this,t=Object.create(null,{unmute:{get:function(){return _get(_getPrototypeOf(i.prototype),"unmute",e)}}});return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.muteLock.lock();case 2:if(n=e.sent,e.prev=3,e.t0=this.source!==$a.Source.Camera||this.isUserProvided,e.t0){e.next=9;break}return o.debug("reacquiring camera track"),e.next=9,this.restartTrack();case 9:return e.next=11,t.unmute.call(this);case 11:return e.abrupt("return",this);case 12:return e.prev=12,n(),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[3,,12,15]])})))}},{key:"getSenderStats",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(e=this.sender)||void 0===e?void 0:e.getStats){t.next=2;break}return t.abrupt("return",[]);case 2:return n=[],t.next=5,this.sender.getStats();case 5:return i=t.sent,t.abrupt("return",(i.forEach((function(e){var t;if("outbound-rtp"===e.type){var r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,framesSent:e.framesSent,timestamp:e.timestamp,rid:null!==(t=e.rid)&&void 0!==t?t:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges},a=i.get(e.remoteId);a&&(r.jitter=a.jitter,r.packetsLost=a.packetsLost,r.roundTripTime=a.roundTripTime),n.push(r)}})),n));case 7:case"end":return t.stop()}}),t,this)})))}},{key:"setPublishingQuality",value:function(t){for(var n=[],i=e.VideoQuality.LOW;i<=e.VideoQuality.HIGH;i+=1)n.push({quality:i,enabled:i<=t});o.debug("setting publishing quality. max quality ".concat(t)),this.setPublishingLayers(n)}},{key:"setDeviceId",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.constraints.deviceId!==e,!t.t0){t.next=7;break}if(this.constraints.deviceId=e,t.t1=this.isMuted,t.t1){t.next=7;break}return t.next=7,this.restartTrack();case 7:case"end":return t.stop()}}),t,this)})))}},{key:"restartTrack",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e&&"boolean"!=typeof(i=Cr({video:e})).video&&(n=i.video),t.next=3,this.restart(n);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"addSimulcastTrack",value:function(e,t){if(this.simulcastCodecs.has(e))throw new Error("".concat(e," already added"));var n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}},{key:"setSimulcastTrackSender",value:function(e,t){var n=this,i=this.simulcastCodecs.get(e);i&&(i.sender=t,setTimeout((function(){n.subscribedCodecs&&n.setPublishingCodecs(n.subscribedCodecs)}),5e3))}},{key:"setPublishingCodecs",value:function(e){var t,n,i,r,a,s,c;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function u(){var d,l,p,f,h;return _regeneratorRuntime().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(o.debug("setting publishing codecs",{codecs:e,currentCodec:this.codec}),this.codec||!(e.length>0)){u.next=4;break}return u.next=3,this.setPublishingLayers(e[0].qualities);case 3:return u.abrupt("return",[]);case 4:this.subscribedCodecs=e,d=[],u.prev=6,t=!0,n=Wt(e);case 8:return u.next=10,n.next();case 10:if(i=u.sent,r=i.done){u.next=52;break}if(c=i.value,t=!1,u.prev=13,l=c,!this.codec||this.codec===l.codec){u.next=45;break}if(p=this.simulcastCodecs.get(l.codec),o.debug("try setPublishingCodec for ".concat(l.codec),p),!p||!p.sender){u.next=25;break}if(u.t0=p.encodings,!u.t0){u.next=23;break}return o.debug("try setPublishingLayersForSender ".concat(l.codec)),u.next=23,no(p.sender,p.encodings,l.qualities,this.senderLock);case 23:u.next=43;break;case 25:f=_createForOfIteratorHelper(l.qualities),u.prev=26,f.s();case 28:if((h=f.n()).done){u.next=35;break}if(!h.value.enabled){u.next=33;break}return d.push(l.codec),u.abrupt("break",35);case 33:u.next=28;break;case 35:u.next=40;break;case 37:u.prev=37,u.t1=u.catch(26),f.e(u.t1);case 40:return u.prev=40,f.f(),u.finish(40);case 43:u.next=47;break;case 45:return u.next=47,this.setPublishingLayers(l.qualities);case 47:return u.prev=47,t=!0,u.finish(47);case 50:u.next=8;break;case 52:u.next=57;break;case 54:u.prev=54,u.t2=u.catch(6),a={error:u.t2};case 57:if(u.prev=57,u.prev=58,u.t3=t||r||!(s=n.return),u.t3){u.next=63;break}return u.next=63,s.call(n);case 63:if(u.prev=63,!a){u.next=66;break}throw a.error;case 66:return u.finish(63);case 67:return u.finish(57);case 68:return u.abrupt("return",d);case 69:case"end":return u.stop()}}),u,this,[[6,54,57,68],[13,,47,50],[26,37,40,43],[58,,63,67]])})))}},{key:"setPublishingLayers",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o.debug("setting publishing layers",e),t.t0=this.sender&&this.encodings,!t.t0){t.next=5;break}return t.next=5,no(this.sender,this.encodings,e,this.senderLock);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"handleAppVisibilityChanged",value:function(){var e=this,t=Object.create(null,{handleAppVisibilityChanged:{get:function(){return _get(_getPrototypeOf(i.prototype),"handleAppVisibilityChanged",e)}}});return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.handleAppVisibilityChanged.call(this);case 2:Ur()&&this.isInBackground&&this.source===$a.Source.Camera&&(this._mediaStreamTrack.enabled=!1);case 3:case"end":return e.stop()}}),e,this)})))}}]),i}(Xa);function no(e,t,n,i){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var a,s,c,u;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.lock();case 2:if(a=r.sent,o.debug("setPublishingLayersForSender",{sender:e,qualities:n,senderEncodings:t}),r.prev=4,s=e.getParameters(),c=s.encodings){r.next=8;break}return r.abrupt("return");case 8:if(c.length===t.length){r.next=10;break}return r.abrupt("return",void o.warn("cannot set publishing layers, encodings mismatch"));case 10:if(u=!1,c.forEach((function(e,i){var r,a=null!==(r=e.rid)&&void 0!==r?r:"";""===a&&(a="q");var s=io(a),c=n.find((function(e){return e.quality===s}));c&&e.active!==c.enabled&&(u=!0,e.active=c.enabled,o.debug("setting layer ".concat(c.quality," to ").concat(e.active?"enabled":"disabled")),Dr()&&(c.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})),r.t0=u,!r.t0){r.next=17;break}return s.encodings=c,r.next=17,e.setParameters(s);case 17:return r.prev=17,a(),r.finish(17);case 20:case"end":return r.stop()}}),r,null,[[4,,17,20]])})))}function io(t){switch(t){case"f":return e.VideoQuality.HIGH;case"h":return e.VideoQuality.MEDIUM;case"q":return e.VideoQuality.LOW;default:return e.VideoQuality.UNRECOGNIZED}}function ro(t,n,i){return i?i.map((function(r){var a,o,s,c=null!==(a=r.scaleResolutionDownBy)&&void 0!==a?a:1,u=io(null!==(o=r.rid)&&void 0!==o?o:"");return u===e.VideoQuality.UNRECOGNIZED&&1===i.length&&(u=e.VideoQuality.HIGH),{quality:u,width:t/c,height:n/c,bitrate:null!==(s=r.maxBitrate)&&void 0!==s?s:0,ssrc:0}})):[{quality:e.VideoQuality.HIGH,width:t,height:n,bitrate:0,ssrc:0}]}var ao=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t,r,a){var o;return _classCallCheck(this,i),(o=n.call(this,e,r)).sid=t,o.receiver=a,o}return _createClass(i,[{key:"setMuted",value:function(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?e.TrackEvent.Muted:e.TrackEvent.Unmuted,this))}},{key:"setMediaStream",value:function(t){var n=this;this.mediaStream=t,t.onremovetrack=function(){n.receiver=void 0,n._currentBitrate=0,n.emit(e.TrackEvent.Ended,n)}}},{key:"start",value:function(){this.startMonitor(),_get(_getPrototypeOf(i.prototype),"enable",this).call(this)}},{key:"stop",value:function(){this.stopMonitor(),_get(_getPrototypeOf(i.prototype),"disable",this).call(this)}},{key:"startMonitor",value:function(){var e=this;this.monitorInterval||(this.monitorInterval=setInterval((function(){return e.monitorReceiver()}),Za))}}]),i}($a),oo=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t,r,a,o){var s;return _classCallCheck(this,i),(s=n.call(this,e,t,$a.Kind.Audio,r)).monitorReceiver=function(){return qt(_assertThisInitialized(s),void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.receiver){e.next=2;break}return e.abrupt("return",void(this._currentBitrate=0));case 2:return e.next=4,this.getReceiverStats();case 4:(t=e.sent)&&this.prevStats&&this.receiver&&(this._currentBitrate=Ya(t,this.prevStats)),this.prevStats=t;case 6:case"end":return e.stop()}}),e,this)})))},s.audioContext=a,s.webAudioPluginNodes=[],o&&(s.sinkId=o.deviceId),s}return _createClass(i,[{key:"setVolume",value:function(e){var t,n,i=_createForOfIteratorHelper(this.attachedElements);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):r.volume=e}}catch(e){i.e(e)}finally{i.f()}this.elementVolume=e}},{key:"getVolume",value:function(){if(this.elementVolume)return this.elementVolume;var e=0;return this.attachedElements.forEach((function(t){t.volume>e&&(e=t.volume)})),e}},{key:"setSinkId",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.sinkId=e,t.next=3,Promise.all(this.attachedElements.map((function(t){if(Nr(t))return t.setSinkId(e)})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"attach",value:function(e){var t=0===this.attachedElements.length;return e?_get(_getPrototypeOf(i.prototype),"attach",this).call(this,e):e=_get(_getPrototypeOf(i.prototype),"attach",this).call(this),this.elementVolume&&(e.volume=this.elementVolume),this.sinkId&&Nr(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(o.debug("using audio context mapping"),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),e}},{key:"detach",value:function(e){var t;return e?(t=_get(_getPrototypeOf(i.prototype),"detach",this).call(this,e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=_get(_getPrototypeOf(i.prototype),"detach",this).call(this),this.disconnectWebAudio()),t}},{key:"setAudioContext",value:function(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}},{key:"setWebAudioPlugins",value:function(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}},{key:"connectWebAudio",value:function(t,n){var i=this;this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);var r=this.sourceNode;this.webAudioPluginNodes.forEach((function(e){r.connect(e),r=e})),this.gainNode=t.createGain(),r.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==t.state&&t.resume().then((function(){"running"!==t.state&&i.emit(e.TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))})).catch((function(t){i.emit(e.TrackEvent.AudioPlaybackFailed,t)}))}},{key:"disconnectWebAudio",value:function(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}},{key:"getReceiverStats",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.receiver&&this.receiver.getStats){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.receiver.getStats();case 4:return e.sent.forEach((function(e){"inbound-rtp"===e.type&&(t={type:"audio",timestamp:e.timestamp,jitter:e.jitter,bytesReceived:e.bytesReceived,concealedSamples:e.concealedSamples,concealmentEvents:e.concealmentEvents,silentConcealedSamples:e.silentConcealedSamples,silentConcealmentEvents:e.silentConcealmentEvents,totalAudioEnergy:e.totalAudioEnergy,totalSamplesDuration:e.totalSamplesDuration})})),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})))}}]),i}(ao),so=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t,r,a){var o;return _classCallCheck(this,i),(o=n.call(this,e,t,$a.Kind.Video,r)).elementInfos=[],o.isObserved=!1,o.monitorReceiver=function(){return qt(_assertThisInitialized(o),void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.receiver){e.next=2;break}return e.abrupt("return",void(this._currentBitrate=0));case 2:return e.next=4,this.getReceiverStats();case 4:(t=e.sent)&&this.prevStats&&this.receiver&&(this._currentBitrate=Ya(t,this.prevStats)),this.prevStats=t;case 6:case"end":return e.stop()}}),e,this)})))},o.debouncedHandleResize=ba((function(){o.updateDimensions()}),100),o.adaptiveStreamSettings=a,o}return _createClass(i,[{key:"isAdaptiveStream",get:function(){return void 0!==this.adaptiveStreamSettings}},{key:"mediaStreamTrack",get:function(){return this.isAdaptiveStream&&!this.isObserved&&o.warn("When using adaptiveStream, you need to use remoteVideoTrack.attach() to add the track to a HTMLVideoElement, otherwise your video tracks might never start"),this._mediaStreamTrack}},{key:"setMuted",value:function(e){var t=this;_get(_getPrototypeOf(i.prototype),"setMuted",this).call(this,e),this.attachedElements.forEach((function(n){e?qa(t._mediaStreamTrack,n):Va(t._mediaStreamTrack,n)}))}},{key:"attach",value:function(e){if(e?_get(_getPrototypeOf(i.prototype),"attach",this).call(this,e):e=_get(_getPrototypeOf(i.prototype),"attach",this).call(this),this.adaptiveStreamSettings&&void 0===this.elementInfos.find((function(t){return t.element===e}))){var t=new co(e);this.observeElementInfo(t)}return e}},{key:"observeElementInfo",value:function(e){var t=this;this.adaptiveStreamSettings&&void 0===this.elementInfos.find((function(t){return t===e}))?(e.handleResize=function(){t.debouncedHandleResize()},e.handleVisibilityChanged=function(){t.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility(),this.isObserved=!0):o.warn("visibility resize observer not triggered")}},{key:"stopObservingElementInfo",value:function(e){if(this.isAdaptiveStream){var t,n=_createForOfIteratorHelper(this.elementInfos.filter((function(t){return t===e})));try{for(n.s();!(t=n.n()).done;){t.value.stopObserving()}}catch(e){n.e(e)}finally{n.f()}this.elementInfos=this.elementInfos.filter((function(t){return t!==e})),this.updateVisibility()}else o.warn("stopObservingElementInfo ignored")}},{key:"detach",value:function(e){var t;if(e)return this.stopObservingElement(e),_get(_getPrototypeOf(i.prototype),"detach",this).call(this,e);var n,r=_createForOfIteratorHelper(t=_get(_getPrototypeOf(i.prototype),"detach",this).call(this));try{for(r.s();!(n=r.n()).done;){var a=n.value;this.stopObservingElement(a)}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"getDecoderImplementation",value:function(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}},{key:"getReceiverStats",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.receiver&&this.receiver.getStats){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.receiver.getStats();case 4:return e.sent.forEach((function(e){"inbound-rtp"===e.type&&(t={type:"video",framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation})})),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"stopObservingElement",value:function(e){var t,n=_createForOfIteratorHelper(this.elementInfos.filter((function(t){return t.element===e})));try{for(n.s();!(t=n.n()).done;){t.value.stopObserving()}}catch(e){n.e(e)}finally{n.f()}this.elementInfos=this.elementInfos.filter((function(t){return t.element!==e}))}},{key:"handleAppVisibilityChanged",value:function(){var e=this,t=Object.create(null,{handleAppVisibilityChanged:{get:function(){return _get(_getPrototypeOf(i.prototype),"handleAppVisibilityChanged",e)}}});return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.handleAppVisibilityChanged.call(this);case 2:this.isAdaptiveStream&&this.updateVisibility();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"updateVisibility",value:function(){var t,n,i=this,r=this.elementInfos.reduce((function(e,t){return Math.max(e,t.visibilityChangedAt||0)}),0),a=!(null!==(n=null===(t=this.adaptiveStreamSettings)||void 0===t?void 0:t.pauseVideoInBackground)&&void 0!==n&&!n)&&this.isInBackground,o=this.elementInfos.some((function(e){return e.pictureInPicture})),s=this.elementInfos.some((function(e){return e.visible}))&&!a||o;this.lastVisible!==s&&(!s&&Date.now()-r<100?mr.setTimeout((function(){i.updateVisibility()}),100):(this.lastVisible=s,this.emit(e.TrackEvent.VisibilityChanged,s,this)))}},{key:"updateDimensions",value:function(){var t,n,i,r,a,o=0,s=0,c=_createForOfIteratorHelper(this.elementInfos);try{for(c.s();!(a=c.n()).done;){var u=a.value,d=null!==(n=null===(t=this.adaptiveStreamSettings)||void 0===t?void 0:t.pixelDensity)&&void 0!==n?n:1,l="screen"===d?jr():d,p=u.width()*l,f=u.height()*l;p+f>o+s&&(o=p,s=f)}}catch(e){c.e(e)}finally{c.f()}(null===(i=this.lastDimensions)||void 0===i?void 0:i.width)===o&&(null===(r=this.lastDimensions)||void 0===r?void 0:r.height)===s||(this.lastDimensions={width:o,height:s},this.emit(e.TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}}]),i}(ao),co=function(){function e(t,n){var i=this;_classCallCheck(this,e),this.onVisibilityChanged=function(e){var t,n=e.target,r=e.isIntersecting;n===i.element&&(i.isIntersecting=r,i.visibilityChangedAt=Date.now(),null===(t=i.handleVisibilityChanged)||void 0===t||t.call(i))},this.onEnterPiP=function(){var e;i.isPiP=!0,null===(e=i.handleVisibilityChanged)||void 0===e||e.call(i)},this.onLeavePiP=function(){var e;i.isPiP=!1,null===(e=i.handleVisibilityChanged)||void 0===e||e.call(i)},this.element=t,this.isIntersecting=null!=n?n:uo(t),this.isPiP=Lr()&&document.pictureInPictureElement===t,this.visibilityChangedAt=0}return _createClass(e,[{key:"visible",get:function(){return this.isPiP||this.isIntersecting}},{key:"pictureInPicture",get:function(){return this.isPiP}},{key:"width",value:function(){return this.element.clientWidth}},{key:"height",value:function(){return this.element.clientHeight}},{key:"observe",value:function(){var e=this;this.isIntersecting=uo(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=function(){var t;null===(t=e.handleResize)||void 0===t||t.call(e)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Qr().observe(this.element),Gr().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}},{key:"stopObserving",value:function(){var e,t;null===(e=Qr())||void 0===e||e.unobserve(this.element),null===(t=Gr())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}]),e}();function uo(e){for(var t=e.offsetTop,n=e.offsetLeft,i=e.offsetWidth,r=e.offsetHeight,a=e.hidden,o=getComputedStyle(e),s=o.opacity,c=o.display;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,n+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&n<window.pageXOffset+window.innerWidth&&t+r>window.pageYOffset&&n+i>window.pageXOffset&&!a&&(""===s||parseFloat(s)>0)&&"none"!==c}var lo=function(t){_inherits(i,t);var n=_createSuper(i);function i(t,r,a){var o;return _classCallCheck(this,i),(o=n.call(this)).metadataMuted=!1,o.handleMuted=function(){o.emit(e.TrackEvent.Muted)},o.handleUnmuted=function(){o.emit(e.TrackEvent.Unmuted)},o.setMaxListeners(100),o.kind=t,o.trackSid=r,o.trackName=a,o.source=$a.Source.Unknown,o}return _createClass(i,[{key:"setTrack",value:function(t){this.track&&(this.track.off(e.TrackEvent.Muted,this.handleMuted),this.track.off(e.TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(e.TrackEvent.Muted,this.handleMuted),t.on(e.TrackEvent.Unmuted,this.handleUnmuted))}},{key:"isMuted",get:function(){return this.metadataMuted}},{key:"isEnabled",get:function(){return!0}},{key:"isSubscribed",get:function(){return void 0!==this.track}},{key:"audioTrack",get:function(){if(this.track instanceof eo||this.track instanceof oo)return this.track}},{key:"videoTrack",get:function(){if(this.track instanceof to||this.track instanceof so)return this.track}},{key:"updateInfo",value:function(e){this.trackSid=e.sid,this.trackName=e.name,this.source=$a.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===$a.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.trackInfo=e,o.trace("update publication info",{info:e})}}]),i}(un.EventEmitter);!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(lo||(lo={}));var po=function(t){_inherits(i,t);var n=_createSuper(i);function i(t,r,a){var o;return _classCallCheck(this,i),(o=n.call(this,t,r.sid,r.name)).track=void 0,o.handleTrackEnded=function(){o.emit(e.TrackEvent.Ended)},o.updateInfo(r),o.setTrack(a),o}return _createClass(i,[{key:"isUpstreamPaused",get:function(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}},{key:"setTrack",value:function(t){this.track&&this.track.off(e.TrackEvent.Ended,this.handleTrackEnded),_get(_getPrototypeOf(i.prototype),"setTrack",this).call(this,t),t&&t.on(e.TrackEvent.Ended,this.handleTrackEnded)}},{key:"isMuted",get:function(){return this.track?this.track.isMuted:_get(_getPrototypeOf(i.prototype),"isMuted",this)}},{key:"audioTrack",get:function(){return _get(_getPrototypeOf(i.prototype),"audioTrack",this)}},{key:"videoTrack",get:function(){return _get(_getPrototypeOf(i.prototype),"videoTrack",this)}},{key:"mute",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",null===(e=this.track)||void 0===e?void 0:e.mute());case 1:case"end":return t.stop()}}),t,this)})))}},{key:"unmute",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",null===(e=this.track)||void 0===e?void 0:e.unmute());case 1:case"end":return t.stop()}}),t,this)})))}},{key:"pauseUpstream",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(e=this.track)||void 0===e?void 0:e.pauseUpstream();case 2:case"end":return t.stop()}}),t,this)})))}},{key:"resumeUpstream",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(e=this.track)||void 0===e?void 0:e.resumeUpstream();case 2:case"end":return t.stop()}}),t,this)})))}}]),i}(lo);e.ConnectionQuality=void 0,function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Unknown="unknown"}(e.ConnectionQuality||(e.ConnectionQuality={}));var fo=function(t){_inherits(i,t);var n=_createSuper(i);function i(t,r,a,o){var s;return _classCallCheck(this,i),(s=n.call(this)).audioLevel=0,s.isSpeaking=!1,s._connectionQuality=e.ConnectionQuality.Unknown,s.setMaxListeners(100),s.sid=t,s.identity=r,s.name=a,s.metadata=o,s.audioTracks=new Map,s.videoTracks=new Map,s.tracks=new Map,s}return _createClass(i,[{key:"getTracks",value:function(){return Array.from(this.tracks.values())}},{key:"getTrack",value:function(e){var t,n=_createForOfIteratorHelper(this.tracks);try{for(n.s();!(t=n.n()).done;){var i=_slicedToArray(t.value,2)[1];if(i.source===e)return i}}catch(e){n.e(e)}finally{n.f()}}},{key:"getTrackByName",value:function(e){var t,n=_createForOfIteratorHelper(this.tracks);try{for(n.s();!(t=n.n()).done;){var i=_slicedToArray(t.value,2)[1];if(i.trackName===e)return i}}catch(e){n.e(e)}finally{n.f()}}},{key:"connectionQuality",get:function(){return this._connectionQuality}},{key:"isCameraEnabled",get:function(){var e,t=this.getTrack($a.Source.Camera);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}},{key:"isMicrophoneEnabled",get:function(){var e,t=this.getTrack($a.Source.Microphone);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}},{key:"isScreenShareEnabled",get:function(){return!!this.getTrack($a.Source.ScreenShare)}},{key:"isLocal",get:function(){return!1}},{key:"joinedAt",get:function(){return this.participantInfo?new Date(1e3*this.participantInfo.joinedAt):new Date}},{key:"updateInfo",value:function(e){return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version||(this.identity=e.identity,this.sid=e.sid,this.setName(e.name),this.setMetadata(e.metadata),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,o.trace("update participant info",{info:e}),0))}},{key:"setMetadata",value:function(t){var n=this.metadata!==t,i=this.metadata;this.metadata=t,n&&this.emit(e.ParticipantEvent.ParticipantMetadataChanged,i)}},{key:"setName",value:function(t){var n=this.name!==t;this.name=t,n&&this.emit(e.ParticipantEvent.ParticipantNameChanged,t)}},{key:"setPermissions",value:function(t){var n,i,r,a,o,s=this,c=this.permissions,u=t.canPublish!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublish)||t.canSubscribe!==(null===(i=this.permissions)||void 0===i?void 0:i.canSubscribe)||t.canPublishData!==(null===(r=this.permissions)||void 0===r?void 0:r.canPublishData)||t.hidden!==(null===(a=this.permissions)||void 0===a?void 0:a.hidden)||t.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((function(e,t){var n;return e!==(null===(n=s.permissions)||void 0===n?void 0:n.canPublishSources[t])}));return this.permissions=t,u&&this.emit(e.ParticipantEvent.ParticipantPermissionsChanged,c),u}},{key:"setIsSpeaking",value:function(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(e.ParticipantEvent.IsSpeakingChanged,t))}},{key:"setConnectionQuality",value:function(t){var n=this._connectionQuality;this._connectionQuality=function(t){switch(t){case He.EXCELLENT:return e.ConnectionQuality.Excellent;case He.GOOD:return e.ConnectionQuality.Good;case He.POOR:return e.ConnectionQuality.Poor;default:return e.ConnectionQuality.Unknown}}(t),n!==this._connectionQuality&&this.emit(e.ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}},{key:"addTrackPublication",value:function(t){var n=this;t.on(e.TrackEvent.Muted,(function(){n.emit(e.ParticipantEvent.TrackMuted,t)})),t.on(e.TrackEvent.Unmuted,(function(){n.emit(e.ParticipantEvent.TrackUnmuted,t)}));var i=t;switch(i.track&&(i.track.sid=t.trackSid),this.tracks.set(t.trackSid,t),t.kind){case $a.Kind.Audio:this.audioTracks.set(t.trackSid,t);break;case $a.Kind.Video:this.videoTracks.set(t.trackSid,t)}}}]),i}(un.EventEmitter),ho=function(t){_inherits(i,t);var n=_createSuper(i);function i(t,r,a){var s;return _classCallCheck(this,i),(s=n.call(this,t,r.sid,r.name)).track=void 0,s.allowed=!0,s.disabled=!1,s.currentVideoQuality=e.VideoQuality.HIGH,s.handleEnded=function(t){s.setTrack(void 0),s.emit(e.TrackEvent.Ended,t)},s.handleVisibilityChange=function(e){o.debug("adaptivestream video visibility ".concat(s.trackSid,", visible=").concat(e),{trackSid:s.trackSid}),s.disabled=!e,s.emitTrackUpdate()},s.handleVideoDimensionsChange=function(e){o.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),{trackSid:s.trackSid}),s.videoDimensions=e,s.emitTrackUpdate()},s.subscribed=a,s.updateInfo(r),s}return _createClass(i,[{key:"setSubscribed",value:function(t){var n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);var r={trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[{participantSid:"",trackSids:[this.trackSid]}]};this.emit(e.TrackEvent.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}},{key:"subscriptionStatus",get:function(){return!1===this.subscribed?lo.SubscriptionStatus.Unsubscribed:_get(_getPrototypeOf(i.prototype),"isSubscribed",this)?lo.SubscriptionStatus.Subscribed:lo.SubscriptionStatus.Desired}},{key:"permissionStatus",get:function(){return this.allowed?lo.PermissionStatus.Allowed:lo.PermissionStatus.NotAllowed}},{key:"isSubscribed",get:function(){return!1!==this.subscribed&&_get(_getPrototypeOf(i.prototype),"isSubscribed",this)}},{key:"isDesired",get:function(){return!1!==this.subscribed}},{key:"isEnabled",get:function(){return!this.disabled}},{key:"setEnabled",value:function(e){this.isManualOperationAllowed()&&this.disabled!==!e&&(this.disabled=!e,this.emitTrackUpdate())}},{key:"setVideoQuality",value:function(e){this.isManualOperationAllowed()&&this.currentVideoQuality!==e&&(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}},{key:"setVideoDimensions",value:function(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.videoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.videoDimensions)||void 0===n?void 0:n.height)===e.height||(this.track instanceof so&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}},{key:"setVideoFPS",value:function(e){this.isManualOperationAllowed()&&this.track instanceof so&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}},{key:"videoQuality",get:function(){return this.currentVideoQuality}},{key:"setTrack",value:function(t){var n=this.subscriptionStatus,r=this.permissionStatus,a=this.track;a!==t&&(a&&(a.off(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),a.off(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),a.off(e.TrackEvent.Ended,this.handleEnded),a.detach(),a.stopMonitor(),this.emit(e.TrackEvent.Unsubscribed,a)),_get(_getPrototypeOf(i.prototype),"setTrack",this).call(this,t),t&&(t.sid=this.trackSid,t.on(e.TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(e.TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(e.TrackEvent.Ended,this.handleEnded),this.emit(e.TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}},{key:"setAllowed",value:function(e){var t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}},{key:"updateInfo",value:function(t){_get(_getPrototypeOf(i.prototype),"updateInfo",this).call(this,t);var n=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):n!==t.muted&&this.emit(t.muted?e.TrackEvent.Muted:e.TrackEvent.Unmuted)}},{key:"emitSubscriptionUpdateIfChanged",value:function(t){var n=this.subscriptionStatus;t!==n&&this.emit(e.TrackEvent.SubscriptionStatusChanged,n,t)}},{key:"emitPermissionUpdateIfChanged",value:function(t){this.permissionStatus!==t&&this.emit(e.TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}},{key:"isManualOperationAllowed",value:function(){return this.kind===$a.Kind.Video&&this.isAdaptiveStream?(o.warn("adaptive stream is enabled, cannot change video track settings",{trackSid:this.trackSid}),!1):!!this.isDesired||(o.warn("cannot update track settings when not subscribed",{trackSid:this.trackSid}),!1)}},{key:"isAdaptiveStream",get:function(){return this.track instanceof so&&this.track.isAdaptiveStream}},{key:"emitTrackUpdate",value:function(){var t=Fi.fromPartial({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=this.videoDimensions.width,t.height=this.videoDimensions.height):void 0!==this.currentVideoQuality?t.quality=this.currentVideoQuality:t.quality=e.VideoQuality.HIGH,this.emit(e.TrackEvent.UpdateSettings,t)}}]),i}(lo),vo=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t,r,a,o){var s;return _classCallCheck(this,i),(s=n.call(this,t,r||"",a,o)).signalClient=e,s.tracks=new Map,s.audioTracks=new Map,s.videoTracks=new Map,s}return _createClass(i,[{key:"addTrackPublication",value:function(t){var n=this;_get(_getPrototypeOf(i.prototype),"addTrackPublication",this).call(this,t),t.on(e.TrackEvent.UpdateSettings,(function(e){o.debug("send update settings",e),n.signalClient.sendUpdateTrackSettings(e)})),t.on(e.TrackEvent.UpdateSubscription,(function(e){e.participantTracks.forEach((function(e){e.participantSid=n.sid})),n.signalClient.sendUpdateSubscription(e)})),t.on(e.TrackEvent.SubscriptionPermissionChanged,(function(i){n.emit(e.ParticipantEvent.TrackSubscriptionPermissionChanged,t,i)})),t.on(e.TrackEvent.SubscriptionStatusChanged,(function(i){n.emit(e.ParticipantEvent.TrackSubscriptionStatusChanged,t,i)})),t.on(e.TrackEvent.Subscribed,(function(i){n.emit(e.ParticipantEvent.TrackSubscribed,i,t)})),t.on(e.TrackEvent.Unsubscribed,(function(i){n.emit(e.ParticipantEvent.TrackUnsubscribed,i,t)}))}},{key:"getTrack",value:function(e){var t=_get(_getPrototypeOf(i.prototype),"getTrack",this).call(this,e);if(t)return t}},{key:"getTrackByName",value:function(e){var t=_get(_getPrototypeOf(i.prototype),"getTrackByName",this).call(this,e);if(t)return t}},{key:"setVolume",value:function(e){this.volume=e;var t=this.getTrack($a.Source.Microphone);t&&t.track&&t.track.setVolume(e)}},{key:"getVolume",value:function(){var e=this.getTrack($a.Source.Microphone);return e&&e.track?e.track.getVolume():this.volume}},{key:"addSubscribedMediaTrack",value:function(t,n,i,r,a,s){var c,u=this,d=this.getTrackPublication(n);return d||n.startsWith("TR")||this.tracks.forEach((function(e){d||t.kind!==e.kind.toString()||(d=e)})),d?"ended"===t.readyState?(o.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",{participant:this.sid,trackSid:n}),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):((c="video"===t.kind?new so(t,n,r,a):new oo(t,n,r,this.audioContext,this.audioOutput)).source=d.source,c.isMuted=d.isMuted,c.setMediaStream(i),c.start(),d.setTrack(c),void 0!==this.volume&&c instanceof oo&&c.source===$a.Source.Microphone&&c.setVolume(this.volume),d):0===s?(o.error("could not find published track",{participant:this.sid,trackSid:n}),void this.emit(e.ParticipantEvent.TrackSubscriptionFailed,n)):(void 0===s&&(s=20),void setTimeout((function(){u.addSubscribedMediaTrack(t,n,i,r,a,s-1)}),150))}},{key:"hasMetadata",get:function(){return!!this.participantInfo}},{key:"getTrackPublication",value:function(e){return this.tracks.get(e)}},{key:"updateInfo",value:function(t){var n=this;if(!_get(_getPrototypeOf(i.prototype),"updateInfo",this).call(this,t))return!1;var r=new Map,a=new Map;return t.tracks.forEach((function(e){var i,s=n.getTrackPublication(e.sid);if(s)s.updateInfo(e);else{var c=$a.kindFromProto(e.type);if(!c)return;(s=new ho(c,e,null===(i=n.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe)).updateInfo(e),a.set(e.sid,s);var u=Array.from(n.tracks.values()).find((function(e){return e.source===(null==s?void 0:s.source)}));u&&s.source!==$a.Source.Unknown&&o.debug("received a second track publication for ".concat(n.identity," with the same source: ").concat(s.source),{oldTrack:u,newTrack:s,participant:n,participantInfo:t}),n.addTrackPublication(s)}r.set(e.sid,s)})),this.tracks.forEach((function(e){r.has(e.trackSid)||(o.trace("detected removed track on remote participant, unpublishing",{publication:e,participantSid:n.sid}),n.unpublishTrack(e.trackSid,!0))})),a.forEach((function(t){n.emit(e.ParticipantEvent.TrackPublished,t)})),!0}},{key:"unpublishTrack",value:function(t,n){var i=this.tracks.get(t);if(i){switch(this.tracks.delete(t),i.kind){case $a.Kind.Audio:this.audioTracks.delete(t);break;case $a.Kind.Video:this.videoTracks.delete(t)}var r=i.track;r&&(r.stop(),i.setTrack(void 0)),n&&this.emit(e.ParticipantEvent.TrackUnpublished,i)}}},{key:"setAudioContext",value:function(e){this.audioContext=e,this.audioTracks.forEach((function(t){return t.track instanceof oo&&t.track.setAudioContext(e)}))}},{key:"setAudioOutput",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.audioOutput=e,n=[],this.audioTracks.forEach((function(t){var i;t.track instanceof oo&&n.push(t.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))})),t.next=5,Promise.all(n);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return o.trace("participant event",{participant:this.sid,event:e,args:r}),(t=_get(_getPrototypeOf(i.prototype),"emit",this)).call.apply(t,[this,e].concat(r))}}],[{key:"fromParticipantInfo",value:function(e,t){return new i(e,t.sid,t.identity,t.name,t.metadata)}}]),i}(fo);function mo(e,t){switch(e.kind){case"audio":return new eo(e,t,!1);case"video":return new to(e,t,!1);default:throw new pr("unsupported track type: ".concat(e.kind))}}var go=Object.values(Da),bo=Object.values(Aa),ko=Object.values(Ua),yo=[Da.h180,Da.h360],So=[Aa.h180,Aa.h360],wo=function(e){return[{scaleResolutionDownBy:2,fps:3}].map((function(t){var n;return new Ta(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(n=e.encoding.maxFramerate)&&void 0!==n?n:30)/t.fps)))),t.fps,e.encoding.priority)}))},Co=["q","h","f"];function Ro(e,t,n,i){var r,a,s=null==i?void 0:i.videoEncoding;e&&(s=null==i?void 0:i.screenShareEncoding);var c=null==i?void 0:i.simulcast,u=null==i?void 0:i.scalabilityMode,d=null==i?void 0:i.videoCodec;if(!s&&!c&&!u||!t||!n)return[{}];s||(s=function(e,t,n,i){for(var r=function(e,t,n){if(e)return ko;var i=t>n?t/n:n/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?go:bo}(e,t,n),a=r[0].encoding,o=Math.max(t,n),s=0;s<r.length;s+=1){var c=r[s];if(a=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":(a=Object.assign({},a)).maxBitrate=.7*a.maxBitrate;break;case"vp9":(a=Object.assign({},a)).maxBitrate=.85*a.maxBitrate}return a}(e,t,n,d),o.debug("using video encoding",s));var l=new Ta(t,n,s.maxBitrate,s.maxFramerate);if(u&&Or(d)){o.debug("using svc with scalabilityMode ".concat(u));var p=[];if("L3T3"===u){for(var f=0;f<3;f+=1)p.push({rid:Co[2-f],scaleResolutionDownBy:Math.pow(2,f),maxBitrate:s.maxBitrate/Math.pow(3,f),maxFramerate:l.encoding.maxFramerate,scalabilityMode:"L3T3"});return o.debug("encodings",p),p}throw new Error("unsupported scalabilityMode: ".concat(u))}if(!c)return[s];var h,v;if((v=e?null!==(r=_o(null==i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:Po(e,l):null!==(a=_o(null==i?void 0:i.videoSimulcastLayers))&&void 0!==a?a:Po(e,l)).length>0){var m=v[0];v.length>1&&(h=_slicedToArray(v,2)[1]);var g=Math.max(t,n);if(g>=960&&h)return Eo(t,n,[m,h,l]);if(g>=480)return Eo(t,n,[m,l])}return Eo(t,n,[l])}function To(e,t,n){var i,r,a,s;if(n.backupCodec&&n.backupCodec.codec!==n.videoCodec){t!==n.backupCodec.codec&&o.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;var c=e.mediaStreamTrack.getSettings(),u=null!==(i=c.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,d=null!==(a=c.height)&&void 0!==a?a:null===(s=e.dimensions)||void 0===s?void 0:s.height;return Ro(e.source===$a.Source.ScreenShare,u,d,n)}}function Po(e,t){if(e)return wo(t);var n=t.width,i=t.height,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?yo:So}function Eo(e,t,n){var i=[];return n.forEach((function(n,r){if(!(r>=Co.length)){var a=Math.min(e,t),o={rid:Co[r],scaleResolutionDownBy:Math.max(1,a/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(o.maxFramerate=n.encoding.maxFramerate),n.encoding.priority&&(o.priority=n.encoding.priority,o.networkPriority=n.encoding.priority),i.push(o)}})),i}function _o(e){if(e)return e.sort((function(e,t){var n=e.encoding,i=t.encoding;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0}))}var xo,Oo=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t,r,a){var s;return _classCallCheck(this,i),(s=n.call(this,e,t)).pendingPublishing=new Set,s.pendingPublishPromises=new Map,s.participantTrackPermissions=[],s.allParticipantsAllowedToSubscribe=!0,s.handleReconnecting=function(){s.reconnectFuture||(s.reconnectFuture=new Yr)},s.handleReconnected=function(){var e,t;null===(t=null===(e=s.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),s.reconnectFuture=void 0,s.updateTrackSubscriptionPermissions()},s.handleDisconnected=function(){var e,t;null===(t=null===(e=s.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during publishing attempt"),s.reconnectFuture=void 0},s.updateTrackSubscriptionPermissions=function(){o.debug("updating track subscription permissions",{allParticipantsAllowed:s.allParticipantsAllowedToSubscribe,participantTrackPermissions:s.participantTrackPermissions}),s.engine.client.sendUpdateSubscriptionPermissions(s.allParticipantsAllowedToSubscribe,s.participantTrackPermissions.map((function(e){return function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return{participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]}}(e)})))},s.onTrackUnmuted=function(e){s.onTrackMuted(e,e.isUpstreamPaused)},s.onTrackMuted=function(e,t){void 0===t&&(t=!0),e.sid?s.engine.updateMuteStatus(e.sid,t):o.error("could not update mute status for unpublished track",e)},s.onTrackUpstreamPaused=function(e){o.debug("upstream paused"),s.onTrackMuted(e,!0)},s.onTrackUpstreamResumed=function(e){o.debug("upstream resumed"),s.onTrackMuted(e,e.isMuted)},s.handleSubscribedQualityUpdate=function(e){return qt(_assertThisInitialized(s),void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i,r,a,s,c,u,d,l,p,f,h;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(s=this.roomOptions)||void 0===s?void 0:s.dynacast){t.next=2;break}return t.abrupt("return");case 2:if(!(u=this.videoTracks.get(e.trackSid))){t.next=52;break}if(!(e.subscribedCodecs.length>0)){t.next=46;break}if(u.videoTrack){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,u.videoTrack.setPublishingCodecs(e.subscribedCodecs);case 9:d=t.sent,t.prev=10,p=!0,f=Wt(d);case 12:return t.next=14,f.next();case 14:if(n=(l=t.sent).done){t.next=28;break}if(a=l.value,p=!1,t.prev=16,h=a,t.t0=Ea(h),!t.t0){t.next=23;break}return o.debug("publish ".concat(h," for ").concat(u.videoTrack.sid)),t.next=23,this.publishAdditionalCodecForTrack(u.videoTrack,h,u.options);case 23:return t.prev=23,p=!0,t.finish(23);case 26:t.next=12;break;case 28:t.next=33;break;case 30:t.prev=30,t.t1=t.catch(10),i={error:t.t1};case 33:if(t.prev=33,t.prev=34,t.t2=p||n||!(r=f.return),t.t2){t.next=39;break}return t.next=39,r.call(f);case 39:if(t.prev=39,!i){t.next=42;break}throw i.error;case 42:return t.finish(39);case 43:return t.finish(33);case 44:t.next=50;break;case 46:if(t.t3=e.subscribedQualities.length>0,!t.t3){t.next=50;break}return t.next=50,null===(c=u.videoTrack)||void 0===c?void 0:c.setPublishingLayers(e.subscribedQualities);case 50:t.next=53;break;case 52:o.warn("received subscribed quality update for unknown track",{method:"handleSubscribedQualityUpdate",sid:e.trackSid});case 53:case"end":return t.stop()}}),t,this,[[10,30,33,44],[16,,23,26],[34,,39,43]])})))},s.handleLocalTrackUnpublished=function(e){var t=s.tracks.get(e.trackSid);t?s.unpublishTrack(t.track):o.warn("received unpublished event for unknown track",{method:"handleLocalTrackUnpublished",trackSid:e.trackSid})},s.handleTrackEnded=function(e){return qt(_assertThisInitialized(s),void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.source!==$a.Source.ScreenShare&&e.source!==$a.Source.ScreenShareAudio){t.next=4;break}o.debug("unpublishing local track due to TrackEnded",{track:e.sid}),this.unpublishTrack(e),t.next=34;break;case 4:if(!e.isUserProvided){t.next=9;break}return t.next=7,e.mute();case 7:t.next=34;break;case 9:if(!(e instanceof eo||e instanceof to)){t.next=34;break}if(t.prev=10,!Lr()){t.next=22;break}return t.prev=12,t.next=15,null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===$a.Source.Camera?"camera":"microphone"});case 15:if(!(n=t.sent)||"denied"!==n.state){t.next=18;break}throw o.warn("user has revoked access to ".concat(e.source)),n.onchange=function(){"denied"!==n.state&&(e.isMuted||e.restartTrack(),n.onchange=null)},new Error("GetUserMedia Permission denied");case 18:t.next=22;break;case 20:t.prev=20,t.t0=t.catch(12);case 22:if(t.t1=e.isMuted,t.t1){t.next=27;break}return o.debug("track ended, attempting to use a different device"),t.next=27,e.restartTrack();case 27:t.next=34;break;case 29:return t.prev=29,t.t2=t.catch(10),o.warn("could not restart track, muting instead"),t.next=34,e.mute();case 34:case"end":return t.stop()}}),t,this,[[10,29],[12,20]])})))},s.audioTracks=new Map,s.videoTracks=new Map,s.tracks=new Map,s.engine=r,s.roomOptions=a,s.setupEngine(r),s}return _createClass(i,[{key:"lastCameraError",get:function(){return this.cameraError}},{key:"lastMicrophoneError",get:function(){return this.microphoneError}},{key:"getTrack",value:function(e){var t=_get(_getPrototypeOf(i.prototype),"getTrack",this).call(this,e);if(t)return t}},{key:"getTrackByName",value:function(e){var t=_get(_getPrototypeOf(i.prototype),"getTrackByName",this).call(this,e);if(t)return t}},{key:"setupEngine",value:function(t){var n=this;this.engine=t,this.engine.client.onRemoteMuteChanged=function(e,t){var i=n.tracks.get(e);i&&i.track&&(t?i.mute():i.unmute())},this.engine.client.onSubscribedQualityUpdate=this.handleSubscribedQualityUpdate,this.engine.client.onLocalTrackUnpublished=this.handleLocalTrackUnpublished,this.engine.on(e.EngineEvent.Connected,this.handleReconnected).on(e.EngineEvent.Restarted,this.handleReconnected).on(e.EngineEvent.Resumed,this.handleReconnected).on(e.EngineEvent.Restarting,this.handleReconnecting).on(e.EngineEvent.Resuming,this.handleReconnecting).on(e.EngineEvent.Disconnected,this.handleDisconnected)}},{key:"setMetadata",value:function(e){var t;_get(_getPrototypeOf(i.prototype),"setMetadata",this).call(this,e),this.engine.client.sendUpdateLocalMetadata(e,null!==(t=this.name)&&void 0!==t?t:"")}},{key:"setName",value:function(e){var t;_get(_getPrototypeOf(i.prototype),"setName",this).call(this,e),this.engine.client.sendUpdateLocalMetadata(null!==(t=this.metadata)&&void 0!==t?t:"",e)}},{key:"setCameraEnabled",value:function(e,t,n){return this.setTrackEnabled($a.Source.Camera,e,t,n)}},{key:"setMicrophoneEnabled",value:function(e,t,n){return this.setTrackEnabled($a.Source.Microphone,e,t,n)}},{key:"setScreenShareEnabled",value:function(e,t,n){return this.setTrackEnabled($a.Source.ScreenShare,e,t,n)}},{key:"setTrackEnabled",value:function(t,n,i,r){var a,s;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function c(){var u,d,l,p,f,h,v,m,g;return _regeneratorRuntime().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(o.debug("setTrackEnabled",{source:t,enabled:n}),u=this.getTrack(t),!n){c.next=46;break}if(!u){c.next=8;break}return c.next=6,u.unmute();case 6:c.next=44;break;case 8:if(!this.pendingPublishing.has(t)){c.next=10;break}return c.abrupt("return",void o.info("skipping duplicate published source",{source:t}));case 10:this.pendingPublishing.add(t),c.prev=11,c.t0=t,c.next=c.t0===$a.Source.Camera?15:c.t0===$a.Source.Microphone?19:c.t0===$a.Source.ScreenShare?23:27;break;case 15:return c.next=17,this.createTracks({video:null===(a=i)||void 0===a||a});case 17:case 21:case 25:return d=c.sent,c.abrupt("break",28);case 19:return c.next=21,this.createTracks({audio:null===(s=i)||void 0===s||s});case 23:return c.next=25,this.createScreenTracks(Object.assign({},i));case 27:throw new pr(t);case 28:l=[],p=_createForOfIteratorHelper(d);try{for(p.s();!(f=p.n()).done;)h=f.value,o.info("publishing track",{localTrack:h}),l.push(this.publishTrack(h,r))}catch(e){p.e(e)}finally{p.f()}return c.next=33,Promise.all(l);case 33:v=c.sent,m=_slicedToArray(v,1),u=m[0],c.next=41;break;case 38:throw c.prev=38,c.t1=c.catch(11),c.t1 instanceof Error&&!(c.t1 instanceof pr)&&this.emit(e.ParticipantEvent.MediaDevicesError,c.t1),c.t1;case 41:return c.prev=41,this.pendingPublishing.delete(t),c.finish(41);case 44:c.next=57;break;case 46:if(!u||!u.track){c.next=57;break}if(t!==$a.Source.ScreenShare){c.next=55;break}return c.next=50,this.unpublishTrack(u.track);case 50:u=c.sent,(g=this.getTrack($a.Source.ScreenShareAudio))&&g.track&&this.unpublishTrack(g.track),c.next=57;break;case 55:return c.next=57,u.mute();case 57:return c.abrupt("return",u);case 58:case"end":return c.stop()}}),c,this,[[11,38,41,44]])})))}},{key:"enableCameraAndMicrophone",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pendingPublishing.has($a.Source.Camera)||this.pendingPublishing.has($a.Source.Microphone)){e.next=11;break}return this.pendingPublishing.add($a.Source.Camera),this.pendingPublishing.add($a.Source.Microphone),e.prev=2,e.next=5,this.createTracks({audio:!0,video:!0});case 5:return t=e.sent,e.next=8,Promise.all(t.map((function(e){return n.publishTrack(e)})));case 8:return e.prev=8,this.pendingPublishing.delete($a.Source.Camera),this.pendingPublishing.delete($a.Source.Microphone),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[2,,8,11]])})))}},{key:"createTracks",value:function(e){var t,n;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var r,a;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return r=Cr(Sr(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults)),i.prev=1,i.next=4,navigator.mediaDevices.getUserMedia(r);case 4:a=i.sent,i.next=10;break;case 7:throw i.prev=7,i.t0=i.catch(1),i.t0 instanceof Error&&(r.audio&&(this.microphoneError=i.t0),r.video&&(this.cameraError=i.t0)),i.t0;case 10:return i.abrupt("return",(r.audio&&(this.microphoneError=void 0),r.video&&(this.cameraError=void 0),a.getTracks().map((function(t){var n,i="audio"===t.kind;i?e.audio:e.video;var o=i?r.audio:r.video;"boolean"!=typeof o&&(n=o);var s=mo(t,n);return s.kind===$a.Kind.Video?s.source=$a.Source.Camera:s.kind===$a.Kind.Audio&&(s.source=$a.Source.Microphone),s.mediaStream=a,s}))));case 11:case"end":return i.stop()}}),i,this,[[1,7]])})))}},{key:"createScreenTracks",value:function(e){var t;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,o,s,c;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===e&&(e={}),void 0===e.resolution&&(e.resolution=Ua.h1080fps15.resolution),i=!0,e.resolution&&(i=Ar()?{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}:{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate}),void 0!==navigator.mediaDevices.getDisplayMedia){n.next=4;break}throw new lr("getDisplayMedia not supported");case 4:return n.next=6,navigator.mediaDevices.getDisplayMedia({audio:null!==(t=e.audio)&&void 0!==t&&t,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio});case 6:if(r=n.sent,0!==(a=r.getVideoTracks()).length){n.next=10;break}throw new pr("no video track found");case 10:return(o=new to(a[0],void 0,!1)).source=$a.Source.ScreenShare,s=[o],r.getAudioTracks().length>0&&((c=new eo(r.getAudioTracks()[0],void 0,!1)).source=$a.Source.ScreenShareAudio,s.push(c)),n.abrupt("return",s);case 15:case"end":return n.stop()}}),n)})))}},{key:"publishTrack",value:function(e,t){var n,i,r;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var s,c,u,d;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,null===(n=this.reconnectFuture)||void 0===n?void 0:n.promise;case 2:if(a.t0=e instanceof Xa&&this.pendingPublishPromises.has(e),!a.t0){a.next=6;break}return a.next=6,this.pendingPublishPromises.get(e);case 6:if(!(e instanceof MediaStreamTrack)){a.next=15;break}a.t1=e.kind,a.next="audio"===a.t1?10:"video"===a.t1?12:14;break;case 10:return e=new eo(e,void 0,!0),a.abrupt("break",15);case 12:return e=new to(e,void 0,!0),a.abrupt("break",15);case 14:throw new pr("unsupported MediaStreamTrack kind ".concat(e.kind));case 15:if(this.tracks.forEach((function(t){t.track&&t.track===e&&(s=t)})),!s){a.next=17;break}return a.abrupt("return",(o.warn("track has already been published, skipping"),s));case 17:return(c=(null==t?void 0:t.forceStereo)||"channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount)&&(t||(t={}),void 0===t.dtx&&o.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work."),void 0===t.red&&o.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(i=t.dtx)&&void 0!==i||(t.dtx=!1),null!==(r=t.red)&&void 0!==r||(t.red=!1)),(u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),t)).source&&(e.source=u.source),d=this.publish(e,u,t,c),this.pendingPublishPromises.set(e,d),a.prev=23,a.next=26,d;case 26:return a.abrupt("return",a.sent);case 29:throw a.prev=29,a.t2=a.catch(23),a.t2;case 32:return a.prev=32,this.pendingPublishPromises.delete(e),a.finish(32);case 35:case"end":return a.stop()}}),a,this,[[23,29,32,35]])})))}},{key:"publish",value:function(t,n,i,r){var a,s,c,u,d,l,p,f,h,v;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function m(){var g,b,k,y,S,w,C,R,T,P,E;return _regeneratorRuntime().wrap((function(m){for(;;)switch(m.prev=m.next){case 0:if(g=Array.from(this.tracks.values()).find((function(e){return t instanceof Xa&&e.source===t.source})),!g||t.source===$a.Source.Unknown){m.next=9;break}throw m.prev=2,Error("publishing a second track with the same source: ".concat(t.source));case 6:m.prev=6,m.t0=m.catch(2),m.t0 instanceof Error&&o.warn(m.t0.message,{oldTrack:g,newTrack:t,trace:m.t0.stack});case 9:if(n.stopMicTrackOnMute&&t instanceof eo&&(t.stopOnMute=!0),t.source===$a.Source.ScreenShare&&Dr()&&(n.simulcast=!1),"av1"!==n.videoCodec||xr()||(n.videoCodec=void 0),"vp9"!==n.videoCodec||function(){var e=RTCRtpReceiver.getCapabilities("video"),t=!1;if(e){var n,i=_createForOfIteratorHelper(e.codecs);try{for(i.s();!(n=i.n()).done;){if("video/VP9"===n.value.mimeType){t=!0;break}}}catch(e){i.e(e)}finally{i.f()}}return t}()||(n.videoCodec=void 0),t.on(e.TrackEvent.Muted,this.onTrackMuted),t.on(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.on(e.TrackEvent.Ended,this.handleTrackEnded),t.on(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),b=_i.fromPartial({cid:t.mediaStreamTrack.id,name:null==i?void 0:i.name,type:$a.kindToProto(t.kind),muted:t.isMuted,source:$a.sourceToProto(t.source),disableDtx:!(null===(a=n.dtx)||void 0===a||a),stereo:r,disableRed:!(null===(s=n.red)||void 0===s||s)}),t.kind!==$a.Kind.Video){m.next=26;break}return S={width:0,height:0},m.prev=13,m.next=16,t.waitForDimensions();case 16:S=m.sent,m.next=22;break;case 19:m.prev=19,m.t1=m.catch(13),o.error("could not determine track dimensions");case 22:b.width=S.width,b.height=S.height,t instanceof to&&(Or(n.videoCodec)&&(n.scalabilityMode=null!==(c=n.scalabilityMode)&&void 0!==c?c:"L3T3"),n.videoCodec&&n.backupCodec&&n.videoCodec!==n.backupCodec.codec)&&((w=Object.assign({},n)).simulcast=!0,y=To(t,n.backupCodec.codec,w),b.simulcastCodecs=[{codec:n.videoCodec,cid:t.mediaStreamTrack.id,enableSimulcastLayers:!0},{codec:n.backupCodec.codec,cid:"",enableSimulcastLayers:!0}]),k=Ro(t.source===$a.Source.ScreenShare,S.width,S.height,n),b.layers=ro(b.width,b.height,null!=y?y:k),m.next=27;break;case 26:t.kind===$a.Kind.Audio&&(k=[{maxBitrate:null!==(d=null===(u=n.audioPreset)||void 0===u?void 0:u.maxBitrate)&&void 0!==d?d:n.audioBitrate,priority:null!==(p=null===(l=n.audioPreset)||void 0===l?void 0:l.priority)&&void 0!==p?p:"high",networkPriority:null!==(h=null===(f=n.audioPreset)||void 0===f?void 0:f.priority)&&void 0!==h?h:"high"}]);case 27:if(this.engine&&!this.engine.isClosed){m.next=29;break}throw new hr("cannot publish track when not connected");case 29:return m.next=31,this.engine.addTrack(b);case 31:if(C=m.sent,R=!1,T=!1,C.codecs.forEach((function(e){_a(e.mimeType,n.videoCodec)?R=!0:n.backupCodec&&_a(e.mimeType,n.backupCodec.codec)&&(T=!0)})),!(b.simulcastCodecs.length>0)){m.next=37;break}if(R||T){m.next=36;break}throw Error("cannot publish track, codec not supported by server");case 36:!R&&n.backupCodec&&(P=n.backupCodec,n=Object.assign({},n),o.debug("primary codec ".concat(n.videoCodec," not supported, fallback to ").concat(P.codec)),n.videoCodec=P.codec,n.videoEncoding=P.encoding,k=y);case 37:if((E=new po(t.kind,C,t)).options=n,t.sid=C.sid,this.engine.publisher){m.next=40;break}throw new hr("publisher is closed");case 40:return o.debug("publishing ".concat(t.kind," with encodings"),{encodings:k,trackInfo:C}),m.next=43,this.engine.createSender(t,n,k);case 43:return t.sender=m.sent,t.codec&&Or(t.codec)&&k&&(null===(v=k[0])||void 0===v?void 0:v.maxBitrate)&&this.engine.publisher.setTrackCodecBitrate(b.cid,t.codec,k[0].maxBitrate/1e3),this.engine.negotiate(),t instanceof to?t.startMonitor(this.engine.client):t instanceof eo&&t.startMonitor(),this.addTrackPublication(E),this.emit(e.ParticipantEvent.LocalTrackPublished,E),m.abrupt("return",E);case 50:case"end":return m.stop()}}),m,this,[[2,6],[13,19]])})))}},{key:"isLocal",get:function(){return!0}},{key:"publishAdditionalCodecForTrack",value:function(e,t,n){var i;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var a,s,c,u,d,l;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.tracks.forEach((function(t){t.track&&t.track===e&&(a=t)})),a){r.next=2;break}throw new pr("track is not published");case 2:if(e instanceof to){r.next=4;break}throw new pr("track is not a video track");case 4:if(s=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),c=To(e,t,s)){r.next=7;break}return r.abrupt("return",void o.info("backup codec has been disabled, ignoring request to add additional codec for track"));case 7:if(u=e.addSimulcastTrack(t,c),(d=_i.fromPartial({cid:u.mediaStreamTrack.id,type:$a.kindToProto(e.kind),muted:e.isMuted,source:$a.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:s.videoCodec,cid:u.mediaStreamTrack.id,enableSimulcastLayers:s.simulcast}]})).layers=ro(d.width,d.height,c),this.engine&&!this.engine.isClosed){r.next=10;break}throw new hr("cannot publish track when not connected");case 10:return r.next=12,this.engine.addTrack(d);case 12:return l=r.sent,r.next=15,this.engine.createSimulcastSender(e,u,s,c);case 15:this.engine.negotiate(),o.debug("published ".concat(t," for track ").concat(e.sid),{encodings:c,trackInfo:l});case 17:case"end":return r.stop()}}),r,this)})))}},{key:"unpublishTrack",value:function(t,n){var i,r;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var s,c,u,d,l,p,f;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s=this.getPublicationForTrack(t),o.debug("unpublishing track",{track:t,method:"unpublishTrack"}),s&&s.track){a.next=3;break}return a.abrupt("return",void o.warn("track was not unpublished because no publication was found",{track:t,method:"unpublishTrack"}));case 3:if((t=s.track).off(e.TrackEvent.Muted,this.onTrackMuted),t.off(e.TrackEvent.Unmuted,this.onTrackUnmuted),t.off(e.TrackEvent.Ended,this.handleTrackEnded),t.off(e.TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(e.TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),void 0===n&&(n=null===(r=null===(i=this.roomOptions)||void 0===i?void 0:i.stopLocalTrackOnUnpublish)||void 0===r||r),n&&t.stop(),c=!1,u=t.sender,t.sender=void 0,this.engine.publisher&&"closed"!==this.engine.publisher.pc.connectionState&&u)try{if(this.engine.removeTrack(u)&&(c=!0),t instanceof to){d=_createForOfIteratorHelper(t.simulcastCodecs);try{for(d.s();!(l=d.n()).done;)p=_slicedToArray(l.value,2),(f=p[1]).sender&&(this.engine.removeTrack(f.sender)&&(c=!0),f.sender=void 0)}catch(e){d.e(e)}finally{d.f()}t.simulcastCodecs.clear()}}catch(e){o.warn("failed to unpublish track",{error:e,method:"unpublishTrack"})}a.t0=(this.tracks.delete(s.trackSid),s.kind),a.next=a.t0===$a.Kind.Audio?10:a.t0===$a.Kind.Video?12:13;break;case 10:return this.audioTracks.delete(s.trackSid),a.abrupt("break",13);case 12:this.videoTracks.delete(s.trackSid);case 13:if(this.emit(e.ParticipantEvent.LocalTrackUnpublished,s),s.setTrack(void 0),a.t1=c,!a.t1){a.next=19;break}return a.next=19,this.engine.negotiate();case 19:return a.abrupt("return",s);case 20:case"end":return a.stop()}}),a,this)})))}},{key:"unpublishTracks",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.map((function(e){return n.unpublishTrack(e)})));case 2:return t.abrupt("return",t.sent.filter((function(e){return e instanceof po})));case 3:case"end":return t.stop()}}),t)})))}},{key:"republishAllTracks",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],this.tracks.forEach((function(t){t.track&&(e&&(t.options=Object.assign(Object.assign({},t.options),e)),n.push(t))})),t.next=4,Promise.all(n.map((function(e){return qt(i,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.track,t.next=3,this.unpublishTrack(n,!1);case 3:return t.next=5,this.publishTrack(n,e.options);case 5:case"end":return t.stop()}}),t,this)})))})));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"publishData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var r,a,o,s;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return r=Array.isArray(n)?n:null==n?void 0:n.destination,a=[],o=Array.isArray(n)?void 0:n.topic,void 0!==r&&r.forEach((function(e){e instanceof vo?a.push(e.sid):a.push(e)})),s={kind:t,value:{$case:"user",user:{participantSid:this.sid,payload:e,destinationSids:a,topic:o}}},i.next=5,this.engine.sendDataPacket(s,t);case 5:case"end":return i.stop()}}),i,this)})))}},{key:"setTrackSubscriptionPermissions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isConnected&&this.updateTrackSubscriptionPermissions()}},{key:"updateInfo",value:function(e){var t=this;return e.sid===this.sid&&!!_get(_getPrototypeOf(i.prototype),"updateInfo",this).call(this,e)&&(e.tracks.forEach((function(e){var n,i,r=t.tracks.get(e.sid);if(r){var a=r.isMuted||null!==(i=null===(n=r.track)||void 0===n?void 0:n.isUpstreamPaused)&&void 0!==i&&i;a!==e.muted&&(o.debug("updating server mute state after reconcile",{sid:e.sid,muted:a}),t.engine.client.sendMuteTrack(e.sid,a))}})),!0)}},{key:"getPublicationForTrack",value:function(e){var t;return this.tracks.forEach((function(n){var i=n.track;i&&(e instanceof MediaStreamTrack?(i instanceof eo||i instanceof to)&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))})),t}},{key:"publishedTracksInfo",value:function(){var e=[];return this.tracks.forEach((function(t){void 0!==t.track&&e.push({cid:t.track.mediaStreamID,track:t.trackInfo})})),e}},{key:"dataChannelsInfo",value:function(){var t=[],n=function(e,n){void 0!==(null==e?void 0:e.id)&&null!==e.id&&t.push({label:e.label,id:e.id,target:n})};return n(this.engine.dataChannelForKind(e.DataPacket_Kind.LOSSY),mi.PUBLISHER),n(this.engine.dataChannelForKind(e.DataPacket_Kind.RELIABLE),mi.PUBLISHER),n(this.engine.dataChannelForKind(e.DataPacket_Kind.LOSSY,!0),mi.SUBSCRIBER),n(this.engine.dataChannelForKind(e.DataPacket_Kind.RELIABLE,!0),mi.SUBSCRIBER),t}}]),i}(fo);e.ConnectionState=void 0,(xo=e.ConnectionState||(e.ConnectionState={})).Disconnected="disconnected",xo.Connecting="connecting",xo.Connected="connected",xo.Reconnecting="reconnecting";var No,Io=e.ConnectionState,Do=function(t){_inherits(i,t);var n=_createSuper(i);function i(t){var r,a;return _classCallCheck(this,i),r=n.call(this),a=_assertThisInitialized(r),r.state=e.ConnectionState.Disconnected,r.activeSpeakers=[],r.audioEnabled=!0,r.connect=function(t,n,i){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function r(){var a,s,c,u=this;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.disconnectLock.lock();case 2:if(a=r.sent,this.state!==e.ConnectionState.Connected){r.next=5;break}return r.abrupt("return",(o.info("already connected to room ".concat(this.name)),a(),Promise.resolve()));case 5:if(!this.connectFuture){r.next=7;break}return r.abrupt("return",(a(),this.connectFuture.promise));case 7:return this.setAndEmitConnectionState(e.ConnectionState.Connecting),s=new Ra(t,n),c=function e(r,c,d){return qt(u,void 0,void 0,_regeneratorRuntime().mark((function u(){var l,p;return _regeneratorRuntime().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return this.abortController&&this.abortController.abort(),this.abortController=new AbortController,null==a||a(),u.prev=1,u.next=4,this.attemptConnection(null!=d?d:t,n,i,this.abortController);case 4:this.abortController=void 0,r(),u.next=32;break;case 8:if(u.prev=8,u.t0=u.catch(1),!(Fr(new URL(t))&&u.t0 instanceof dr&&3!==u.t0.reason)){u.next=31;break}return p=null,u.prev=12,u.next=15,s.getNextBestRegionUrl(null===(l=this.abortController)||void 0===l?void 0:l.signal);case 15:p=u.sent,u.next=22;break;case 18:if(u.prev=18,u.t1=u.catch(12),!(u.t1 instanceof dr)||401!==u.t1.status&&3!==u.t1.reason){u.next=22;break}return u.abrupt("return",void c(u.t1));case 22:if(!p){u.next=28;break}return o.debug("initial connection failed, retrying with another region"),u.next=26,e(r,c,p);case 26:u.next=29;break;case 28:c(u.t0);case 29:u.next=32;break;case 31:c(u.t0);case 32:case"end":return u.stop()}}),u,this,[[1,8],[12,18]])})))},r.abrupt("return",(this.connectFuture=new Yr(c,(function(){u.clearConnectionFutures()})),this.connectFuture.promise));case 10:case"end":return r.stop()}}),r,this)})))},r.connectSignal=function(e,t,n,i,a,s){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function r(){var c,u;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.join(e,t,{autoSubscribe:i.autoSubscribe,publishOnly:i.publishOnly,adaptiveStream:"object"==_typeof(a.adaptiveStream)||a.adaptiveStream,maxRetries:i.maxRetries},s.signal);case 2:if(c=r.sent,(u=c.serverInfo)||(u={version:c.serverVersion,region:c.serverRegion}),o.debug("connected to Livekit Server ".concat(Object.entries(u).map((function(e){var t=_slicedToArray(e,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)})).join(", "))),c.serverVersion){r.next=6;break}throw new fr("unknown server version");case 6:return r.abrupt("return",("0.15.1"===c.serverVersion&&this.options.dynacast&&(o.debug("disabling dynacast due to server version"),a.dynacast=!1),c));case 7:case"end":return r.stop()}}),r,this)})))},r.applyJoinResponse=function(e){var t=e.participant;r.localParticipant.sid=t.sid,r.localParticipant.identity=t.identity,r.handleParticipantUpdates([t].concat(_toConsumableArray(e.otherParticipants))),e.room&&r.handleRoomUpdate(e.room)},r.attemptConnection=function(t,n,i,a){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function r(){var s,c,u;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.state===e.ConnectionState.Reconnecting?(o.info("Reconnection attempt replaced by new connection attempt"),this.recreateEngine()):this.maybeCreateEngine(),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},ja),i),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout),r.prev=1,r.next=4,this.connectSignal(t,n,this.engine,this.connOptions,this.options,a);case 4:c=r.sent,this.applyJoinResponse(c),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected),r.next=13;break;case 8:throw r.prev=8,r.t0=r.catch(1),this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),u=new dr("could not establish signal connection"),r.t0 instanceof Error&&(u.message="".concat(u.message,": ").concat(r.t0.message)),r.t0 instanceof dr&&(u.reason=r.t0.reason,u.status=r.t0.status),o.debug("error trying to establish signal connection",{error:r.t0}),u;case 13:if(!a.signal.aborted){r.next=15;break}throw this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),new dr("Connection attempt aborted");case 15:return r.prev=15,r.next=18,this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,a);case 18:r.next=23;break;case 20:throw r.prev=20,r.t1=r.catch(15),this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),r.t1;case 23:Lr()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave),null===(s=navigator.mediaDevices)||void 0===s||s.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Connected),this.registerConnectionReconcile();case 24:case"end":return r.stop()}}),r,this,[[1,8],[15,20]])})))},r.disconnect=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return qt(a,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,s,c;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.disconnectLock.lock();case 2:if(c=n.sent,n.prev=3,this.state!==e.ConnectionState.Disconnected){n.next=6;break}return n.abrupt("return",void o.debug("already disconnected"));case 6:if(o.info("disconnect from room",{identity:this.localParticipant.identity}),this.state!==e.ConnectionState.Connecting&&this.state!==e.ConnectionState.Reconnecting||(o.warn("abort connection attempt"),null===(i=this.abortController)||void 0===i||i.abort(),null===(a=null===(r=this.connectFuture)||void 0===r?void 0:r.reject)||void 0===a||a.call(r,new dr("Client initiated disconnect")),this.connectFuture=void 0),n.t0=null===(s=this.engine)||void 0===s?void 0:s.client.isConnected,!n.t0){n.next=12;break}return n.next=12,this.engine.client.sendLeave();case 12:if(n.t1=this.engine,!n.t1){n.next=16;break}return n.next=16,this.engine.close();case 16:this.handleDisconnect(t,e.DisconnectReason.CLIENT_INITIATED),this.engine=void 0;case 18:return n.prev=18,c(),n.finish(18);case 21:case"end":return n.stop()}}),n,this,[[3,,18,21]])})))},r.onPageLeave=function(){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.disconnect();case 2:case"end":return e.stop()}}),e,this)})))},r.handleRestarting=function(){r.clearConnectionReconcile();var t,n=_createForOfIteratorHelper(r.participants.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;r.handleParticipantDisconnected(i.sid,i)}}catch(e){n.e(e)}finally{n.f()}r.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&r.emit(e.RoomEvent.Reconnecting)},r.handleSignalRestarted=function(t){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r=this;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o.debug("signal reconnected to server",{region:t.serverRegion}),this.cachedParticipantSids=[],this.applyJoinResponse(t),n.prev=1,i=[],this.localParticipant.tracks.forEach((function(e){e.track&&i.push(e)})),n.next=6,Promise.all(i.map((function(e){return qt(r,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.track,this.localParticipant.unpublishTrack(n,!1),t.t0=n.isMuted,t.t0){t.next=12;break}if(t.t1=(n instanceof eo||n instanceof to)&&!n.isUserProvided,!t.t1){t.next=9;break}return o.debug("restarting existing track",{track:e.trackSid}),t.next=9,n.restartTrack();case 9:return o.debug("publishing new track",{track:e.trackSid}),t.next=12,this.localParticipant.publishTrack(n,e.options);case 12:case"end":return t.stop()}}),t,this)})))})));case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),o.error("error trying to re-publish tracks after reconnection",{error:n.t0});case 11:return n.prev=11,n.next=14,this.engine.waitForRestarted();case 14:o.debug("fully reconnected to server",{region:t.serverRegion}),n.next=20;break;case 17:return n.prev=17,n.t1=n.catch(11),n.abrupt("return");case 20:this.setAndEmitConnectionState(e.ConnectionState.Connected),this.emit(e.RoomEvent.Reconnected),this.registerConnectionReconcile(),this.participants.forEach((function(t){r.emit(e.RoomEvent.ParticipantConnected,t)}));case 21:case"end":return n.stop()}}),n,this,[[1,8],[11,17]])})))},r.handleParticipantUpdates=function(e){e.forEach((function(e){if(e.identity!==r.localParticipant.identity){var t=r.identityToSid.get(e.identity);t&&t!==e.sid&&r.handleParticipantDisconnected(t,r.participants.get(t));var n=r.participants.get(e.sid),i=!n;e.state===Ze.DISCONNECTED?r.handleParticipantDisconnected(e.sid,n):(n=r.getOrCreateParticipant(e.sid,e),i||n.updateInfo(e))}else r.localParticipant.updateInfo(e)}))},r.handleActiveSpeakersUpdate=function(t){var n=[],i={};t.forEach((function(e){if(i[e.sid]=!0,e.sid===r.localParticipant.sid)r.localParticipant.audioLevel=e.level,r.localParticipant.setIsSpeaking(!0),n.push(r.localParticipant);else{var t=r.participants.get(e.sid);t&&(t.audioLevel=e.level,t.setIsSpeaking(!0),n.push(t))}})),i[r.localParticipant.sid]||(r.localParticipant.audioLevel=0,r.localParticipant.setIsSpeaking(!1)),r.participants.forEach((function(e){i[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))})),r.activeSpeakers=n,r.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,n)},r.handleSpeakersChanged=function(t){var n=new Map;r.activeSpeakers.forEach((function(e){n.set(e.sid,e)})),t.forEach((function(e){var t=r.participants.get(e.sid);e.sid===r.localParticipant.sid&&(t=r.localParticipant),t&&(t.audioLevel=e.level,t.setIsSpeaking(e.active),e.active?n.set(e.sid,t):n.delete(e.sid))}));var i=Array.from(n.values());i.sort((function(e,t){return t.audioLevel-e.audioLevel})),r.activeSpeakers=i,r.emitWhenConnected(e.RoomEvent.ActiveSpeakersChanged,i)},r.handleStreamStateUpdate=function(t){t.streamStates.forEach((function(t){var n=r.participants.get(t.participantSid);if(n){var i=n.getTrackPublication(t.trackSid);i&&i.track&&(i.track.streamState=$a.streamStateFromProto(t.state),n.emit(e.ParticipantEvent.TrackStreamStateChanged,i,i.track.streamState),r.emitWhenConnected(e.RoomEvent.TrackStreamStateChanged,i,i.track.streamState,n))}}))},r.handleSubscriptionPermissionUpdate=function(e){var t=r.participants.get(e.participantSid);if(t){var n=t.getTrackPublication(e.trackSid);n&&n.setAllowed(e.allowed)}},r.handleDataPacket=function(t,n){var i=r.participants.get(t.participantSid);r.emit(e.RoomEvent.DataReceived,t.payload,i,n,t.topic),null==i||i.emit(e.ParticipantEvent.DataReceived,t.payload,n)},r.handleAudioPlaybackStarted=function(){r.canPlaybackAudio||(r.audioEnabled=!0,r.emit(e.RoomEvent.AudioPlaybackStatusChanged,!0))},r.handleAudioPlaybackFailed=function(t){o.warn("could not playback audio",t),r.canPlaybackAudio&&(r.audioEnabled=!1,r.emit(e.RoomEvent.AudioPlaybackStatusChanged,!1))},r.handleDeviceChange=function(){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.emit(e.RoomEvent.MediaDevicesChanged);case 1:case"end":return t.stop()}}),t,this)})))},r.handleRoomUpdate=function(t){var n=r.roomInfo;r.roomInfo=t,n&&n.metadata!==t.metadata&&r.emitWhenConnected(e.RoomEvent.RoomMetadataChanged,t.metadata),(null==n?void 0:n.activeRecording)!==t.activeRecording&&r.emitWhenConnected(e.RoomEvent.RecordingStatusChanged,t.activeRecording)},r.handleConnectionQualityUpdate=function(e){e.updates.forEach((function(e){if(e.participantSid!==r.localParticipant.sid){var t=r.participants.get(e.participantSid);t&&t.setConnectionQuality(e.quality)}else r.localParticipant.setConnectionQuality(e.quality)}))},r.onLocalParticipantMetadataChanged=function(t){r.emit(e.RoomEvent.ParticipantMetadataChanged,t,r.localParticipant)},r.onLocalParticipantNameChanged=function(t){r.emit(e.RoomEvent.ParticipantNameChanged,t,r.localParticipant)},r.onLocalTrackMuted=function(t){r.emit(e.RoomEvent.TrackMuted,t,r.localParticipant)},r.onLocalTrackUnmuted=function(t){r.emit(e.RoomEvent.TrackUnmuted,t,r.localParticipant)},r.onLocalTrackPublished=function(t){return qt(_assertThisInitialized(r),void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.emit(e.RoomEvent.LocalTrackPublished,t,this.localParticipant),!(t.track instanceof eo)){n.next=6;break}return n.next=3,t.track.checkForSilence();case 3:if(n.t0=n.sent,!n.t0){n.next=6;break}this.emit(e.RoomEvent.LocalAudioSilenceDetected,t);case 6:case"end":return n.stop()}}),n,this)})))},r.onLocalTrackUnpublished=function(t){r.emit(e.RoomEvent.LocalTrackUnpublished,t,r.localParticipant)},r.onLocalConnectionQualityChanged=function(t){r.emit(e.RoomEvent.ConnectionQualityChanged,t,r.localParticipant)},r.onMediaDevicesError=function(t){r.emit(e.RoomEvent.MediaDevicesError,t)},r.onLocalParticipantPermissionsChanged=function(t){r.emit(e.RoomEvent.ParticipantPermissionsChanged,t,r.localParticipant)},r.setMaxListeners(100),r.participants=new Map,r.cachedParticipantSids=[],r.identityToSid=new Map,r.options=Object.assign(Object.assign({},Ba),t),r.options.audioCaptureDefaults=Object.assign(Object.assign({},Ma),null==t?void 0:t.audioCaptureDefaults),r.options.videoCaptureDefaults=Object.assign(Object.assign({},Fa),null==t?void 0:t.videoCaptureDefaults),r.options.publishDefaults=Object.assign(Object.assign({},La),null==t?void 0:t.publishDefaults),r.maybeCreateEngine(),r.disconnectLock=new Xr,r.localParticipant=new Oo("","",r.engine,r.options),r}return _createClass(i,[{key:"isRecording",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}},{key:"sid",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.sid)&&void 0!==t?t:""}},{key:"name",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}},{key:"metadata",get:function(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}},{key:"numParticipants",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}},{key:"numPublishers",get:function(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}},{key:"maybeCreateEngine",value:function(){var t=this;this.engine&&!this.engine.isClosed||(this.engine=new za(this.options),this.engine.client.onParticipantUpdate=this.handleParticipantUpdates,this.engine.client.onRoomUpdate=this.handleRoomUpdate,this.engine.client.onSpeakersChanged=this.handleSpeakersChanged,this.engine.client.onStreamStateUpdate=this.handleStreamStateUpdate,this.engine.client.onSubscriptionPermissionUpdate=this.handleSubscriptionPermissionUpdate,this.engine.client.onConnectionQuality=this.handleConnectionQualityUpdate,this.engine.on(e.EngineEvent.MediaTrackAdded,(function(e,n,i){t.onTrackAdded(e,n,i)})).on(e.EngineEvent.Disconnected,(function(e){t.handleDisconnect(t.options.stopLocalTrackOnUnpublish,e)})).on(e.EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(e.EngineEvent.DataPacketReceived,this.handleDataPacket).on(e.EngineEvent.Resuming,(function(){t.clearConnectionReconcile(),t.setAndEmitConnectionState(e.ConnectionState.Reconnecting)&&t.emit(e.RoomEvent.Reconnecting),t.cachedParticipantSids=Array.from(t.participants.keys())})).on(e.EngineEvent.Resumed,(function(){t.setAndEmitConnectionState(e.ConnectionState.Connected),t.emit(e.RoomEvent.Reconnected),t.registerConnectionReconcile(),t.updateSubscriptions(),Array.from(t.participants.values()).filter((function(e){return!t.cachedParticipantSids.includes(e.sid)})).forEach((function(n){return t.emit(e.RoomEvent.ParticipantConnected,n)})),t.cachedParticipantSids=[]})).on(e.EngineEvent.SignalResumed,(function(){t.state===e.ConnectionState.Reconnecting&&t.sendSyncState()})).on(e.EngineEvent.Restarting,this.handleRestarting).on(e.EngineEvent.SignalRestarted,this.handleSignalRestarted).on(e.EngineEvent.DCBufferStatusChanged,(function(n,i){t.emit(e.RoomEvent.DCBufferStatusChanged,n,i)})),this.localParticipant&&this.localParticipant.setupEngine(this.engine))}},{key:"prepareConnection",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http".concat(e.substring(2)),{method:"HEAD"});case 2:case"end":return t.stop()}}),t)})))}},{key:"getParticipantByIdentity",value:function(e){if(this.localParticipant.identity===e)return this.localParticipant;var t=this.identityToSid.get(e);return t?this.participants.get(t):void 0}},{key:"clearConnectionFutures",value:function(){this.connectFuture=void 0}},{key:"simulateScenario",value:function(t){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a=this;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=function(){},n.t0=t,n.next="signal-reconnect"===n.t0?4:"speaker"===n.t0?8:"node-failure"===n.t0?10:"server-leave"===n.t0?12:"migration"===n.t0?14:"resume-reconnect"===n.t0?16:"full-reconnect"===n.t0?21:"force-tcp"===n.t0||"force-tls"===n.t0?26:27;break;case 4:return n.next=6,this.engine.client.close();case 6:return this.engine.client.onClose&&this.engine.client.onClose("simulate disconnect"),n.abrupt("break",27);case 8:return i=ir.fromPartial({scenario:{$case:"speakerUpdate",speakerUpdate:3}}),n.abrupt("break",27);case 10:return i=ir.fromPartial({scenario:{$case:"nodeFailure",nodeFailure:!0}}),n.abrupt("break",27);case 12:return i=ir.fromPartial({scenario:{$case:"serverLeave",serverLeave:!0}}),n.abrupt("break",27);case 14:return i=ir.fromPartial({scenario:{$case:"migration",migration:!0}}),n.abrupt("break",27);case 16:return this.engine.failNext(),n.next=19,this.engine.client.close();case 19:return this.engine.client.onClose&&this.engine.client.onClose("simulate resume-reconnect"),n.abrupt("break",27);case 21:return this.engine.fullReconnectOnNext=!0,n.next=24,this.engine.client.close();case 24:return this.engine.client.onClose&&this.engine.client.onClose("simulate full-reconnect"),n.abrupt("break",27);case 26:i=ir.fromPartial({scenario:{$case:"switchCandidateProtocol",switchCandidateProtocol:"force-tls"===t?2:1}}),r=function(){return qt(a,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=this.engine.client.onLeave)&&n({reason:e.DisconnectReason.CLIENT_INITIATED,canReconnect:!0});case 2:case"end":return t.stop()}}),t,this)})))};case 27:i&&(this.engine.client.sendSimulateScenario(i),r());case 28:case"end":return n.stop()}}),n,this)})))}},{key:"startAudio",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.acquireAudioContext();case 2:return t=[],this.participants.forEach((function(e){e.audioTracks.forEach((function(e){e.track&&e.track.attachedElements.forEach((function(e){t.push(e)}))}))})),e.prev=4,e.next=7,Promise.all(t.map((function(e){return e.muted=!1,e.play()})));case 7:this.handleAudioPlaybackStarted(),e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(4),this.handleAudioPlaybackFailed(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[4,10]])})))}},{key:"canPlaybackAudio",get:function(){return this.audioEnabled}},{key:"getActiveAudioOutputDevice",value:function(){var e,t;return null!==(t=null===(e=this.options.audioOutput)||void 0===e?void 0:e.deviceId)&&void 0!==t?t:""}},{key:"switchActiveDevice",value:function(e,t){var n,i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return qt(this,void 0,void 0,_regeneratorRuntime().mark((function a(){var o,s,c,u,d,l;return _regeneratorRuntime().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=r?{exact:t}:t,"audioinput"!==e){a.next=15;break}return s=this.options.audioCaptureDefaults.deviceId,this.options.audioCaptureDefaults.deviceId=o,c=Array.from(this.localParticipant.audioTracks.values()).filter((function(e){return e.source===$a.Source.Microphone})),a.prev=5,a.next=8,Promise.all(c.map((function(e){var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(o)})));case 8:a.next=13;break;case 10:throw a.prev=10,a.t0=a.catch(5),this.options.audioCaptureDefaults.deviceId=s,a.t0;case 13:case 27:case 38:a.next=43;break;case 15:if("videoinput"!==e){a.next=29;break}return u=this.options.videoCaptureDefaults.deviceId,this.options.videoCaptureDefaults.deviceId=o,d=Array.from(this.localParticipant.videoTracks.values()).filter((function(e){return e.source===$a.Source.Camera})),a.prev=19,a.next=22,Promise.all(d.map((function(e){var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(o)})));case 22:a.next=27;break;case 24:throw a.prev=24,a.t1=a.catch(19),this.options.videoCaptureDefaults.deviceId=u,a.t1;case 29:if("audiooutput"!==e){a.next=43;break}if(Nr()){a.next=32;break}throw new Error("cannot switch audio output, setSinkId not supported");case 32:return null!==(n=(i=this.options).audioOutput)&&void 0!==n||(i.audioOutput={}),l=this.options.audioOutput.deviceId,this.options.audioOutput.deviceId=t,a.prev=35,a.next=38,Promise.all(Array.from(this.participants.values()).map((function(e){return e.setAudioOutput({deviceId:t})})));case 40:throw a.prev=40,a.t2=a.catch(35),this.options.audioOutput.deviceId=l,a.t2;case 43:case"end":return a.stop()}}),a,this,[[5,10],[19,24],[35,40]])})))}},{key:"setupLocalParticipantEvents",value:function(){this.localParticipant.on(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}},{key:"recreateEngine",value:function(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.participants.clear(),this.maybeCreateEngine()}},{key:"onTrackAdded",value:function(t,n,i){var r=this;if(this.state===e.ConnectionState.Connecting||this.state===e.ConnectionState.Reconnecting){var a=function(){r.onTrackAdded(t,n,i),s()},s=function t(){r.off(e.RoomEvent.Reconnected,a),r.off(e.RoomEvent.Connected,a),r.off(e.RoomEvent.Disconnected,t)};return this.once(e.RoomEvent.Reconnected,a),this.once(e.RoomEvent.Connected,a),void this.once(e.RoomEvent.Disconnected,s)}if(this.state!==e.ConnectionState.Disconnected){var c=function(e){var t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(n.id),u=c[0],d=c[1];if(d&&""!==d||(d=t.id),u!==this.localParticipant.sid){var l,p=this.getOrCreateParticipant(u);this.options.adaptiveStream&&(l="object"==_typeof(this.options.adaptiveStream)?this.options.adaptiveStream:{}),p.addSubscribedMediaTrack(t,d,n,i,l)}else o.warn("tried to create RemoteParticipant for local participant")}else o.warn("skipping incoming track after Room disconnected")}},{key:"handleDisconnect",value:function(){var t,n=this,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.clearConnectionReconcile(),this.state!==e.ConnectionState.Disconnected)try{this.participants.forEach((function(e){e.tracks.forEach((function(t){e.unpublishTrack(t.trackSid)}))})),this.localParticipant.tracks.forEach((function(e){var t,r;e.track&&n.localParticipant.unpublishTrack(e.track,i),i&&(null===(t=e.track)||void 0===t||t.detach(),null===(r=e.track)||void 0===r||r.stop())})),this.localParticipant.off(e.ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(e.ParticipantEvent.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(e.ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(e.ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(e.ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(e.ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(e.ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(e.ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(e.ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.expWebAudioMix&&(this.audioContext.close(),this.audioContext=void 0),Lr()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),null===(t=navigator.mediaDevices)||void 0===t||t.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(e.ConnectionState.Disconnected),this.emit(e.RoomEvent.Disconnected,r)}}},{key:"handleParticipantDisconnected",value:function(t,n){this.participants.delete(t),n&&(this.identityToSid.delete(n.identity),n.tracks.forEach((function(e){n.unpublishTrack(e.trackSid,!0)})),this.emit(e.RoomEvent.ParticipantDisconnected,n))}},{key:"acquireAudioContext",value:function(){var t,n;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var r,a=this;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if("boolean"==typeof this.options.expWebAudioMix||!this.options.expWebAudioMix.audioContext){i.next=6;break}return this.audioContext=this.options.expWebAudioMix.audioContext,i.next=4,this.audioContext.resume();case 4:i.next=7;break;case 6:this.audioContext=null!==(t=Rr())&&void 0!==t?t:void 0;case 7:this.options.expWebAudioMix&&this.participants.forEach((function(e){return e.setAudioContext(a.audioContext)})),(r="running"===(null===(n=this.audioContext)||void 0===n?void 0:n.state))!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(e.RoomEvent.AudioPlaybackStatusChanged,r));case 10:case"end":return i.stop()}}),i,this)})))}},{key:"createParticipant",value:function(e,t){var n;return n=t?vo.fromParticipantInfo(this.engine.client,t):new vo(this.engine.client,e,"",void 0,void 0),this.options.expWebAudioMix&&n.setAudioContext(this.audioContext),n}},{key:"getOrCreateParticipant",value:function(t,n){var i=this;if(this.participants.has(t))return this.participants.get(t);var r=this.createParticipant(t,n);return this.participants.set(t,r),n&&(this.identityToSid.set(n.identity,n.sid),this.emitWhenConnected(e.RoomEvent.ParticipantConnected,r)),r.on(e.ParticipantEvent.TrackPublished,(function(t){i.emitWhenConnected(e.RoomEvent.TrackPublished,t,r)})).on(e.ParticipantEvent.TrackSubscribed,(function(t,n){t.kind===$a.Kind.Audio&&(t.on(e.TrackEvent.AudioPlaybackStarted,i.handleAudioPlaybackStarted),t.on(e.TrackEvent.AudioPlaybackFailed,i.handleAudioPlaybackFailed)),i.emit(e.RoomEvent.TrackSubscribed,t,n,r)})).on(e.ParticipantEvent.TrackUnpublished,(function(t){i.emit(e.RoomEvent.TrackUnpublished,t,r)})).on(e.ParticipantEvent.TrackUnsubscribed,(function(t,n){i.emit(e.RoomEvent.TrackUnsubscribed,t,n,r)})).on(e.ParticipantEvent.TrackSubscriptionFailed,(function(t){i.emit(e.RoomEvent.TrackSubscriptionFailed,t,r)})).on(e.ParticipantEvent.TrackMuted,(function(t){i.emitWhenConnected(e.RoomEvent.TrackMuted,t,r)})).on(e.ParticipantEvent.TrackUnmuted,(function(t){i.emitWhenConnected(e.RoomEvent.TrackUnmuted,t,r)})).on(e.ParticipantEvent.ParticipantMetadataChanged,(function(t){i.emitWhenConnected(e.RoomEvent.ParticipantMetadataChanged,t,r)})).on(e.ParticipantEvent.ParticipantNameChanged,(function(t){i.emitWhenConnected(e.RoomEvent.ParticipantNameChanged,t,r)})).on(e.ParticipantEvent.ConnectionQualityChanged,(function(t){i.emitWhenConnected(e.RoomEvent.ConnectionQualityChanged,t,r)})).on(e.ParticipantEvent.ParticipantPermissionsChanged,(function(t){i.emitWhenConnected(e.RoomEvent.ParticipantPermissionsChanged,t,r)})).on(e.ParticipantEvent.TrackSubscriptionStatusChanged,(function(t,n){i.emitWhenConnected(e.RoomEvent.TrackSubscriptionStatusChanged,t,n,r)})).on(e.ParticipantEvent.TrackSubscriptionPermissionChanged,(function(t,n){i.emitWhenConnected(e.RoomEvent.TrackSubscriptionPermissionChanged,t,n,r)})),n&&r.updateInfo(n),r}},{key:"sendSyncState",value:function(){var e,t;if(void 0!==this.engine.subscriber&&null!==this.engine.subscriber.pc.localDescription){var n=this.engine.subscriber.pc.localDescription,i=this.engine.subscriber.pc.remoteDescription,r=null===(t=null===(e=this.connOptions)||void 0===e?void 0:e.autoSubscribe)||void 0===t||t,a=new Array;this.participants.forEach((function(e){e.tracks.forEach((function(e){e.isDesired!==r&&a.push(e.trackSid)}))})),this.engine.client.sendSyncState({answer:ia({sdp:n.sdp,type:n.type}),offer:i?ia({sdp:i.sdp,type:i.type}):void 0,subscription:{trackSids:a,subscribe:!r,participantTracks:[]},publishTracks:this.localParticipant.publishedTracksInfo(),dataChannels:this.localParticipant.dataChannelsInfo()})}}},{key:"updateSubscriptions",value:function(){var e,t=_createForOfIteratorHelper(this.participants.values());try{for(t.s();!(e=t.n()).done;){var n,i=_createForOfIteratorHelper(e.value.videoTracks.values());try{for(i.s();!(n=i.n()).done;){var r=n.value;r.isSubscribed&&r instanceof ho&&r.emitTrackUpdate()}}catch(e){i.e(e)}finally{i.f()}}}catch(e){t.e(e)}finally{t.f()}}},{key:"registerConnectionReconcile",value:function(){var t=this;this.clearConnectionReconcile();var n=0;this.connectionReconcileInterval=mr.setInterval((function(){t.engine&&!t.engine.isClosed&&t.engine.verifyTransport()?n=0:(n++,o.warn("detected connection state mismatch",{numFailures:n}),n>=3&&t.handleDisconnect(t.options.stopLocalTrackOnUnpublish,e.DisconnectReason.UNKNOWN_REASON))}),2e3)}},{key:"clearConnectionReconcile",value:function(){this.connectionReconcileInterval&&mr.clearInterval(this.connectionReconcileInterval)}},{key:"setAndEmitConnectionState",value:function(t){return t!==this.state&&(this.state=t,this.emit(e.RoomEvent.ConnectionStateChanged,this.state),!0)}},{key:"emitWhenConnected",value:function(t){if(this.state===e.ConnectionState.Connected){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.emit.apply(this,[t].concat(i))}return!1}},{key:"simulateParticipants",value:function(t){var n,i;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var a,o,s,c,u,d,l,p,f,h,v;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants),this.handleDisconnect(),this.roomInfo={sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:(new Date).getTime(),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1},this.localParticipant.updateInfo(wt.fromPartial({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(e.RoomEvent.SignalConnected),this.emit(e.RoomEvent.Connected),this.setAndEmitConnectionState(e.ConnectionState.Connected),!a.video){r.next=17;break}if(r.t0=po,r.t1=$a.Kind.Video,r.t2=Rt.fromPartial({source:We.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:qe.AUDIO,name:"video-dummy"}),r.t3=to,!a.useRealTracks){r.next=12;break}return r.next=9,navigator.mediaDevices.getUserMedia({video:!0});case 9:r.t4=r.sent.getVideoTracks()[0],r.next=13;break;case 12:r.t4=Kr(null!==(n=160*o.aspectRatios[0])&&void 0!==n?n:1,160,!0,!0);case 13:r.t5=r.t4,r.t6=new r.t3(r.t5),s=new r.t0(r.t1,r.t2,r.t6),this.localParticipant.addTrackPublication(s),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,s);case 17:if(!a.audio){r.next=33;break}if(r.t7=po,r.t8=$a.Kind.Audio,r.t9=Rt.fromPartial({source:We.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:qe.AUDIO}),r.t10=eo,!a.useRealTracks){r.next=28;break}return r.next=25,navigator.mediaDevices.getUserMedia({audio:!0});case 25:r.t11=r.sent.getAudioTracks()[0],r.next=29;break;case 28:r.t11=Zr();case 29:r.t12=r.t11,r.t13=new r.t10(r.t12),c=new r.t7(r.t8,r.t9,r.t13),this.localParticipant.addTrackPublication(c),this.localParticipant.emit(e.ParticipantEvent.LocalTrackPublished,c);case 33:for(u=0;u<o.count-1;u+=1)d=wt.fromPartial({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(u),state:Ze.ACTIVE,tracks:[],joinedAt:Date.now()}),l=this.getOrCreateParticipant(d.identity,d),o.video&&(p=Kr(null!==(i=160*o.aspectRatios[u%o.aspectRatios.length])&&void 0!==i?i:1,160,!1,!0),f=Rt.fromPartial({source:We.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:qe.AUDIO}),l.addSubscribedMediaTrack(p,f.sid,new MediaStream([p])),d.tracks=[].concat(_toConsumableArray(d.tracks),[f])),o.audio&&(h=Zr(),v=Rt.fromPartial({source:We.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:qe.AUDIO}),l.addSubscribedMediaTrack(h,v.sid,new MediaStream([h])),d.tracks=[].concat(_toConsumableArray(d.tracks),[v])),l.updateInfo(d);case 34:case"end":return r.stop()}}),r,this)})))}},{key:"emit",value:function(t){for(var n,r=arguments.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];return t!==e.RoomEvent.ActiveSpeakersChanged&&o.debug("room event ".concat(t),{event:t,args:a}),(n=_get(_getPrototypeOf(i.prototype),"emit",this)).call.apply(n,[this,t].concat(a))}}],[{key:"getLocalDevices",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return aa.getInstance().getDevices(e,t)}}]),i}(un.EventEmitter);function Ao(e){var t,n;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var r,a,o;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return null!=e||(e={}),null!==(t=e.audio)&&void 0!==t||(e.audio=!0),null!==(n=e.video)&&void 0!==n||(e.video=!0),r=Cr(Sr(e,Ma,Fa)),a=navigator.mediaDevices.getUserMedia(r),e.audio&&(aa.userMediaPromiseMap.set("audioinput",a),a.catch((function(){return aa.userMediaPromiseMap.delete("audioinput")}))),e.video&&(aa.userMediaPromiseMap.set("videoinput",a),a.catch((function(){return aa.userMediaPromiseMap.delete("videoinput")}))),i.next=5,a;case 5:return o=i.sent,i.abrupt("return",o.getTracks().map((function(t){var n,i="audio"===t.kind;i?e.audio:e.video;var a=i?r.audio:r.video;"boolean"!=typeof a&&(n=a);var s=mo(t,n);return s.kind===$a.Kind.Video?s.source=$a.Source.Camera:s.kind===$a.Kind.Audio&&(s.source=$a.Source.Microphone),s.mediaStream=o,s})));case 7:case"end":return i.stop()}}),i)})))}function Uo(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ao({audio:!1,video:e});case 2:return t.abrupt("return",t.sent[0]);case 3:case"end":return t.stop()}}),t)})))}function Lo(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ao({audio:e,video:!1});case 2:return t.abrupt("return",t.sent[0]);case 3:case"end":return t.stop()}}),t)})))}!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(No||(No={}));var Mo=function(t){_inherits(i,t);var n=_createSuper(i);function i(e,t){var r;_classCallCheck(this,i);var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(r=n.call(this)).status=No.IDLE,r.logs=[],r.errorsAsWarnings=!1,r.url=e,r.token=t,r.name=r.constructor.name,r.room=new Do(a.roomOptions),r.connectOptions=a.connectOptions,a.errorsAsWarnings&&(r.errorsAsWarnings=a.errorsAsWarnings),r}return _createClass(i,[{key:"run",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.status===No.IDLE){t.next=2;break}throw Error("check is running already");case 2:return this.setStatus(No.RUNNING),this.appendMessage("".concat(this.name," started.")),t.prev=3,t.next=6,this.perform();case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),t.t0 instanceof Error&&(this.errorsAsWarnings?this.appendWarning(t.t0.message):this.appendError(t.t0.message));case 11:return t.next=13,this.disconnect();case 13:return t.next=15,new Promise((function(e){return setTimeout(e,500)}));case 15:return this.status!==No.SKIPPED&&this.setStatus(this.isSuccess()?No.SUCCESS:No.FAILED),e&&e(),t.abrupt("return",this.getInfo());case 18:case"end":return t.stop()}}),t,this,[[3,8]])})))}},{key:"isSuccess",value:function(){return!this.logs.some((function(e){return"error"===e.level}))}},{key:"connect",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.room.state===e.ConnectionState.Connected,t.t0){t.next=4;break}return t.next=4,this.room.connect(this.url,this.token);case 4:return t.abrupt("return",this.room);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"disconnect",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.room&&this.room.state!==e.ConnectionState.Disconnected,!t.t0){t.next=6;break}return t.next=4,this.room.disconnect();case 4:return t.next=6,new Promise((function(e){return setTimeout(e,500)}));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"skip",value:function(){this.setStatus(No.SKIPPED)}},{key:"appendMessage",value:function(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}},{key:"appendWarning",value:function(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}},{key:"appendError",value:function(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}},{key:"setStatus",value:function(e){this.status=e,this.emit("update",this.getInfo())}},{key:"engine",get:function(){var e;return null===(e=this.room)||void 0===e?void 0:e.engine}},{key:"getInfo",value:function(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}]),i}(un.EventEmitter),Fo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"description",get:function(){return"Can publish audio"}},{key:"perform",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i,r,a;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.connect();case 2:return n=t.sent,t.next=5,Lo();case 5:return i=t.sent,n.localParticipant.publishTrack(i),t.next=9,new Promise((function(e){return setTimeout(e,3e3)}));case 9:return t.next=11,null===(e=i.sender)||void 0===e?void 0:e.getStats();case 11:if(r=t.sent){t.next=14;break}throw new Error("Could not get RTCStats");case 14:if(a=0,r.forEach((function(e){"outbound-rtp"===e.type&&"audio"===e.mediaType&&(a=e.packetsSent)})),0!==a){t.next=17;break}throw new Error("Could not determine packets are sent");case 17:this.appendMessage("published ".concat(a," audio packets"));case 18:case"end":return t.stop()}}),t,this)})))}}]),n}(Mo),Bo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"description",get:function(){return"Can publish video"}},{key:"perform",value:function(){var e;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i,r,a;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.connect();case 2:return n=t.sent,t.next=5,Uo();case 5:return i=t.sent,n.localParticipant.publishTrack(i),t.next=9,new Promise((function(e){return setTimeout(e,3e3)}));case 9:return t.next=11,null===(e=i.sender)||void 0===e?void 0:e.getStats();case 11:if(r=t.sent){t.next=14;break}throw new Error("Could not get RTCStats");case 14:if(a=0,r.forEach((function(e){"outbound-rtp"===e.type&&"video"===e.mediaType&&(a=e.packetsSent)})),0!==a){t.next=17;break}throw new Error("Could not determine packets are sent");case 17:this.appendMessage("published ".concat(a," video packets"));case 18:case"end":return t.stop()}}),t,this)})))}}]),n}(Mo),jo=function(t){_inherits(i,t);var n=_createSuper(i);function i(){return _classCallCheck(this,i),n.apply(this,arguments)}return _createClass(i,[{key:"description",get:function(){return"Resuming connection after interruption"}},{key:"perform",value:function(){var t;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,o,s,c;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.connect();case 2:return i=n.sent,a=!1,o=!1,s=new Promise((function(e){setTimeout(e,5e3),r=e})),i.on(e.RoomEvent.Reconnecting,(function(){a=!0})).on(e.RoomEvent.Reconnected,(function(){o=!0,r(!0)})),null===(t=i.engine.client.ws)||void 0===t||t.close(),(c=i.engine.client.onClose)&&c(""),n.next=10,s;case 10:if(a){n.next=12;break}throw new Error("Did not attempt to reconnect");case 12:if(o&&i.state===e.ConnectionState.Connected){n.next=14;break}throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect");case 14:case"end":return n.stop()}}),n,this)})))}}]),i}(Mo),Jo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"description",get:function(){return"Can connect via TURN"}},{key:"perform",value:function(){var e,t;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,o,s,c,u,d,l,p,f;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=new ta,n.next=3,i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0});case 3:r=n.sent,a=!1,o=!1,s=!1,c=_createForOfIteratorHelper(r.iceServers);try{for(c.s();!(u=c.n()).done;){d=u.value,l=_createForOfIteratorHelper(d.urls);try{for(l.s();!(p=l.n()).done;)(f=p.value).startsWith("turn:")?(o=!0,s=!0):f.startsWith("turns:")&&(o=!0,s=!0,a=!0),f.startsWith("stun:")&&(s=!0)}catch(e){l.e(e)}finally{l.f()}}}catch(e){c.e(e)}finally{c.f()}return s?o&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),n.next=10,i.close();case 10:if(!(null===(t=null===(e=this.connectOptions)||void 0===e?void 0:e.rtcConfig)||void 0===t?void 0:t.iceServers)&&!o){n.next=15;break}return n.next=13,this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}});case 13:n.next=19;break;case 15:return this.appendWarning("No TURN servers configured."),this.skip(),n.next=19,new Promise((function(e){return setTimeout(e,0)}));case 19:case"end":return n.stop()}}),n,this)})))}}]),n}(Mo),$o=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"description",get:function(){return"Establishing WebRTC connection"}},{key:"perform",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("initiating room connection"),e.next=4,this.connect();case 4:this.room=e.sent,console.log("now the room is connected"),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),this.appendWarning("ports need to be open on firewall in order to connect."),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,8]])})))}}]),n}(Mo),Vo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"description",get:function(){return"Connecting to signal connection via WebSocket"}},{key:"perform",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it"),t=new ta,e.next=4,t.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0});case 4:return n=e.sent,this.appendMessage("Connected to server, version ".concat(n.serverVersion,".")),e.next=8,t.close();case 8:case"end":return e.stop()}}),e,this)})))}}]),n}(Mo);e.ConnectionCheck=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i){var r;return _classCallCheck(this,n),(r=t.call(this)).checkResults=new Map,r.url=e,r.token=i,r}return _createClass(n,[{key:"getNextCheckId",value:function(){var e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:No.IDLE,name:"",description:""}),e}},{key:"updateCheck",value:function(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}},{key:"isSuccess",value:function(){return Array.from(this.checkResults.values()).every((function(e){return e.status!==No.FAILED}))}},{key:"getResults",value:function(){return Array.from(this.checkResults.values())}},{key:"createAndRunCheck",value:function(e){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,i,r,a,o=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getNextCheckId(),i=new e(this.url,this.token),r=function(e){o.updateCheck(n,e)},i.on("update",r),t.next=4,i.run();case 4:return a=t.sent,t.abrupt("return",(i.off("update",r),a));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"checkWebsocket",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createAndRunCheck(Vo));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"checkWebRTC",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createAndRunCheck($o));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"checkTURN",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createAndRunCheck(Jo));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"checkReconnect",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createAndRunCheck(jo));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"checkPublishAudio",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createAndRunCheck(Fo));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"checkPublishVideo",value:function(){return qt(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createAndRunCheck(Bo));case 1:case"end":return e.stop()}}),e,this)})))}}]),n}(dn),e.ConnectionError=dr,e.CriticalTimers=mr,e.DefaultReconnectPolicy=Vt,e.DeviceUnsupportedError=lr,e.LivekitError=ur,e.LocalAudioTrack=eo,e.LocalParticipant=Oo,e.LocalTrack=Xa,e.LocalTrackPublication=po,e.LocalVideoTrack=to,e.NegotiationError=vr,e.Participant=fo,e.PublishDataError=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,13,null!=e?e:"unable to publish data")}return _createClass(n)}(ur),e.RemoteAudioTrack=oo,e.RemoteParticipant=vo,e.RemoteTrack=ao,e.RemoteTrackPublication=ho,e.RemoteVideoTrack=so,e.Room=Do,e.RoomState=Io,e.ScreenSharePresets=Ua,e.Track=$a,e.TrackInvalidError=pr,e.TrackPublication=lo,e.UnexpectedConnectionState=hr,e.UnsupportedServer=fr,e.VideoPreset=Ta,e.VideoPresets=Da,e.VideoPresets43=Aa,e.attachToElement=Va,e.createAudioAnalyser=function(e,t){var n=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},t),i=Rr();if(!i)throw new Error("Audio Context not supported on this browser");var r=n.cloneTrack?e.mediaStreamTrack.clone():e.mediaStreamTrack,a=i.createMediaStreamSource(new MediaStream([r])),o=i.createAnalyser();o.minDecibels=n.minDecibels,o.maxDecibels=n.maxDecibels,o.fftSize=n.fftSize,o.smoothingTimeConstant=n.smoothingTimeConstant,a.connect(o);var s=new Uint8Array(o.frequencyBinCount);return{calculateVolume:function(){o.getByteFrequencyData(s);var e,t=0,n=_createForOfIteratorHelper(s);try{for(n.s();!(e=n.n()).done;){var i=e.value;t+=Math.pow(i/255,2)}}catch(e){n.e(e)}finally{n.f()}return Math.sqrt(t/s.length)},analyser:o,cleanup:function(){i.close(),n.cloneTrack&&r.stop()}}},e.createLocalAudioTrack=Lo,e.createLocalScreenTracks=function(e){var t;return qt(this,void 0,void 0,_regeneratorRuntime().mark((function n(){var i,r,a,o,s,c;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0===e&&(e={}),void 0===e.resolution&&(e.resolution=Da.h1080.resolution),i=!0,e.resolution&&(i={width:e.resolution.width,height:e.resolution.height}),void 0!==navigator.mediaDevices.getDisplayMedia){n.next=4;break}throw new lr("getDisplayMedia not supported");case 4:return n.next=6,navigator.mediaDevices.getDisplayMedia({audio:null!==(t=e.audio)&&void 0!==t&&t,video:i});case 6:if(r=n.sent,0!==(a=r.getVideoTracks()).length){n.next=10;break}throw new pr("no video track found");case 10:return(o=new to(a[0],void 0,!1)).source=$a.Source.ScreenShare,s=[o],r.getAudioTracks().length>0&&((c=new eo(r.getAudioTracks()[0],void 0,!1)).source=$a.Source.ScreenShareAudio,s.push(c)),n.abrupt("return",s);case 15:case"end":return n.stop()}}),n)})))},e.createLocalTracks=Ao,e.createLocalVideoTrack=Uo,e.detachTrack=qa,e.getEmptyAudioStreamTrack=Zr,e.getEmptyVideoStreamTrack=zr,e.isBackupCodec=Ea,e.isBrowserSupported=function(){return Er()||_r()},e.isCodecEqual=_a,e.protocolVersion=yr,e.setLogExtension=function(t){var n=o.methodFactory;o.methodFactory=function(i,r,a){var s=n(i,r,a),c=o.getLevel(),u=r>=c&&r<e.LogLevel.silent;return function(e,n){n?s(e,n):s(e),u&&t(r,e,n)}},o.setLevel(o.getLevel())},e.setLogLevel=function(e){o.setLevel(e)},e.supportsAV1=xr,e.supportsAdaptiveStream=function(){return void 0!==("undefined"==typeof ResizeObserver?"undefined":_typeof(ResizeObserver))&&void 0!==("undefined"==typeof IntersectionObserver?"undefined":_typeof(IntersectionObserver))},e.supportsDynacast=function(){return Er()},e.version=kr}));
